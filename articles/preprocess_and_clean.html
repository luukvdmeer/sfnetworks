<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Network pre-processing and cleaning • sfnetworks</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Network pre-processing and cleaning">
<meta property="og:description" content="sfnetworks">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfnetworks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/structure.html">1. The sfnetwork data structure</a>
    </li>
    <li>
      <a href="../articles/preprocess_and_clean.html">2. Network pre-processing and cleaning</a>
    </li>
    <li>
      <a href="../articles/join_filter.html">3. Spatial joins and filters</a>
    </li>
    <li>
      <a href="../articles/routing.html">4. Routing</a>
    </li>
    <li>
      <a href="../articles/morphers.html">5. Spatial morphers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/luukvdmeer/sfnetworks/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="preprocess_and_clean_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="preprocess_and_clean_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="preprocess_and_clean_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. Network pre-processing and cleaning</h1>
            
            <h4 class="date">2020-12-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/luukvdmeer/sfnetworks/blob/master/vignettes/preprocess_and_clean.Rmd"><code>vignettes/preprocess_and_clean.Rmd</code></a></small>
      <div class="hidden name"><code>preprocess_and_clean.Rmd</code></div>

    </div>

    
    
<style type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>Unfortunately real-world datasets are not always as friendly as those used in tutorials. Pre-processing of the data will often be needed, as well as cleaning the network after construction. This vignette presents some examples that may be of use when going through this phase.</p>
<div id="common-pre-processing-tasks" class="section level2">
<h2 class="hasAnchor">
<a href="#common-pre-processing-tasks" class="anchor"></a>Common pre-processing tasks</h2>
<div id="rounding-coordinates" class="section level3">
<h3 class="hasAnchor">
<a href="#rounding-coordinates" class="anchor"></a>Rounding coordinates</h3>
<p>You might have a set of lines in which some endpoints are <em>almost</em> shared between two lines. However, the coordinates are stored with so much precision that there is a minor difference between the two points. When constructing a sfnetwork these lines will <em>not</em> be connected because the points are not <em>exactly</em> equal.</p>
<p>We can pre-process the lines by reducing the precision of the coordinates such that the points become <em>exactly</em> equal. A tiny example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com">tidygraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8.000001</span>, <span class="fl">52.000001</span><span class="op">)</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span>

<span class="va">l1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">p4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>

<span class="co"># The edges are not connected.</span>
<span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">4</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">2</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A rooted forest with 2 trees with spatially explicit edges
#&gt; #
#&gt; # Node Data:     4 x 1 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8.000001 ymax: 52</span><span>
#&gt;               x
#&gt;     </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>        (7 51)
#&gt; </span><span style="color: #555555;">2</span><span>        (8 52)
#&gt; </span><span style="color: #555555;">3</span><span> (8.000001 52)
#&gt; </span><span style="color: #555555;">4</span><span>        (7 52)
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     2 x 3</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8.000001 ymax: 52</span><span>
#&gt;    from    to                   x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2        (7 51, 8 52)
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 (8.000001 52, 7 52)
</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Round coordinates to 0 digits.</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span><span class="op">)</span>

<span class="co"># The edges are connected.</span>
<span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">2</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A rooted tree with spatially explicit edges
#&gt; #
#&gt; # Node Data:     3 x 1 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;             x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>      (7 51)
#&gt; </span><span style="color: #555555;">2</span><span>      (8 52)
#&gt; </span><span style="color: #555555;">3</span><span>      (7 52)
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     2 x 3</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;    from    to                x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2     (7 51, 8 52)
#&gt; </span><span style="color: #555555;">2</span><span>     2     3     (8 52, 7 52)
</span></code></pre>
</div>
<div id="dealing-with-one-way-edges" class="section level3">
<h3 class="hasAnchor">
<a href="#dealing-with-one-way-edges" class="anchor"></a>Dealing with one-way edges</h3>
<p>In <code>sfnetworks</code> you can create directed and undirected networks. In directed ones, an edge can only be traveled from its start node to its end node. In undirected ones, an edge can be traveled both ways. However, in the real world there are networks where <em>some</em> edges can be traveled both ways and <em>some</em> edges only one way. For example, a road network in a city where there are one-way streets.</p>
<p>Unfortunately, neither <code>igraph</code> nor <code>tidygraph</code> provides an interface for such networks. Therefore, the only way to deal with this is to create a directed network but first <em>duplicate</em> and <em>reverse</em> all edge linestrings that can be traveled both ways.</p>
<p>See the small example below, where we have three lines with one-way information stored in a <em>oneway</em> column. One of the lines is a one-way street, the other two are not. By duplicating and reversing the two linestrings that are not one-way streets, we create a directed network that correctly models our situation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span>

<span class="va">l1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">p2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span>, <span class="va">l3</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>
<span class="va">edges</span><span class="op">$</span><span class="va">oneway</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">edges</span>
<span class="co">#&gt; Simple feature collection with 3 features and 1 field</span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 7 ymin: 51 xmax: 8 ymax: 52</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt;                         x oneway</span>
<span class="co">#&gt; 1 LINESTRING (7 51, 7 52)   TRUE</span>
<span class="co">#&gt; 2 LINESTRING (7 51, 8 52)  FALSE</span>
<span class="co">#&gt; 3 LINESTRING (8 52, 7 52)  FALSE</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">duplicates</span> <span class="op">=</span> <span class="va">edges</span><span class="op">[</span><span class="op">!</span><span class="va">edges</span><span class="op">$</span><span class="va">oneway</span>, <span class="op">]</span>
<span class="va">reversed_duplicates</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_reverse</a></span><span class="op">(</span><span class="va">duplicates</span><span class="op">)</span>

<span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">edges</span>, <span class="va">reversed_duplicates</span><span class="op">)</span>
<span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span>
<span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"edges"</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">5</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A directed simple graph with 1 component with spatially explicit edges
#&gt; #
#&gt; # Edge Data:     5 x 4 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;    from    to oneway                x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 TRUE       (7 51, 7 52)
#&gt; </span><span style="color: #555555;">2</span><span>     1     3 FALSE      (7 51, 8 52)
#&gt; </span><span style="color: #555555;">3</span><span>     3     2 FALSE      (8 52, 7 52)
#&gt; </span><span style="color: #555555;">4</span><span>     3     1 FALSE      (8 52, 7 51)
#&gt; </span><span style="color: #555555;">5</span><span>     2     3 FALSE      (7 52, 8 52)
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     3 x 1</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;             x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>      (7 51)
#&gt; </span><span style="color: #555555;">2</span><span>      (7 52)
#&gt; </span><span style="color: #555555;">3</span><span>      (8 52)
</span></code></pre>
</div>
</div>
<div id="network-cleaning-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#network-cleaning-functions" class="anchor"></a>Network cleaning functions</h2>
<p>The <code>sfnetworks</code> package contains a set of spatial network specific cleaning functions. They are currently modeled as <em>spatial morphers</em>. To learn more about spatial morphers and what they are, see the <a href="https://luukvdmeer.github.io/sfnetworks/articles/morphers.html">dedicated vignette</a> for that. For now, it is sufficient to know that you can use any spatial morpher function inside the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">tidygraph::convert()</a></code> verb to convert your network into a different state.</p>
<p>Before presenting the cleaning functions that are currently implemented, lets create a network to be cleaned.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">p5</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">p6</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">p7</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">p8</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">p9</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">p10</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">p11</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">p12</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">p13</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">l1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">p4</span>, <span class="va">p5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p6</span>, <span class="va">p4</span>, <span class="va">p7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l4</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p8</span>, <span class="va">p11</span>, <span class="va">p9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l5</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p9</span>, <span class="va">p5</span>, <span class="va">p10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l6</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p8</span>, <span class="va">p9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l7</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p10</span>, <span class="va">p12</span>, <span class="va">p13</span>, <span class="va">p10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">points</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_multipoint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, <span class="va">p5</span>, <span class="va">p6</span>, <span class="va">p7</span>, <span class="va">p8</span>, <span class="va">p9</span>, <span class="va">p10</span>, <span class="va">p11</span>, <span class="va">p12</span>, <span class="va">p13</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">lines</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span>, <span class="va">l3</span>, <span class="va">l4</span>, <span class="va">l5</span>, <span class="va">l6</span>, <span class="va">l7</span><span class="op">)</span>

<span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<div id="subdivide-edges" class="section level3">
<h3 class="hasAnchor">
<a href="#subdivide-edges" class="anchor"></a>Subdivide edges</h3>
<p>When constructing a sfnetwork from a set of sf linestrings, the <em>endpoints</em> of those linestrings become nodes in the network. If endpoints are shared between multiple lines, they become a single node, and the edges are connected. However, a linestring geometry can also contain <em>interior points</em> that define the shape of the line, but are not its endpoints. It can happen that such an interior point in one edge is <em>exactly</em> equal to either an interior point or endpoint of another edge. In the network structure, however, these two edges are not connected, because they don’t share <em>endpoints</em>. If this is unwanted, we need to split these two edges at their shared point and connect them accordingly.</p>
<p>In graph theory terms the process of splitting and edge is called <em>subdivision</em>: the subdivision of an edge <span class="math inline">\(o = \{a, b\}\)</span> (i.e. an edge from node <span class="math inline">\(a\)</span> to node <span class="math inline">\(b\)</span>) is the addition of a new node <span class="math inline">\(c\)</span> and the replacement of <span class="math inline">\(o\)</span> by two new edges <span class="math inline">\(p = \{a, c\}\)</span> and <span class="math inline">\(q = \{c, b\}\)</span>.</p>
<p>The function <code><a href="../reference/spatial_morphers.html">to_spatial_subdivision()</a></code> subdivides edges at interior points whenever these interior points are equal to one or more interior points or endpoints of other edges, and recalculates network connectivity afterwards.</p>
<p>To illustrate the workflow, lets consider a situation where an interior point <span class="math inline">\(p_{x}\)</span> in edge <span class="math inline">\(x\)</span> is shared with point <span class="math inline">\(p_{y}\)</span> in edge <span class="math inline">\(y\)</span>. That gives two possible situations:</p>
<ul>
<li>
<span class="math inline">\(p_{y}\)</span> is an interior point of <span class="math inline">\(y\)</span>. Since <span class="math inline">\(p_{x}\)</span> and <span class="math inline">\(p_{y}\)</span> are both interior points, neither of them is already a node in the network. Then:
<ul>
<li>
<span class="math inline">\(x\)</span> is subdivided at <span class="math inline">\(p_{x}\)</span> into two new edges <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(x_{2}\)</span> and new node <span class="math inline">\(p_{x}\)</span>.</li>
<li>
<span class="math inline">\(y\)</span> is subdivided at <span class="math inline">\(p_{y}\)</span> into two new edges <span class="math inline">\(y_{1}\)</span> and <span class="math inline">\(y_{2}\)</span> and new node <span class="math inline">\(p_{y}\)</span>.</li>
<li>The new nodes <span class="math inline">\(p_{x}\)</span> and <span class="math inline">\(p_{y}\)</span> are merged into a single node <span class="math inline">\(p\)</span> with the edge set <span class="math inline">\(\{x_{1}, x_{2}, y_{1}, y_{2}\}\)</span> as incidents.</li>
</ul>
</li>
<li>
<span class="math inline">\(p_{y}\)</span> is and endpoint of <span class="math inline">\(y\)</span>. Since <span class="math inline">\(p_{y}\)</span> is an edge endpoint, it is already a node in the network. Then:
<ul>
<li>
<span class="math inline">\(x\)</span> is subdivided at <span class="math inline">\(p_{x}\)</span> into two new edges <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(x_{2}\)</span> and new node <span class="math inline">\(p_{x}\)</span>.</li>
<li>The new node <span class="math inline">\(p_{x}\)</span> is merged with node <span class="math inline">\(p_{y}\)</span> into a single node <span class="math inline">\(p\)</span> with the edge set <span class="math inline">\(\{y, x_{1}, x_{2}\}\)</span> as incidents.</li>
</ul>
</li>
</ul>
<p>Note that an edge is <em>not</em> subdivided when it crosses another edge at a location that is not an interior point or endpoint in the linestring geometry of any of the two edges.</p>
<p>For our example network, this means:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subdivision</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">to_spatial_subdivision</span><span class="op">)</span>
<span class="co">#&gt; Warning: to_spatial_subdivision assumes attributes are constant over geometries</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">points</span>, pch <span class="op">=</span> <span class="fl">4</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">subdivision</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">subdivision</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">points</span>, pch <span class="op">=</span> <span class="fl">4</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">subdivision</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-7-1.png" width="50%"><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-7-2.png" width="50%"></p>
</div>
<div id="smooth-pseudo-nodes" class="section level3">
<h3 class="hasAnchor">
<a href="#smooth-pseudo-nodes" class="anchor"></a>Smooth pseudo nodes</h3>
<p>A network may contain nodes that have only one incoming and one outgoing edge. For tasks like calculating shortest paths, such nodes are redundant, because they don’t represent a point where different directions can possibly be taken. Sometimes, these type of nodes are referred to as <em>pseudo nodes</em>. Note that their equivalent in undirected networks is any node with only two incident edges, since <em>incoming</em> and <em>outgoing</em> does not have a meaning there. Therefore, we might want to get rid of these pseudo nodes.</p>
<p>In graph theory terms this process is the opposite of subdivision and also called <em>smoothing</em>: smoothing a node <span class="math inline">\(b\)</span> with incident edges <span class="math inline">\(o = \{a, b\}\)</span> and <span class="math inline">\(p = \{b, c\}\)</span> removes <span class="math inline">\(b\)</span>, <span class="math inline">\(o\)</span> and <span class="math inline">\(p\)</span> and creates the new edge <span class="math inline">\(q = \{a, c\}\)</span>.</p>
<p>The function <code><a href="../reference/spatial_morphers.html">to_spatial_smooth()</a></code> iteratively smooths pseudo nodes, and after each removal concatenates the linestring geometries of the two affected edges together into a new, single linestring geometry.</p>
<p><em>NOTE: This function is still experimental. It needs more testing and may be slow on large networks</em></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoothed</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span><span class="va">subdivision</span>, <span class="va">to_spatial_smooth</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">subdivision</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">subdivision</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">subdivision</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-8-1.png" width="50%"><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-8-2.png" width="50%"></p>
</div>
<div id="simplify-network" class="section level3">
<h3 class="hasAnchor">
<a href="#simplify-network" class="anchor"></a>Simplify network</h3>
<p>A network may contain an edge that connects two nodes that were already connected by another edge in the network. Such an edge can be called a <em>parallel edge</em>. Also, it may contain an edge that starts and ends at the same node. Such an edge can be called a <em>loop edge</em>. In graph theory, a <em>simple graph</em> is a graph that does <em>not</em> contain parallel and loop edges.</p>
<p>The function <code><a href="../reference/spatial_morphers.html">to_spatial_simple()</a></code> simplifies a network by removing parallel and loop edges.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="va">to_spatial_simple</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">simple</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">simple</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">simple</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-9-1.png" width="50%"><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-9-2.png" width="50%"></p>
<p>When there are multiple edges connecting the same pair of nodes, which edge is marked as the ‘original’ and which as parallel edges depends on the order of the edges in the edges table. That is, by re-arranging the edges table before calling <code><a href="../reference/spatial_morphers.html">to_spatial_simple()</a></code> you can influence which edge is kept whenever parallel edges are detected. For example, you might want to always keep the edge with the shortest distance.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple</span> <span class="op">=</span> <span class="va">smoothed</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_length</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span><span class="va">to_spatial_simple</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">simple</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">sf.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/gsize.html">ecount</a></span><span class="op">(</span><span class="va">simple</span><span class="op">)</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">simple</span>, <span class="st">"nodes"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-10-1.png" width="50%"><img src="preprocess_and_clean_files/figure-html/unnamed-chunk-10-2.png" width="50%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
