<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating and representing spatial networks • sfnetworks</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="sfn02_create_represent_files/libs/quarto-html/popper.min.js"></script><script src="sfn02_create_represent_files/libs/quarto-html/tippy.umd.min.js"></script><link href="sfn02_create_represent_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sfn02_create_represent_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating and representing spatial networks">
<meta property="og:image" content="https://luukvdmeer.github.io/sfnetworks/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sfnetworks</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/sfn01_intro.html">Introduction to sfnetworks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn02_create_represent.html">Creating and representing spatial networks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn03_cleaning.html">Cleaning spatial networks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn04_join_filter.html">Spatial joins and filters</a></li>
    <li><a class="dropdown-item" href="../articles/sfn05_routing.html">Routing on spatial networks</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/luukvdmeer/sfnetworks/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating and representing spatial networks</h1>


      <p class="date">2024-11-17</p>

      <small class="dont-index">Source: <a href="https://github.com/luukvdmeer/sfnetworks/blob/main/vignettes/sfn02_create_represent.qmd" class="external-link"><code>vignettes/sfn02_create_represent.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <style type="text/css" scoped="">
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>The <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> package contains the <code>sfnetwork</code> class to represent spatial networks in R. There are several ways in which you can create instances of this class. This vignette describes these ways, and provides more detail on the ins and outs of the data structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-quantities.github.io/units/" class="external-link">units</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h2 id="the-sfnetwork-class">The sfnetwork class<a class="anchor" aria-label="anchor" href="#the-sfnetwork-class"></a>
</h2>
<p>Spatial networks in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> are represented by objects of class <code>sfnetwork</code>. These objects inherit the <code>tbl_graph</code> class from <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, which in turn inherit the <code>igraph</code> class from <a href="https://r.igraph.org/" class="external-link">igraph</a>. What this means is that in their core they are designed to store graph structures. However, thanks to the design of <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, they look like a collection of two flat tables: one for the nodes, and one for the edges. In the documentation of <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, this design choice is explained as follows.</p>
<blockquote>
<p>Relational data cannot in any meaningful way be encoded as a single tidy data frame. On the other hand, both node and edge data by itself fits very well within the tidy concept as each node and edge is, in a sense, a single observation. Thus, a close approximation of tidyness for relational data is two tidy data frames, one describing the node data and one describing the edge data.</p>
</blockquote>
<p>Since the <code>sfnetwork</code> class inherits the <code>tbl_graph</code> class, it shares the same philosophy. However, it extends it into the domain of geospatial data analysis, where each observation has a location in geographical space. For that, it brings <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> into the game. An object of class <code>sf</code> stores the geographical coordinates of each observation in standardized format in a geometry list-column, which has a coordinate reference system (CRS) associated with it. Thus, in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>, we re-formulate the last sentence of the paragraph above to the following.</p>
<blockquote>
<p>A close approximation of tidyness for relational <em>geospatial data</em> is two <em>sf objects</em>, one describing the node data and one describing the edge data.</p>
</blockquote>
<section class="level3"><h3 id="structure">Structure<a class="anchor" aria-label="anchor" href="#structure"></a>
</h3>
<p>Obviously a network is more than just a list of two distinct elements. Nodes and edges are related to each other. The first two columns of the edges table are always named <em>from</em> and <em>to</em> and contain integer indices of the source and target node of each edge. These integer indices correspond to rownumbers in the nodes table. That is, if nodes are filtered, or they order changes, the indices are updated.</p>
<p>The geometries of the nodes and edges should also match. In <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>, the following requirements are specified for a valid geospatial network:</p>
<ul>
<li>Nodes should have geometries of type <code>POINT</code>.</li>
<li>Edges should have geometries of type <code>LINESTRING</code>.</li>
<li>The endpoints of edge geometries should be spatially equal to their corresponding node geometries.</li>
<li>Nodes and edge geometries should have the same coordinate reference system and the same coordinate precision.</li>
</ul>
<p>We do need to make a note here. In a geospatial network, the nodes always have coordinates in geographic space, and thus, can always be described by an sf object. The edges, however, can also be described by only the indices of the nodes at their ends. This still makes them geospatial, because they connect two specific points in space, but the spatial information is not explicitly attached to them. Both representations can be useful. In geolocated social networks, for example, there is often no explicit spatial embedding of edges. In road networks, however, edges are usually not straight lines, and their geometries should be stored explicitly. In <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> both variants are supported: edges can be described by an sf object with their own geometries, but also by a regular tibble without a geometry column. We refer to them as <em>spatially explicit edges</em> and <em>spatially implicit edges</em>, respectively. In most of the documentation, however, we focus on the first type.</p>
<p>The figure below summarizes the structure of <code>sfnetwork</code> objects.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure><p><img src="figures/data-structure.png"></p>
</figure>
</div>
</div>
</div>
<p>Just like in <code>tbl_graph</code> objects, there is always one element (nodes or edges) in an <code>sfnetwork</code> object that is <em>active</em>. This means that element is the main target of analysis. By default, nodes are the active element when creating a network. The active element can be changed using the <code><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate()</a></code> verb, which will also change the order in which the elements are printed.</p>
<p>In practice, it all looks as follows. Note that here we create the network from a set of spatial lines, by creating nodes at their endpoints. See the section <a href="#creating-sfnetwork-objects">Creating sfnetwork objects</a> for many more examples on how to create a spatial network.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Spatially explicit edges.</span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">roxel</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 987 nodes and 1215 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed multigraph with 9 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 7.522595 ymin: 51.94151 xmax: 7.546705 ymax: 51.96119</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 987 × 1 (active)</span></span>
<span><span class="co">#&gt;              geometry</span></span>
<span><span class="co">#&gt;           &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1 (7.538109 51.95286)</span></span>
<span><span class="co">#&gt; 2 (7.537867 51.95282)</span></span>
<span><span class="co">#&gt; 3 (7.537815 51.95867)</span></span>
<span><span class="co">#&gt; 4 (7.537015 51.95848)</span></span>
<span><span class="co">#&gt; 5 (7.533441 51.95578)</span></span>
<span><span class="co">#&gt; 6 (7.533415 51.95561)</span></span>
<span><span class="co">#&gt; # ℹ 981 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 1,215 × 5</span></span>
<span><span class="co">#&gt;    from    to name               type                                   geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                          &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2 Hagemanns Kämpken  residential (7.538109 51.95286, 7.537867 51.95…</span></span>
<span><span class="co">#&gt; 2     3     4 Stiegkamp          residential (7.537815 51.95867, 7.537015 51.95…</span></span>
<span><span class="co">#&gt; 3     5     6 Havixbecker Straße residential (7.533441 51.95578, 7.533467 51.95…</span></span>
<span><span class="co">#&gt; # ℹ 1,212 more rows</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make edges spatially implicit.</span></span>
<span><span class="va">inet</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inet</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 987 nodes and 1215 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed multigraph with 9 components and spatially implicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 7.522595 ymin: 51.94151 xmax: 7.546705 ymax: 51.96119</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 1,215 × 4 (active)</span></span>
<span><span class="co">#&gt;    from    to name                               type</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                              &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1     2 Hagemanns Kämpken                  residential</span></span>
<span><span class="co">#&gt; 2     3     4 Stiegkamp                          residential</span></span>
<span><span class="co">#&gt; 3     5     6 Havixbecker Straße                 residential</span></span>
<span><span class="co">#&gt; 4     7     8 Holzschuhmacherweg                 residential</span></span>
<span><span class="co">#&gt; 5     9    10 Annette-von-Droste-Hülshoff-Straße secondary</span></span>
<span><span class="co">#&gt; 6    11    12 NA                                 footway</span></span>
<span><span class="co">#&gt; # ℹ 1,209 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 987 × 1</span></span>
<span><span class="co">#&gt;              geometry</span></span>
<span><span class="co">#&gt;           &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1 (7.538109 51.95286)</span></span>
<span><span class="co">#&gt; 2 (7.537867 51.95282)</span></span>
<span><span class="co">#&gt; 3 (7.537815 51.95867)</span></span>
<span><span class="co">#&gt; # ℹ 984 more rows</span></span></code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">inet</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html" class="external-link">geom_edge_link</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<figcaption>Spatially explicit edges</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<figcaption>Spatially implicit edges</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section class="level3"><h3 id="directionality">Directionality<a class="anchor" aria-label="anchor" href="#directionality"></a>
</h3>
<p>With <code>sfnetwork</code> objects it is possible to represent networks with directed edges, and with undirected edges. It is also possible to mimic mixed representations in which both these edge types exist.</p>
<section class="level4"><h4 id="directed-networks">Directed networks<a class="anchor" aria-label="anchor" href="#directed-networks"></a>
</h4>
<p>By default an instance of the <code>sfnetwork</code> class will be initialized as a directed network. That means that each edge can only be traveled in from the source node to the target node, and not vice versa. In this case, the geometry of the edge always matches the direction, with the startpoint of the line being the location of the source node, and the endpoint of the line the location of the target node.</p>
</section><section class="level4"><h4 id="undirected-networks">Undirected networks<a class="anchor" aria-label="anchor" href="#undirected-networks"></a>
</h4>
<p>The <code>sfnetwork</code> data structure also supports undirected networks. In such networks each edge can be traveled in both directions. Since there is no clear source and target, the node with the lowest index will be referenced in the <em>from</em> column, and the node with the highest index in the <em>to</em> column. The linestring geometry, however, remains unchanged. That is, in undirected networks the specified source node may not always correspond with the startpoint of the edge geometry, but instead with the endpoint. The behavior of ordering the indices comes from <a href="https://r.igraph.org/" class="external-link">igraph</a> and might be confusing, but remember that in undirected networks the terms <em>from</em> and <em>to</em> do not have a meaning and can thus be used interchangeably. If for a computation you really need the edge geometries to match the specified node indices, you can use the utility function <code><a href="../reference/make_edges_follow_indices.html">make_edges_follow_indices()</a></code>. This function will reverse edge geometries where needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">roxel</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 987 nodes and 1215 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An undirected multigraph with 9 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 7.522595 ymin: 51.94151 xmax: 7.546705 ymax: 51.96119</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 987 × 1 (active)</span></span>
<span><span class="co">#&gt;              geometry</span></span>
<span><span class="co">#&gt;           &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1 (7.538109 51.95286)</span></span>
<span><span class="co">#&gt; 2 (7.537867 51.95282)</span></span>
<span><span class="co">#&gt; 3 (7.537815 51.95867)</span></span>
<span><span class="co">#&gt; 4 (7.537015 51.95848)</span></span>
<span><span class="co">#&gt; 5 (7.533441 51.95578)</span></span>
<span><span class="co">#&gt; 6 (7.533415 51.95561)</span></span>
<span><span class="co">#&gt; # ℹ 981 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 1,215 × 5</span></span>
<span><span class="co">#&gt;    from    to name               type                                   geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                          &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2 Hagemanns Kämpken  residential (7.538109 51.95286, 7.537867 51.95…</span></span>
<span><span class="co">#&gt; 2     3     4 Stiegkamp          residential (7.537815 51.95867, 7.537015 51.95…</span></span>
<span><span class="co">#&gt; 3     5     6 Havixbecker Straße residential (7.533441 51.95578, 7.533467 51.95…</span></span>
<span><span class="co">#&gt; # ℹ 1,212 more rows</span></span></code></pre>
</div>
</section><section class="level4"><h4 id="mixed-networks">Mixed networks<a class="anchor" aria-label="anchor" href="#mixed-networks"></a>
</h4>
<p>In <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> there is no native support to represent mixed networks, i.e. networks in which some edges can be traveled in both ways, and others in only one way. However, these type of networks are quite common in some applications of spatial network analysis. For example, road networks in which some streets are oneway streets. By creating a directed network, but duplicating and reversing those edges that should be undirected, you can mimic such a mixed network structure. The morpher <code><a href="../reference/spatial_morphers.html">to_spatial_mixed()</a></code> does exactly that. Since some of the <a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn03_cleaning.html">network cleaning</a> functions do not work well with duplicated and reversed edges, it is usually a good idea to first create the directed network, clean it, and only then mimic the mixed representation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First we mark some streets as oneway.</span></span>
<span><span class="va">streets</span> <span class="op">=</span> <span class="va">roxel</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>oneway <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="../reference/n.html">n</a></span><span class="op">(</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the distribution of oneway vs twoway streets.</span></span>
<span><span class="va">streets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">oneway</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   oneway     n</span></span>
<span><span class="co">#&gt;   &lt;lgl&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 FALSE    236</span></span>
<span><span class="co">#&gt; 2 TRUE     979</span></span></code></pre>
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a directed network.</span></span>
<span><span class="va">dnet</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">streets</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the number of edges in the directed network.</span></span>
<span><span class="co"># This equals the total number of streets.</span></span>
<span><span class="fu"><a href="../reference/n.html">n_edges</a></span><span class="op">(</span><span class="va">dnet</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1215</span></span>
<span></span>
<span><span class="co"># Convert it into a mixed network.</span></span>
<span><span class="co"># Oneway streets remain directed.</span></span>
<span><span class="co"># Twoway streets are duplicated and reversed.</span></span>
<span><span class="va">mnet</span> <span class="op">=</span> <span class="va">dnet</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">to_spatial_mixed</span>, directed <span class="op">=</span> <span class="va">oneway</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check number of edges in the mixed network.</span></span>
<span><span class="co"># This equals the number of oneway streets ...</span></span>
<span><span class="co"># ... plus twice the number of twoway streets.</span></span>
<span><span class="fu"><a href="../reference/n.html">n_edges</a></span><span class="op">(</span><span class="va">mnet</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1451</span></span></code></pre></div>
</div>
</section></section><section class="level3"><h3 id="geometries">Geometries<a class="anchor" aria-label="anchor" href="#geometries"></a>
</h3>
<p>What makes <code>sfnetwork</code> objects different from <code>tbl_graph</code> objects is that nodes and (optionally) edges have geometries. These geometries are stored in a geometry list-column, following the design of <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>. That also means that just as in <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>, these columns are “sticky”, and will survive column subsetting operations.</p>
<section class="level4"><h4 id="extract-geometries">Extract geometries<a class="anchor" aria-label="anchor" href="#extract-geometries"></a>
</h4>
<p>Like in <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>, you can always extract geometries of the active network element using <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">sf::st_geometry()</a></code>. The shortcuts <code>st_geometry(x, "nodes")</code> and <code>st_geometry(net, "edges")</code> can be used to extract geometries of a network element, regardless if it is active or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Geometry set for 1215 features </span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 7.522595 ymin: 51.94151 xmax: 7.546705 ymax: 51.96119</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 5 geometries:</span></span>
<span><span class="co">#&gt; LINESTRING (7.538109 51.95286, 7.537867 51.95282)</span></span>
<span><span class="co">#&gt; LINESTRING (7.537815 51.95867, 7.537015 51.95848)</span></span>
<span><span class="co">#&gt; LINESTRING (7.533441 51.95578, 7.533467 51.9557...</span></span>
<span><span class="co">#&gt; LINESTRING (7.525977 51.95283, 7.526581 51.95293)</span></span>
<span><span class="co">#&gt; LINESTRING (7.532301 51.95559, 7.532214 51.9557...</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="replace-geometries">Replace geometries<a class="anchor" aria-label="anchor" href="#replace-geometries"></a>
</h4>
<p>The other way around, you can also replace geometries using the setter function <code>sf::set_set_geometry()</code> (or alternatively: <code>st_geometry(x) = new</code>). New node geometries are required to be of geometry type <code>POINT</code>, and new edge geometries of geometry type <code>LINESTRING</code>. To preserve the valid spatial network structure, the following is done:</p>
<ul>
<li>When replacing node geometries, the endpoints of edge geometries will be replaced as well to match the new node geometries.</li>
<li>When replacing edge geometries, the endpoints of those geometries are added as new nodes to the network whenever they don’t equal their original location. The original nodes remain in the network even if they are now isolated.</li>
</ul>
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orig_net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"gabriel"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">orig_nodes</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">orig_net</span>, <span class="st">"nodes"</span><span class="op">)</span></span>
<span><span class="va">new_nodes</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_jitter.html" class="external-link">st_jitter</a></span><span class="op">(</span><span class="va">orig_nodes</span>, <span class="fl">250</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_net</span> <span class="op">=</span> <span class="va">orig_net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="va">new_nodes</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">orig_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_nodes</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">new_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">orig_nodes</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"orange"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<figcaption>Original network</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-11-2.png" width="672"></p>
<figcaption>New network</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section class="level4"><h4 id="drop-geometries">Drop geometries<a class="anchor" aria-label="anchor" href="#drop-geometries"></a>
</h4>
<p>You can drop geometries using <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">sf::st_drop_geometry()</a></code> (or alternatively: <code>st_geometry(x) = NULL</code>). As already shown in the previous section, dropping edge geometries will still return a <code>sfnetwork</code> object, but now with spatially implicit instead of spatially explicit edges. Dropping node geometries, however, will return a <code>tbl_graph</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tbl_graph: 987 nodes and 1215 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed multigraph with 9 components</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node Data: 987 × 0 (active)</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge Data: 1,215 × 5</span></span>
<span><span class="co">#&gt;    from    to name               type                                   geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                          &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2 Hagemanns Kämpken  residential (7.538109 51.95286, 7.537867 51.95…</span></span>
<span><span class="co">#&gt; 2     3     4 Stiegkamp          residential (7.537815 51.95867, 7.537015 51.95…</span></span>
<span><span class="co">#&gt; 3     5     6 Havixbecker Straße residential (7.533441 51.95578, 7.533467 51.95…</span></span>
<span><span class="co">#&gt; # ℹ 1,212 more rows</span></span></code></pre>
</div>
</section><section class="level4"><h4 id="bounding-box">Bounding box<a class="anchor" aria-label="anchor" href="#bounding-box"></a>
</h4>
<p>The area that geometries occupy is bounded by their bounding box. You can use <code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">sf::st_bbox()</a></code> to compute the bounding box of the active element in a <code>sfnetwork</code> object. To compute the bounding box of the full network, use <code><a href="../reference/st_network_bbox.html">st_network_bbox()</a></code>. In some cases, the network bounding box may be different than the bounding box of the nodes only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nodes</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">p4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edges</span><span class="op">$</span><span class="va">from</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">edges</span><span class="op">$</span><span class="va">to</span> <span class="op">=</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">G</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span><span class="op">)</span></span>
<span></span>
<span><span class="va">node_bbox</span> <span class="op">=</span> <span class="va">G</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edge_bbox</span> <span class="op">=</span> <span class="va">G</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net_bbox</span> <span class="op">=</span> <span class="va">G</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/st_network_bbox.html">st_network_bbox</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">G</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">node_bbox</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#F8766D"</span>, fill <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>, linetype <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">edge_bbox</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#619CFF"</span>, fill <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>, linetype <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">G</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">net_bbox</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"orange"</span>, fill <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>, linetype <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<figcaption>Element bounding boxes</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-14-2.png" width="672"></p>
<figcaption>Network bounding box</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section class="level4"><h4 id="coordinate-reference-system">Coordinate reference system<a class="anchor" aria-label="anchor" href="#coordinate-reference-system"></a>
</h4>
<p>The coordinates of geometries are always expressed in a specified coordinate reference system (CRS). In a <code>sfnetwork</code> object, the CRS of the node and edge geometries is required to be equal. You can extract the CRS using <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">sf::st_crs()</a></code>. To transform coordinates into a different CRS, use <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code>, while specifying for example the EPSG code of the new CRS (other ways of specifying are possible as well, see the documentation of <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">3035</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 987 nodes and 1215 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed multigraph with 9 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4150707 ymin: 3206375 xmax: 4152366 ymax: 3208564</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 987 × 1 (active)</span></span>
<span><span class="co">#&gt;            geometry</span></span>
<span><span class="co">#&gt;         &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt; 1 (4151782 3207612)</span></span>
<span><span class="co">#&gt; 2 (4151765 3207609)</span></span>
<span><span class="co">#&gt; 3 (4151784 3208259)</span></span>
<span><span class="co">#&gt; 4 (4151728 3208240)</span></span>
<span><span class="co">#&gt; 5 (4151472 3207948)</span></span>
<span><span class="co">#&gt; 6 (4151470 3207929)</span></span>
<span><span class="co">#&gt; # ℹ 981 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 1,215 × 5</span></span>
<span><span class="co">#&gt;    from    to name               type                                   geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                          &lt;LINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2 Hagemanns Kämpken  residential  (4151782 3207612, 4151765 3207609)</span></span>
<span><span class="co">#&gt; 2     3     4 Stiegkamp          residential  (4151784 3208259, 4151728 3208240)</span></span>
<span><span class="co">#&gt; 3     5     6 Havixbecker Straße residential (4151472 3207948, 4151474 3207941,…</span></span>
<span><span class="co">#&gt; # ℹ 1,212 more rows</span></span></code></pre>
</div>
</section><section class="level4"><h4 id="coordinate-precision">Coordinate precision<a class="anchor" aria-label="anchor" href="#coordinate-precision"></a>
</h4>
<p>Geometries also have a coordinate precision associated with them. This precision does not round the coordinate values, but will be applied during spatial operations. Just as with the CRS, nodes and edges in a <code>sfnetwork</code> object are required to have the same precision. You can extract the precision using <code><a href="https://r-spatial.github.io/sf/reference/st_precision.html" class="external-link">sf::st_precision()</a></code>, and set it using <code><a href="https://r-spatial.github.io/sf/reference/st_precision.html" class="external-link">sf::st_set_precision()</a></code>. Precision values should be specified as a scale factor. For example, to specify 3 decimal places of precision, use a scale factor of 1000. When no precision is specified, it defaults to machine precision. However, in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>, functions that assess the spatial equality of nodes use a default precision of 1e12 (i.e. 12 decimal places) to speed up processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># With unspecified precision, no node is equal to another node.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_equals</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="co"># With an extremely low precision, all nodes are equal to each other.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_equals</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_precision.html" class="external-link">st_set_precision</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="../reference/n.html">n_nodes</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="attribute-geometry-relations">Attribute-geometry relations<a class="anchor" aria-label="anchor" href="#attribute-geometry-relations"></a>
</h4>
<p>Thanks to <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>, it is also possible to explicitly specify attribute-geometry relations. These define for each attribute column if the attribute is a constant, an aggregate, or an identity. See <a href="https://r-spatial.github.io/sf/articles/sf1.html#how-attributes-relate-to-geometries" class="external-link">here</a> for more information. You can get and set attribute-geometry relations of the active network element with the function <code><a href="https://r-spatial.github.io/sf/reference/st_agr.html" class="external-link">sf::st_agr()</a></code>. For the setter, you can also use the pipe-friendly version <code><a href="https://r-spatial.github.io/sf/reference/st_agr.html" class="external-link">sf::st_set_agr()</a></code>. Note that the <em>to</em> and <em>from</em> columns are not really attributes of edges seen from a network analysis perspective, but they are included in the attribute-geometry relation specification to ensure smooth interaction with <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_agr.html" class="external-link">st_agr</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     from       to     name     type </span></span>
<span><span class="co">#&gt;     &lt;NA&gt;     &lt;NA&gt; constant constant </span></span>
<span><span class="co">#&gt; Levels: constant aggregate identity</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_agr.html" class="external-link">st_set_agr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"aggregate"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_agr.html" class="external-link">st_agr</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      from        to      name      type </span></span>
<span><span class="co">#&gt;      &lt;NA&gt;      &lt;NA&gt;  constant aggregate </span></span>
<span><span class="co">#&gt; Levels: constant aggregate identity</span></span></code></pre></div>
</div>
</section></section></section><section class="level2"><h2 id="creating-sfnetwork-objects">Creating sfnetwork objects<a class="anchor" aria-label="anchor" href="#creating-sfnetwork-objects"></a>
</h2>
<p>There are several ways to create a <code>sfnetwork</code> object, which are discussed in more detail below.</p>
<section class="level3"><h3 id="from-node-and-edge-tables">From node and edge tables<a class="anchor" aria-label="anchor" href="#from-node-and-edge-tables"></a>
</h3>
<p>The most basic way to create a <code>sfnetwork</code> object is to provide ready-to-use node and edge tables to the <code><a href="../reference/sfnetwork.html">sfnetwork()</a></code> construction function. Remember that the nodes should be an <code>sf</code> object with <code>POINT</code> geometries, while the first two columns in the edges table are required to be named <em>from</em> and <em>to</em> and contain the rownumbers of the nodes at the start and end of each edge. If the edges are spatially explicit, and hence, also have geometries, these should be of type <code>LINESTRING</code> and their endpoints should equal the locations of their source and target nodes. The construction function will check if the provided input meets these criteria. If you are already sure your data forms a valid spatial network, you can set <code>force = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">53</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">l1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">l2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">l3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">p1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span>, <span class="va">l3</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">nodes</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edges</span><span class="op">$</span><span class="va">from</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">edges</span><span class="op">$</span><span class="va">to</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 3 nodes and 3 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed simple graph with 1 component and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 6 ymin: 51 xmax: 8 ymax: 53</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 3 × 1 (active)</span></span>
<span><span class="co">#&gt;      geometry</span></span>
<span><span class="co">#&gt;   &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1      (6 52)</span></span>
<span><span class="co">#&gt; 2      (8 53)</span></span>
<span><span class="co">#&gt; 3      (8 51)</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 3 × 3</span></span>
<span><span class="co">#&gt;    from    to         geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2     (6 52, 8 53)</span></span>
<span><span class="co">#&gt; 2     2     3     (8 53, 8 51)</span></span>
<span><span class="co">#&gt; 3     3     1     (8 51, 6 52)</span></span></code></pre>
</div>
<p>It is also possible to provide nodes that are not an <code>sf</code> object, but can be converted to it. For example, a table with two coordinate columns. Any additional arguments provided to the <code><a href="../reference/sfnetwork.html">sfnetwork()</a></code> construction function will be forwarded to <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">sf::st_as_sf()</a></code> to convert the provided nodes table into a <code>sf</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nodes_tbl</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">52</span>, <span class="fl">53</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes_tbl</span>, <span class="va">edges</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 3 nodes and 3 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed simple graph with 1 component and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 6 ymin: 51 xmax: 8 ymax: 53</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 3 × 1 (active)</span></span>
<span><span class="co">#&gt;      geometry</span></span>
<span><span class="co">#&gt;   &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1      (6 52)</span></span>
<span><span class="co">#&gt; 2      (8 53)</span></span>
<span><span class="co">#&gt; 3      (8 51)</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 3 × 3</span></span>
<span><span class="co">#&gt;    from    to         geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2     (6 52, 8 53)</span></span>
<span><span class="co">#&gt; 2     2     3     (8 53, 8 51)</span></span>
<span><span class="co">#&gt; 3     3     1     (8 51, 6 52)</span></span></code></pre>
</div>
<p>Instead of integers referring to rownumbers in the nodes table, the <em>from</em> and <em>to</em> columns in the edges table can also contain characters that refer to values in a specific node attribute column. The name of that column should than be given as argument <code>node_key</code>. By default, it is assumed the column is named <em>name</em>. Internally, the construction function will convert the character values into integer indices referencing rownumbers.</p>
<p>If your edges do not have geometries, you can still create a network with spatially explicit edges by setting <code>edges_as_lines = TRUE</code>. This will create linestring geometries as straight lines between the source and target nodes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nodes</span><span class="op">$</span><span class="va">type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"city"</span>, <span class="st">"village"</span>, <span class="st">"farm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span></span>
<span><span class="va">edges</span><span class="op">$</span><span class="va">from</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"city"</span>, <span class="st">"village"</span>, <span class="st">"farm"</span><span class="op">)</span></span>
<span><span class="va">edges</span><span class="op">$</span><span class="va">to</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"village"</span>, <span class="st">"farm"</span>, <span class="st">"city"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span>, node_key <span class="op">=</span> <span class="st">"type"</span>, edges_as_lines <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 3 nodes and 3 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A bipartite simple graph with 1 component and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 6 ymin: 51 xmax: 8 ymax: 53</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 3 × 2 (active)</span></span>
<span><span class="co">#&gt;      geometry type</span></span>
<span><span class="co">#&gt;   &lt;POINT [°]&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1      (6 52) city</span></span>
<span><span class="co">#&gt; 2      (8 53) village</span></span>
<span><span class="co">#&gt; 3      (8 51) farm</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 3 × 3</span></span>
<span><span class="co">#&gt;    from    to         geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2     (6 52, 8 53)</span></span>
<span><span class="co">#&gt; 2     2     3     (8 53, 8 51)</span></span>
<span><span class="co">#&gt; 3     3     1     (8 51, 6 52)</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="from-spatial-lines">From spatial lines<a class="anchor" aria-label="anchor" href="#from-spatial-lines"></a>
</h3>
<p>A more common way to create a spatial network is to start with only a set of <code>LINESTRING</code> geometries in <code>sf</code> format. These are assumed to be the edge of the network. Providing this to <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> will automatically call <code><a href="../reference/create_from_spatial_lines.html">create_from_spatial_lines()</a></code>. This function creates nodes at the endpoints of the lines. Endpoints that are shared between multiple lines, become a single node in the network.</p>
<p>To determine spatial equality of endpoints, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> by default uses a 12-digit precision for the coordinates. You can change this by either setting a different precision (see <a href="#coordinate-precision">above</a>) or by effectively rounding coordinate values using the utility function <code><a href="../reference/st_round.html">st_round()</a></code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linestring geometries.</span></span>
<span><span class="va">roxel</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 1215 features and 2 fields</span></span>
<span><span class="co">#&gt; Attribute-geometry relationships: constant (2)</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 7.522595 ymin: 51.94151 xmax: 7.546705 ymax: 51.96119</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 1,215 × 3</span></span>
<span><span class="co">#&gt;    name                               type                              geometry</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                              &lt;chr&gt;                     &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt;  1 Hagemanns Kämpken                  residential (7.538109 51.95286, 7.537867 …</span></span>
<span><span class="co">#&gt;  2 Stiegkamp                          residential (7.537815 51.95867, 7.537015 …</span></span>
<span><span class="co">#&gt;  3 Havixbecker Straße                 residential (7.533441 51.95578, 7.533467 …</span></span>
<span><span class="co">#&gt;  4 Holzschuhmacherweg                 residential (7.525977 51.95283, 7.526581 …</span></span>
<span><span class="co">#&gt;  5 Annette-von-Droste-Hülshoff-Straße secondary   (7.532301 51.95559, 7.532214 …</span></span>
<span><span class="co">#&gt;  6 NA                                 footway     (7.543404 51.94779, 7.54358 5…</span></span>
<span><span class="co">#&gt;  7 Deermannskamp                      residential (7.537675 51.95689, 7.537904 …</span></span>
<span><span class="co">#&gt;  8 Lindenstraße                       residential (7.539105 51.9504, 7.540105 5…</span></span>
<span><span class="co">#&gt;  9 NA                                 NA          (7.534875 51.95795, 7.534819 …</span></span>
<span><span class="co">#&gt; 10 Annette-von-Droste-Hülshoff-Straße secondary   (7.532465 51.95424, 7.532469 …</span></span>
<span><span class="co">#&gt; # ℹ 1,205 more rows</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Network.</span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">roxel</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 987 nodes and 1215 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed multigraph with 9 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 7.522595 ymin: 51.94151 xmax: 7.546705 ymax: 51.96119</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 987 × 1 (active)</span></span>
<span><span class="co">#&gt;              geometry</span></span>
<span><span class="co">#&gt;           &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1 (7.538109 51.95286)</span></span>
<span><span class="co">#&gt; 2 (7.537867 51.95282)</span></span>
<span><span class="co">#&gt; 3 (7.537815 51.95867)</span></span>
<span><span class="co">#&gt; 4 (7.537015 51.95848)</span></span>
<span><span class="co">#&gt; 5 (7.533441 51.95578)</span></span>
<span><span class="co">#&gt; 6 (7.533415 51.95561)</span></span>
<span><span class="co">#&gt; # ℹ 981 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 1,215 × 5</span></span>
<span><span class="co">#&gt;    from    to name               type                                   geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                          &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2 Hagemanns Kämpken  residential (7.538109 51.95286, 7.537867 51.95…</span></span>
<span><span class="co">#&gt; 2     3     4 Stiegkamp          residential (7.537815 51.95867, 7.537015 51.95…</span></span>
<span><span class="co">#&gt; 3     5     6 Havixbecker Straße residential (7.533441 51.95578, 7.533467 51.95…</span></span>
<span><span class="co">#&gt; # ℹ 1,212 more rows</span></span></code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">roxel</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<figcaption>Lines</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-25-2.png" width="672"></p>
<figcaption>Network</figcaption></figure>
</div>
</div>
</div>
</div>
<p>Besides their endpoints, linestring geometries may have interior points that define their shape. It may be that multiple linestrings have interior points at the same location. Since these are not endpoints, they will not become a node in the network. If you also want to add nodes at shared interior points, set <code>subdivide = TRUE</code>, or call the <code><a href="../reference/spatial_morphers.html">to_spatial_subdivision()</a></code> morpher after construction. See the vignette on <a href="">Spatial morphers</a> for details.</p>
</section><section class="level3"><h3 id="from-spatial-points">From spatial points<a class="anchor" aria-label="anchor" href="#from-spatial-points"></a>
</h3>
<p>It is also possible to create a network from a set of <code>POINT</code> geometries. These are assumed to be the nodes of the network. Providing this to <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> will automatically call <code><a href="../reference/create_from_spatial_points.html">create_from_spatial_points()</a></code>. As a second input it requires an adjacency matrix that specifies which nodes should be connected to each other. Adjacency matrices of networks are <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math> matrices with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> being the number of nodes, and element <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">A_{ij}</annotation></semantics></math> holding a value if there is an edge from node <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> to node <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>, and a value otherwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Point geometries.</span></span>
<span><span class="va">mozart</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 17 features and 3 fields</span></span>
<span><span class="co">#&gt; Attribute-geometry relationships: constant (3)</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 17 × 4</span></span>
<span><span class="co">#&gt;    name                    type          website                geometry</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt;                   &lt;chr&gt;         &lt;chr&gt;               &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt;  1 Mozartkino              cinema        https://www.… (4549504 2747309)</span></span>
<span><span class="co">#&gt;  2 Haus für Mozart         theatre       NA            (4549003 2747376)</span></span>
<span><span class="co">#&gt;  3 Mozartsteg/Rudolfskai   bus_stop      NA            (4549589 2747507)</span></span>
<span><span class="co">#&gt;  4 Mozart Denkmal          artwork       NA            (4549387 2747514)</span></span>
<span><span class="co">#&gt;  5 Mozartsteg/Rudolfskai   bus_stop      NA            (4549491 2747551)</span></span>
<span><span class="co">#&gt;  6 Mozartsteg              bridge        NA            (4549473 2747624)</span></span>
<span><span class="co">#&gt;  7 Mozarts Geburtshaus     museum        http://www.m… (4549064 2747619)</span></span>
<span><span class="co">#&gt;  8 Café Mozart             cafe          https://www.… (4548994 2747632)</span></span>
<span><span class="co">#&gt;  9 Mozartkugel             confectionery NA            (4549120 2747654)</span></span>
<span><span class="co">#&gt; 10 Mozartsteg/Imbergstraße bus_stop      NA            (4549418 2747723)</span></span>
<span><span class="co">#&gt; 11 Spirit of Mozart        artwork       https://salz… (4549119 2747790)</span></span>
<span><span class="co">#&gt; 12 Mozart-Eine Hommage     artwork       https://salz… (4548664 2747868)</span></span>
<span><span class="co">#&gt; 13 Mozarts Wohnhaus        apartments    NA            (4549073 2747916)</span></span>
<span><span class="co">#&gt; 14 Universität Mozarteum   university    NA            (4549059 2748042)</span></span>
<span><span class="co">#&gt; 15 Stiftung Mozarteum      concert_hall  NA            (4548897 2748037)</span></span>
<span><span class="co">#&gt; 16 Hotel Mozart            hotel         http://www.h… (4549378 2748391)</span></span>
<span><span class="co">#&gt; 17 Mozart Studentenheim    dormitory     NA            (4548984 2748537)</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Adjacency matrix.</span></span>
<span><span class="va">adj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">17</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fl">17</span><span class="op">)</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Network.</span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="va">adj</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 17 nodes and 17 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A bipartite multigraph with 1 component and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 17 × 4 (active)</span></span>
<span><span class="co">#&gt;   name                  type     website                        geometry</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;                       &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartkino            cinema   https://www.mozartki… (4549504 2747309)</span></span>
<span><span class="co">#&gt; 2 Haus für Mozart       theatre  NA                    (4549003 2747376)</span></span>
<span><span class="co">#&gt; 3 Mozartsteg/Rudolfskai bus_stop NA                    (4549589 2747507)</span></span>
<span><span class="co">#&gt; 4 Mozart Denkmal        artwork  NA                    (4549387 2747514)</span></span>
<span><span class="co">#&gt; 5 Mozartsteg/Rudolfskai bus_stop NA                    (4549491 2747551)</span></span>
<span><span class="co">#&gt; 6 Mozartsteg            bridge   NA                    (4549473 2747624)</span></span>
<span><span class="co">#&gt; # ℹ 11 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 17 × 3</span></span>
<span><span class="co">#&gt;    from    to                           geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                   &lt;LINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1     1     1 (4549504 2747309, 4549504 2747309)</span></span>
<span><span class="co">#&gt; 2     2     1 (4549003 2747376, 4549504 2747309)</span></span>
<span><span class="co">#&gt; 3     3     1 (4549589 2747507, 4549504 2747309)</span></span>
<span><span class="co">#&gt; # ℹ 14 more rows</span></span></code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mozart</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
<figcaption>Points</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-28-2.png" width="672"></p>
<figcaption>Network</figcaption></figure>
</div>
</div>
</div>
</div>
<p>The adjacency matrix can also be provided in sparse form, where for each node the indices of the nodes it is connected to are listed. This allows to directly forward the output of a <a href="https://r-spatial.github.io/sf/articles/sf3.html#binary-logical-operations" class="external-link">binary spatial predicate</a>. For example, using <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">sf::st_is_within_distance()</a></code>, we can connect nodes that are within a given distance from each other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_is_within_distance</a></span><span class="op">(</span><span class="va">mozart</span>, dist <span class="op">=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">250</span>, <span class="st">"m"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">adj</span></span>
<span><span class="co">#&gt; Sparse geometry binary predicate list of length 17, where the predicate</span></span>
<span><span class="co">#&gt; was `is_within_distance'</span></span>
<span><span class="co">#&gt; first 10 elements:</span></span>
<span><span class="co">#&gt;  1: 1, 3, 4, 5</span></span>
<span><span class="co">#&gt;  2: 2</span></span>
<span><span class="co">#&gt;  3: 1, 3, 4, 5, 6</span></span>
<span><span class="co">#&gt;  4: 1, 3, 4, 5, 6, 10</span></span>
<span><span class="co">#&gt;  5: 1, 3, 4, 5, 6, 10</span></span>
<span><span class="co">#&gt;  6: 3, 4, 5, 6, 10</span></span>
<span><span class="co">#&gt;  7: 7, 8, 9, 11</span></span>
<span><span class="co">#&gt;  8: 7, 8, 9, 11</span></span>
<span><span class="co">#&gt;  9: 7, 8, 9, 11</span></span>
<span><span class="co">#&gt;  10: 4, 5, 6, 10</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="va">adj</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mozart</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-31-1.png" width="672"></p>
<figcaption>Points</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-31-2.png" width="672"></p>
<figcaption>Network</figcaption></figure>
</div>
</div>
</div>
</div>
<p>Finally, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> can create the adjacency matrix internally according to some specified method. In that case, you just need to provide the name of the method. Supported options currently are:</p>
<ul>
<li>
<code>complete</code>: All nodes are directly connected to each other.</li>
<li>
<code>sequence</code>: The nodes are sequentially connected to each other, meaning that the first node is connected to the second node, the second node is connected to the third node, etc.</li>
<li>
<code>minimum_spanning_tree</code>: The nodes are connected by their spatial <a href="https://en.wikipedia.org/wiki/Minimum_spanning_tree" class="external-link">minimum spanning tree</a>, i.e. the set of edges with the minimum total edge length required to connect all nodes. Can also be specified as <code>mst</code>.</li>
<li>
<code>delaunay</code>: The nodes are connected by their <a href="https://en.wikipedia.org/wiki/Delaunay_triangulation" class="external-link">Delaunay triangulation</a>. Requires the <a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a> package to be installed, and assumes planar coordinates.</li>
<li>
<code>gabriel</code>: The nodes are connected as a <a href="https://en.wikipedia.org/wiki/Gabriel_graph" class="external-link">Gabriel graph</a>. Requires the <a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a> package to be installed, and assumes planar coordinates.</li>
<li>
<code>relative_neighborhood</code>: The nodes are connected as a <a href="https://en.wikipedia.org/wiki/Relative_neighborhood_graph" class="external-link">relative neighborhood graph</a>. Can also be specified as <code>rn</code>. Requires the <a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a> package to be installed, and assumes planar coordinates.</li>
<li>
<code>nearest_neighbors</code>: Each node is connected to its <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> nearest neighbors, with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> being specified through the <code>k</code> argument. By default, <code>k = 1</code>, meaning that the nodes are connected as a <a href="https://en.wikipedia.org/wiki/Nearest_neighbor_graph" class="external-link">nearest neighbor graph</a>. Can also be specified as <code>knn</code>. Requires the <a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a> package to be installed.</li>
</ul>
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_ggraph</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">make_ggraph</span><span class="op">(</span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"complete"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">make_ggraph</span><span class="op">(</span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"sequence"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">make_ggraph</span><span class="op">(</span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"mst"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">make_ggraph</span><span class="op">(</span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"delaunay"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">make_ggraph</span><span class="op">(</span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"gabriel"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">make_ggraph</span><span class="op">(</span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"rn"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">make_ggraph</span><span class="op">(</span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"knn"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in spdep::knn2nb(spdep::knearneigh(st_geometry(x), k = k), sym =</span></span>
<span><span class="co">#&gt; FALSE): neighbour object has 4 sub-graphs</span></span>
<span><span class="fu">make_ggraph</span><span class="op">(</span><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"knn"</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in spdep::knn2nb(spdep::knearneigh(st_geometry(x), k = k), sym =</span></span>
<span><span class="co">#&gt; FALSE): neighbour object has 2 sub-graphs</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-nrow="4" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-32-1.png" width="672"></p>
<figcaption>Complete</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-32-2.png" width="672"></p>
<figcaption>Sequential</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-32-3.png" width="672"></p>
<figcaption>Minimum spanning tree</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-32-4.png" width="672"></p>
<figcaption>Delaunay triangulation</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-32-5.png" width="672"></p>
<figcaption>Gabriel</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-32-6.png" width="672"></p>
<figcaption>Relative neighbors</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-32-7.png" width="672"></p>
<figcaption>Nearest neighbors</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-32-8.png" width="672"></p>
<figcaption>K nearest neighbors (k = 3)</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section class="level3"><h3 id="from-other-network-representations">From other network representations<a class="anchor" aria-label="anchor" href="#from-other-network-representations"></a>
</h3>
<p>The conversion function <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> can also be used to convert instances of other network classes to a <code>sfnetwork</code> object. This includes classes that are also designed for spatial networks, such as <code>dodgr_streetnet</code> from the <a href="https://github.com/UrbanAnalyst/dodgr" class="external-link">dodgr</a> package for routing on street networks, and <code>linnet</code> from the <a href="http://spatstat.org/" class="external-link">spatstat.linnet</a> package for statistical point pattern analysis on spatial linear networks. However, it can also be used to convert instances of non-spatial network formats, as long as they do specify in some way a spatial location for the nodes. For example, an <code>igraph</code> object with x and y coordinates stored as node attributes. In such a case, any additional arguments provided to <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> will be forwarded to <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">sf::st_as_sf()</a></code> to convert the nodes of the given network into a <code>sf</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># igraph object.</span></span>
<span><span class="va">inet</span> <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/sample_grg.html" class="external-link">sample_grg</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">0.5</span>, coords <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">inet</span></span>
<span><span class="co">#&gt; IGRAPH 037109b U--- 5 2 -- Geometric random graph</span></span>
<span><span class="co">#&gt; + attr: name (g/c), radius (g/n), torus (g/l), x (v/n), y (v/n)</span></span>
<span><span class="co">#&gt; + edges from 037109b:</span></span>
<span><span class="co">#&gt; [1] 2--3 4--5</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sfnetwork object.</span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">inet</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 5 nodes and 2 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An unrooted forest with 3 trees and spatially implicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 0.111582 ymin: 0.3144644 xmax: 0.9832471 ymax: 0.9943113</span></span>
<span><span class="co">#&gt; # CRS: NA</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 5 × 1 (active)</span></span>
<span><span class="co">#&gt;                geometry</span></span>
<span><span class="co">#&gt;                 &lt;POINT&gt;</span></span>
<span><span class="co">#&gt; 1   (0.111582 0.968579)</span></span>
<span><span class="co">#&gt; 2 (0.3840216 0.4292271)</span></span>
<span><span class="co">#&gt; 3 (0.8146119 0.3144644)</span></span>
<span><span class="co">#&gt; 4 (0.8447424 0.9943113)</span></span>
<span><span class="co">#&gt; 5 (0.9832471 0.9893714)</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 2 × 2</span></span>
<span><span class="co">#&gt;    from    to</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1     2     3</span></span>
<span><span class="co">#&gt; 2     4     5</span></span></code></pre>
</div>
</section><section class="level3"><h3 id="from-files">From files<a class="anchor" aria-label="anchor" href="#from-files"></a>
</h3>
<p>There are currently no functions in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> for reading and writing data (there are some <a href="https://github.com/luukvdmeer/sfnetworks/discussions/264" class="external-link">ideas</a>). However, you can use <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::st_read()</a></code> for spatial file formats to read in points and/or lines, and then construct a network using <code><a href="../reference/sfnetwork.html">sfnetwork()</a></code> (as described <a href="#from-node-and-edge-tables">here</a>) or <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> (as described <a href="#from-spatial-lines">here</a> for lines and <a href="#from-spatial-points">here</a> for points). For network specific file types, you can use <code><a href="https://r.igraph.org/reference/read_graph.html" class="external-link">igraph::read_graph()</a></code> to read the data into R, and then convert it to spatial network format using <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> as long as the required spatial information is present (see <a href="#from-other-network-representations">here</a>).</p>
<p>A common format of the latter category is GraphML. An example of such a file can be found <a href="https://github.com/ComplexNetTSP/Power_grids" class="external-link">here</a>, containing the power grid of The Netherlands. After reading it using <a href="https://r.igraph.org/" class="external-link">igraph</a>, we will first convert it to a <code>tbl_graph</code> such that we can easily explore the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url</span> <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/ComplexNetTSP/Power_grids/v1.0.0/Countries/Netherlands/graphml/Netherlands_highvoltage.graphml"</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/read_graph.html" class="external-link">read_graph</a></span><span class="op">(</span><span class="va">url</span>, format <span class="op">=</span> <span class="st">"graphml"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/tbl_graph.html" class="external-link">as_tbl_graph</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tbl_graph: 91 nodes and 101 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An undirected simple graph with 2 components</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node Data: 91 × 14 (active)</span></span>
<span><span class="co">#&gt;    netcapacity typ      wktsrid4326 lat   voltage frequency ngen  operator lon</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 ""          substat… SRID=4326;… 52.3… 110000  ""        ""    "TenneT" 6.67…</span></span>
<span><span class="co">#&gt;  2 ""          substat… SRID=4326;… 52.2… 110000  ""        ""    ""       6.83…</span></span>
<span><span class="co">#&gt;  3 ""          substat… SRID=4326;… 53.4… 220000  ""        ""    "TenneT" 6.86…</span></span>
<span><span class="co">#&gt;  4 ""          joint    SRID=4326;… 53.2… 220000… "50;50;5… ""    "TenneT" 6.47…</span></span>
<span><span class="co">#&gt;  5 ""          joint    SRID=4326;… 51.4… 150000… "50;50;5… ""    "TenneT" 5.62…</span></span>
<span><span class="co">#&gt;  6 ""          joint    SRID=4326;… 52.4… 150000… "50;50;5… ""    "TenneT" 4.87…</span></span>
<span><span class="co">#&gt;  7 ""          joint    SRID=4326;… 52.4… 380000… "50;50;5… ""    "TenneT" 4.87…</span></span>
<span><span class="co">#&gt;  8 ""          substat… SRID=4326;… 52.4… 380000… ""        ""    "TenneT" 4.87…</span></span>
<span><span class="co">#&gt;  9 ""          substat… SRID=4326;… 51.8… 380000  ""        ""    "TenneT" 4.26…</span></span>
<span><span class="co">#&gt; 10 ""          substat… SRID=4326;… 51.6… 380000… ""        ""    "TenneT" 5.91…</span></span>
<span><span class="co">#&gt; # ℹ 81 more rows</span></span>
<span><span class="co">#&gt; # ℹ 5 more variables: ref &lt;chr&gt;, source &lt;chr&gt;, name &lt;chr&gt;, capacity &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   id &lt;chr&gt;</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge Data: 101 × 18</span></span>
<span><span class="co">#&gt;    from    to rohmkm cables wktsrid4326 operator type  lengthm voltage frequency</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1    52 ""     6;3;3… SRID=4326;… ""       line  49125.… 380000… 50</span></span>
<span><span class="co">#&gt; 2     1    21 ""     3;3;3… SRID=4326;… "TenneT" line  7653.0… 110000… 50;50</span></span>
<span><span class="co">#&gt; 3     2    23 ""     6;6    SRID=4326;… "TenneT" line  6135.3… 380000… 50</span></span>
<span><span class="co">#&gt; # ℹ 98 more rows</span></span>
<span><span class="co">#&gt; # ℹ 8 more variables: cnfkm &lt;chr&gt;, fromrelation &lt;chr&gt;, ref &lt;chr&gt;, name &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   xohmkm &lt;chr&gt;, wires &lt;chr&gt;, ithmaxa &lt;chr&gt;, lid &lt;chr&gt;</span></span></code></pre>
</div>
<p>We can see that the spatial geometries of nodes and edges are stored as WKT strings in columns named <em>wktsrid4326</em>. Remember that additional arguments to <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> for <code>igraph</code> objects are forwarded to <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">sf::st_as_sf()</a></code> to convert the nodes into a <code>sf</code> object. This makes conversion into a <code>sfnetwork</code> object as easy as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/read_graph.html" class="external-link">read_graph</a></span><span class="op">(</span><span class="va">url</span>, format <span class="op">=</span> <span class="st">"graphml"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span>wkt <span class="op">=</span> <span class="st">"wktsrid4326"</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">wktsrid4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 91 nodes and 101 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An undirected simple graph with 2 components and spatially implicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 3.692428 ymin: 51.14805 xmax: 7.041048 ymax: 53.44424</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 91 × 14 (active)</span></span>
<span><span class="co">#&gt;   netcapacity typ                   geometry lat         voltage frequency ngen</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;              &lt;POINT [°]&gt; &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 ""          substation (6.679331 52.32104) 52.3210417… 110000  ""        ""</span></span>
<span><span class="co">#&gt; 2 ""          substation  (6.830673 52.2139) 52.2139014… 110000  ""        ""</span></span>
<span><span class="co">#&gt; 3 ""          substation (6.869683 53.42999) 53.4299869… 220000  ""        ""</span></span>
<span><span class="co">#&gt; 4 ""          joint      (6.474364 53.21321) 53.2132104… 220000… "50;50;5… ""</span></span>
<span><span class="co">#&gt; 5 ""          joint      (5.621211 51.45516) 51.4551594… 150000… "50;50;5… ""</span></span>
<span><span class="co">#&gt; 6 ""          joint      (4.873691 52.42842) 52.4284153… 150000… "50;50;5… ""</span></span>
<span><span class="co">#&gt; # ℹ 85 more rows</span></span>
<span><span class="co">#&gt; # ℹ 7 more variables: operator &lt;chr&gt;, lon &lt;chr&gt;, ref &lt;chr&gt;, source &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   name &lt;chr&gt;, capacity &lt;chr&gt;, id &lt;chr&gt;</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 101 × 18</span></span>
<span><span class="co">#&gt;    from    to rohmkm cables wktsrid4326 operator type  lengthm voltage frequency</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1    52 ""     6;3;3… SRID=4326;… ""       line  49125.… 380000… 50</span></span>
<span><span class="co">#&gt; 2     1    21 ""     3;3;3… SRID=4326;… "TenneT" line  7653.0… 110000… 50;50</span></span>
<span><span class="co">#&gt; 3     2    23 ""     6;6    SRID=4326;… "TenneT" line  6135.3… 380000… 50</span></span>
<span><span class="co">#&gt; # ℹ 98 more rows</span></span>
<span><span class="co">#&gt; # ℹ 8 more variables: cnfkm &lt;chr&gt;, fromrelation &lt;chr&gt;, ref &lt;chr&gt;, name &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   xohmkm &lt;chr&gt;, wires &lt;chr&gt;, ithmaxa &lt;chr&gt;, lid &lt;chr&gt;</span></span></code></pre>
</div>
<p>However, this did only affect the nodes table (since that one is <em>required</em> to have geometries). The edges do not have explicit geometries yet. Using the morpher function <code><a href="../reference/spatial_morphers.html">to_spatial_explicit()</a></code>, we can “explicitize” the edge geometries of the constructed network. Also here, additional arguments are forwarded to <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">sf::st_as_sf()</a></code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">to_spatial_explicit</span>, wkt <span class="op">=</span> <span class="st">"wktsrid4326"</span>, crs <span class="op">=</span> <span class="fl">4326</span>, .clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">wktsrid4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 91 nodes and 101 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An undirected simple graph with 2 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 3.692428 ymin: 51.14805 xmax: 7.041048 ymax: 53.44424</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 101 × 18 (active)</span></span>
<span><span class="co">#&gt;    from    to rohmkm cables                      geometry operator type  lengthm</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;               &lt;LINESTRING [°]&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1    52 ""     6;3;3;3;3  (6.188921 52.53048, 6.67… ""       line  49125.…</span></span>
<span><span class="co">#&gt; 2     1    21 ""     3;3;3;3;6… (6.768035 52.27755, 6.67… "TenneT" line  7653.0…</span></span>
<span><span class="co">#&gt; 3     2    23 ""     6;6        (6.830673 52.2139, 6.760… "TenneT" line  6135.3…</span></span>
<span><span class="co">#&gt; 4     2    13 ""     6;6        (6.830673 52.2139, 6.888… ""       line  4296.2…</span></span>
<span><span class="co">#&gt; 5     3    53 ""     6          (6.869683 53.42999, 6.87… ""       line  388.82…</span></span>
<span><span class="co">#&gt; 6     3    70 ""     6          (6.869683 53.42999, 6.85… ""       line  359.61…</span></span>
<span><span class="co">#&gt; # ℹ 95 more rows</span></span>
<span><span class="co">#&gt; # ℹ 10 more variables: voltage &lt;chr&gt;, frequency &lt;chr&gt;, cnfkm &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   fromrelation &lt;chr&gt;, ref &lt;chr&gt;, name &lt;chr&gt;, xohmkm &lt;chr&gt;, wires &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   ithmaxa &lt;chr&gt;, lid &lt;chr&gt;</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 91 × 14</span></span>
<span><span class="co">#&gt;   netcapacity typ                   geometry lat         voltage frequency ngen</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;              &lt;POINT [°]&gt; &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 ""          substation (6.679331 52.32104) 52.3210417… 110000  ""        ""</span></span>
<span><span class="co">#&gt; 2 ""          substation  (6.830673 52.2139) 52.2139014… 110000  ""        ""</span></span>
<span><span class="co">#&gt; 3 ""          substation (6.869683 53.42999) 53.4299869… 220000  ""        ""</span></span>
<span><span class="co">#&gt; # ℹ 88 more rows</span></span>
<span><span class="co">#&gt; # ℹ 7 more variables: operator &lt;chr&gt;, lon &lt;chr&gt;, ref &lt;chr&gt;, source &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   name &lt;chr&gt;, capacity &lt;chr&gt;, id &lt;chr&gt;</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-39-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="from-openstreetmap-data">From OpenStreetMap data<a class="anchor" aria-label="anchor" href="#from-openstreetmap-data"></a>
</h3>
<p>A common source for spatial network data is <a href="https://www.openstreetmap.org" class="external-link">OpenStreetMap</a>.This is an open and collaborative geographic database. It can be used for example to extract geometries of streets or rivers anywhere in the world. In R, there are two main packages that allow to read OpenStreetMap data:</p>
<ul>
<li>The <a href="https://docs.ropensci.org/osmdata/" class="external-link">osmdata</a> package provides an interface to the Overpass API of OpenStreetMap.</li>
<li>The <a href="https://docs.ropensci.org/osmextract/" class="external-link">osmextract</a> package can read OpenStreetMap data from <code>osm.pbf</code> files.</li>
</ul>
<p>For small areas and few repeated calls, the Overpass API is the easiest way to get the data. However, if your area of interest is large, or you want to load the data many times, it is preferred to not overload the API and read from <code>osm.pbf</code> files instead. <a href="https://download.geofabrik.de/" class="external-link">Geofabrik</a> is one of the platforms where you can download such files for many different regions in the world.</p>
<p>Here, we will show a small example using <a href="https://docs.ropensci.org/osmdata/" class="external-link">osmdata</a>. We can read in the street centerlines of Anif, a small village in Austria, as shown below. For details on this workflow, check the <a href="https://docs.ropensci.org/osmdata/articles/osmdata.html" class="external-link">osmdata documentation</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmdata/" class="external-link">osmdata</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright</span></span>
<span></span>
<span><span class="co"># Call the Overpass API to extract streets in Anif.</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html" class="external-link">opq</a></span><span class="op">(</span><span class="st">"Anif, Austria"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html" class="external-link">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"highway"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html" class="external-link">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osm_poly2line.html" class="external-link">osm_poly2line</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract only the linestring geometries from the response.</span></span>
<span><span class="va">streets</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">osm_lines</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"type"</span> <span class="op">=</span> <span class="va">highway</span>, <span class="va">surface</span><span class="op">)</span></span>
<span></span>
<span><span class="va">streets</span></span>
<span><span class="co">#&gt; Simple feature collection with 1781 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 13.03806 ymin: 47.71134 xmax: 13.08752 ymax: 47.76715</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;                            name          type     surface</span></span>
<span><span class="co">#&gt; 5205037   Sankt-Leonhard-Straße     secondary     asphalt</span></span>
<span><span class="co">#&gt; 13868047    Christophorusstraße   residential        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13868111         Überfuhrstraße  unclassified     asphalt</span></span>
<span><span class="co">#&gt; 16300987                   &lt;NA&gt; motorway_link     asphalt</span></span>
<span><span class="co">#&gt; 16628000 Berchtesgadener Straße       primary     asphalt</span></span>
<span><span class="co">#&gt; 20812716            Ursteinsteg      cycleway     asphalt</span></span>
<span><span class="co">#&gt; 20812718           Tauernradweg          path fine_gravel</span></span>
<span><span class="co">#&gt; 22767760                   &lt;NA&gt; motorway_link     asphalt</span></span>
<span><span class="co">#&gt; 22767761                   &lt;NA&gt; motorway_link     asphalt</span></span>
<span><span class="co">#&gt; 22767763                   &lt;NA&gt; motorway_link     asphalt</span></span>
<span><span class="co">#&gt;                                geometry</span></span>
<span><span class="co">#&gt; 5205037  LINESTRING (13.05769 47.724...</span></span>
<span><span class="co">#&gt; 13868047 LINESTRING (13.08263 47.746...</span></span>
<span><span class="co">#&gt; 13868111 LINESTRING (13.08397 47.746...</span></span>
<span><span class="co">#&gt; 16300987 LINESTRING (13.0515 47.7375...</span></span>
<span><span class="co">#&gt; 16628000 LINESTRING (13.05344 47.739...</span></span>
<span><span class="co">#&gt; 20812716 LINESTRING (13.08375 47.725...</span></span>
<span><span class="co">#&gt; 20812718 LINESTRING (13.08152 47.731...</span></span>
<span><span class="co">#&gt; 22767760 LINESTRING (13.04707 47.741...</span></span>
<span><span class="co">#&gt; 22767761 LINESTRING (13.05249 47.738...</span></span>
<span><span class="co">#&gt; 22767763 LINESTRING (13.05394 47.740...</span></span></code></pre></div>
</div>
<p>Now, we can simply create a network out of these lines using <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code>, as shown <a href="#from-spatial-lines">before</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">streets</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 2519 nodes and 1781 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An undirected multigraph with 837 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 13.03806 ymin: 47.71134 xmax: 13.08752 ymax: 47.76715</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 2,519 × 1 (active)</span></span>
<span><span class="co">#&gt;              geometry</span></span>
<span><span class="co">#&gt;           &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1 (13.05769 47.72452)</span></span>
<span><span class="co">#&gt; 2 (13.05883 47.72453)</span></span>
<span><span class="co">#&gt; 3 (13.08263 47.74633)</span></span>
<span><span class="co">#&gt; 4 (13.08086 47.75767)</span></span>
<span><span class="co">#&gt; 5 (13.08397 47.74621)</span></span>
<span><span class="co">#&gt; 6  (13.0515 47.73759)</span></span>
<span><span class="co">#&gt; # ℹ 2,513 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 1,781 × 6</span></span>
<span><span class="co">#&gt;    from    to name                  type       surface                  geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                 &lt;chr&gt;      &lt;chr&gt;            &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2 Sankt-Leonhard-Straße secondary  asphalt (13.05769 47.72452, 13.0…</span></span>
<span><span class="co">#&gt; 2     3     4 Christophorusstraße   residenti… NA      (13.08263 47.74633, 13.0…</span></span>
<span><span class="co">#&gt; 3     3     5 Überfuhrstraße        unclassif… asphalt (13.08397 47.74621, 13.0…</span></span>
<span><span class="co">#&gt; # ℹ 1,778 more rows</span></span></code></pre>
</div>
<p>However, we need to be aware that OpenStreetMap data is not created primarily with a network structure in mind. This means that locations where two streets connect are not always the endpoints of the linestring geometries, but they can be an interior point of such a geometry as well. By setting <code>subdivide = TRUE</code> linestring geometries will be subdivided at places where an interior point is shared between multiple features. In that way, a node will be placed at such locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The create network without subdivision has many disconnected components.</span></span>
<span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/with_graph.html" class="external-link">with_graph</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/graph_measures.html" class="external-link">graph_component_count</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 837</span></span>
<span></span>
<span><span class="co"># Creating the network with subdivsion reduces this number drastically.</span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">streets</span>, subdivide <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/with_graph.html" class="external-link">with_graph</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/graph_measures.html" class="external-link">graph_component_count</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 21</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-43-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="random-networks">Random networks<a class="anchor" aria-label="anchor" href="#random-networks"></a>
</h3>
<p>The function <code><a href="../reference/play_spatial.html">play_geometric()</a></code> creates a <a href="https://en.wikipedia.org/wiki/Random_geometric_graph" class="external-link">random geometric graph</a>. This randomly samples <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> nodes, and connects them by an edge if they are within a given distance threshold from each other. By default, sampling will take place on the unit square. However, through the <code>bounds</code> argument you can also provide any spatial feature to sample on. This will use <code><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">sf::st_sample()</a></code> internally.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample on a unit square.</span></span>
<span><span class="va">neta</span> <span class="op">=</span> <span class="fu"><a href="../reference/play_spatial.html">play_geometric</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample on a spatial feature.</span></span>
<span><span class="va">netb</span> <span class="op">=</span> <span class="fu"><a href="../reference/play_spatial.html">play_geometric</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">250</span>, <span class="st">"m"</span><span class="op">)</span>, bounds <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">mozart</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">neta</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">netb</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-45-1.png" width="672"></p>
<figcaption>Random network A</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-45-2.png" width="672"></p>
<figcaption>Random network B</figcaption></figure>
</div>
</div>
</div>
</div>
</section></section><section class="level2"><h2 id="validating-sfnetwork-objects">Validating sfnetwork objects<a class="anchor" aria-label="anchor" href="#validating-sfnetwork-objects"></a>
</h2>
<p>As described in the <a href="#structure">beginning</a>, there are several requirements for a <code>sfnetwork</code> object to be considered a valid spatial network. The <code><a href="../reference/validate_network.html">validate_network()</a></code> utility function checks if these requirements are met.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/validate_network.html">validate_network</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span>
<span><span class="co">#&gt; → Checking node geometry types ...</span></span></code></pre></div>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ All nodes have geometry type POINT</span></span></code></pre>
<pre><code><span><span class="co">#&gt; → Checking edge geometry types ...</span></span></code></pre>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ All edges have geometry type LINESTRING</span></span></code></pre>
<pre><code><span><span class="co">#&gt; → Checking coordinate reference system equality ...</span></span></code></pre>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ Nodes and edges have the same crs</span></span></code></pre>
<pre><code><span><span class="co">#&gt; → Checking coordinate precision equality ...</span></span></code></pre>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ Nodes and edges have the same precision</span></span></code></pre>
<pre><code><span><span class="co">#&gt; → Checking if geometries match ...</span></span></code></pre>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ Node locations match edge boundaries</span></span></code></pre>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ Spatial network structure is valid</span></span></code></pre>
</div>
<p>These checks are executed already during construction. Trying to construct an invalid network will result in an error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">53</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">52.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">l1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">l2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">nodes</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edges</span><span class="op">$</span><span class="va">from</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">edges</span><span class="op">$</span><span class="va">to</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span><span class="op">)</span></span>
<span><span class="co">#&gt; → Checking node geometry types ...</span></span></code></pre></div>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ All nodes have geometry type POINT</span></span></code></pre>
<pre><code><span><span class="co">#&gt; → Checking edge geometry types ...</span></span></code></pre>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ All edges have geometry type LINESTRING</span></span></code></pre>
<pre><code><span><span class="co">#&gt; → Checking coordinate reference system equality ...</span></span></code></pre>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ Nodes and edges have the same crs</span></span></code></pre>
<pre><code><span><span class="co">#&gt; → Checking coordinate precision equality ...</span></span></code></pre>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ✔ Nodes and edges have the same precision</span></span></code></pre>
<pre><code><span><span class="co">#&gt; → Checking if geometries match ...</span></span></code></pre>
<pre class="fansi fansi-error"><code><span><span class="co">#&gt; Error in `validate_network()`:</span></span>
<span><span class="co">#&gt; ! Node locations do not match edge boundaries</span></span></code></pre>
</div>
<p>However, you could work around this by setting <code>force = TRUE</code>. This will skip the checks, and create the <code>sfnetwork</code> object even if its structure is not valid. Be aware that functions in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> are designed under the assumption that the analyzed network is valid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>If your issue is that node and edge geometries do not match (i.e. the endpoints of the edges are not equal to the nodes that are supposed to be their source and target), there is the utility function <code><a href="../reference/make_edges_valid.html">make_edges_valid()</a></code> that can fix this in two different ways:</p>
<ol type="1">
<li>By default, it will replace each invalid endpoint in an edge geometry with the point geometry of the node that is referenced in the <em>from</em> or <em>to</em> column.</li>
<li>If you set <code>preserve_geometries = TRUE</code>, the edge geometries remain unchanged. Invalid endpoints are added as new nodes to the network, and the <em>from</em> and <em>to</em> columns are updated accordingly.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neta</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_edges_valid.html">make_edges_valid</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span>
<span><span class="va">netb</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_edges_valid.html">make_edges_valid</a></span><span class="op">(</span><span class="va">net</span>, preserve_geometries <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">neta</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">netb</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-50-1.png" width="672"></p>
<figcaption>Invalid network</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-50-2.png" width="672"></p>
<figcaption>Valid network A</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn02_create_represent_files/figure-html/unnamed-chunk-50-3.png" width="672"></p>
<figcaption>Valid network B</figcaption></figure>
</div>
</div>
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
