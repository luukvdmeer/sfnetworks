<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to sfnetworks • sfnetworks</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="sfn01_intro_files/libs/quarto-html/popper.min.js"></script><script src="sfn01_intro_files/libs/quarto-html/tippy.umd.min.js"></script><link href="sfn01_intro_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sfn01_intro_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to sfnetworks">
<meta property="og:image" content="https://luukvdmeer.github.io/sfnetworks/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sfnetworks</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/sfn01_intro.html">Introduction to sfnetworks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn02_create_represent.html">Creating and representing spatial networks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn03_cleaning.html">Cleaning spatial networks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn04_join_filter.html">Spatial joins and filters</a></li>
    <li><a class="dropdown-item" href="../articles/sfn05_routing.html">Routing on spatial networks</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/luukvdmeer/sfnetworks/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to sfnetworks</h1>


      <p class="date">2024-11-17</p>

      <small class="dont-index">Source: <a href="https://github.com/luukvdmeer/sfnetworks/blob/main/vignettes/sfn01_intro.qmd" class="external-link"><code>vignettes/sfn01_intro.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <style type="text/css" scoped="">
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>The <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> package is designed to represent and analyze geospatial networks. These are networks that are embedded in geographical space, in which the nodes and edges can be represented by spatial simple features. The nodes most commonly as points, and the edges as linestrings. This vignette provides a basic introduction to the package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h2 id="rationale">Rationale<a class="anchor" aria-label="anchor" href="#rationale"></a>
</h2>
<p>In R there are very good packages for respectively geospatial analysis and standard network analysis:</p>
<ul>
<li>The <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> package brings the simple features standard to R and provides an interface to low-level geospatial system libraries such as GDAL, GEOS, and s2, allowing to represent and analyze spatial vector data such as points, lines and polygons.</li>
<li>The <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> package provides a tidy interface to the large network analysis library <a href="https://r.igraph.org/" class="external-link">igraph</a>, which is written in C and also has an R API.</li>
</ul>
<p>These packages by themselves are great for their purposes. However, <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> does not know about networks, while <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> does not know about space. By combining their forces, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> enables integrated workflows connecting network analysis with spatial analysis. In addition, it offers functions that are specific for spatial network analysis, and cannot be found in either of the two “parent packages”. For that, it often utilizes additional building blocks from within the R world.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure><p><img src="figures/dependencies.png"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h2 id="representing-spatial-networks">Representing spatial networks<a class="anchor" aria-label="anchor" href="#representing-spatial-networks"></a>
</h2>
<p>Spatial networks in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> are represented by objects of class <code>sfnetwork</code>. These objects inherit the <code>tbl_graph</code> class from <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, which in turn inherit the <code>igraph</code> class from <a href="https://r.igraph.org/" class="external-link">igraph</a>. What this means is that in their core they are designed to store graph structures. However, thanks to the design of <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, they look like a collection of two flat tables: one for the nodes, and one for the edges. Where in <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> these tables can be treated as tibbles, in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> they are sf data frames with a list column containing the geometry of each feature.</p>
<p>In <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>, edges can either be directed (the default) or undirected. Mixed networks that contain both types of edges, e.g. road networks with oneway streets, can be represented by duplicating and reversing all edges that can be traveled in both ways. Where nodes in spatial networks need to explicitly store geometries, for edges this is not always required. If edges are straight lines, their spatial embedding can also be inferred from the spatial locations of the nodes they connect. In <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> we refer to these two approaches as <em>spatially explicit edges</em> and <em>spatially implicit edges</em>, respectively. More details on the representation of spatial networks with the <code>sfnetwork</code> class can be found in the vignette <a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn02_create_represent.html#the-sfnetwork-class">Creating and representing spatial networks</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure><p><img src="figures/data-structure.png"></p>
</figure>
</div>
</div>
</div>
<p>There are many different ways to create a <code>sfnetwork</code> object, which are explained in detail in the vignette <a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn02_create_represent.html#creating-sfnetwork-objects">Creating and representing spatial networks</a>. Most commonly you will start with a set of spatial features, stored as an object of class <code>sf</code>. If these features are linestrings, they are considered to be the edges of the network, and nodes are created at their endpoints. If multiple linestrings share an endpoint, this becomes a single node in the network, and hence, these edges are adjacent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">roxel</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 987 nodes and 1215 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed multigraph with 9 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 7.522595 ymin: 51.94151 xmax: 7.546705 ymax: 51.96119</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 987 × 1 (active)</span></span>
<span><span class="co">#&gt;              geometry</span></span>
<span><span class="co">#&gt;           &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1 (7.538109 51.95286)</span></span>
<span><span class="co">#&gt; 2 (7.537867 51.95282)</span></span>
<span><span class="co">#&gt; 3 (7.537815 51.95867)</span></span>
<span><span class="co">#&gt; 4 (7.537015 51.95848)</span></span>
<span><span class="co">#&gt; 5 (7.533441 51.95578)</span></span>
<span><span class="co">#&gt; 6 (7.533415 51.95561)</span></span>
<span><span class="co">#&gt; # ℹ 981 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 1,215 × 5</span></span>
<span><span class="co">#&gt;    from    to name               type                                   geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                          &lt;LINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1     1     2 Hagemanns Kämpken  residential (7.538109 51.95286, 7.537867 51.95…</span></span>
<span><span class="co">#&gt; 2     3     4 Stiegkamp          residential (7.537815 51.95867, 7.537015 51.95…</span></span>
<span><span class="co">#&gt; 3     5     6 Havixbecker Straße residential (7.533441 51.95578, 7.533467 51.95…</span></span>
<span><span class="co">#&gt; # ℹ 1,212 more rows</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If the features are points, they are considered to be the nodes of the network, and they are connected by edges according to a given adjacency matrix. The adjacency matrix can also be created internally according to a specified method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, connections <span class="op">=</span> <span class="st">"gabriel"</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 17 nodes and 25 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A bipartite simple graph with 1 component and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 17 × 4 (active)</span></span>
<span><span class="co">#&gt;   name                  type     website                        geometry</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;                       &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartkino            cinema   https://www.mozartki… (4549504 2747309)</span></span>
<span><span class="co">#&gt; 2 Haus für Mozart       theatre  NA                    (4549003 2747376)</span></span>
<span><span class="co">#&gt; 3 Mozartsteg/Rudolfskai bus_stop NA                    (4549589 2747507)</span></span>
<span><span class="co">#&gt; 4 Mozart Denkmal        artwork  NA                    (4549387 2747514)</span></span>
<span><span class="co">#&gt; 5 Mozartsteg/Rudolfskai bus_stop NA                    (4549491 2747551)</span></span>
<span><span class="co">#&gt; 6 Mozartsteg            bridge   NA                    (4549473 2747624)</span></span>
<span><span class="co">#&gt; # ℹ 11 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 25 × 3</span></span>
<span><span class="co">#&gt;    from    to                           geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                   &lt;LINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1     1     3 (4549504 2747309, 4549589 2747507)</span></span>
<span><span class="co">#&gt; 2     1     4 (4549504 2747309, 4549387 2747514)</span></span>
<span><span class="co">#&gt; 3     2     4 (4549003 2747376, 4549387 2747514)</span></span>
<span><span class="co">#&gt; # ℹ 22 more rows</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h2 id="analyzing-spatial-networks">Analyzing spatial networks<a class="anchor" aria-label="anchor" href="#analyzing-spatial-networks"></a>
</h2>
<p>Thanks to the design of both <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> and <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, spatial network analysis with <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> can be fitted seamlessly into tidy data analysis workflows using the <a href="https://www.tidyverse.org/" class="external-link">tidyverse</a> family of packages. Since a <code>sfnetwork</code> object can be treated as a collection of two tables, rather than one, you just need to specify to which of them you want to apply a function. For this, <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> invented the <code><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate()</a></code> verb, allowing to set either the nodes or the edges as the target of analysis. Having done that, you can apply your favorite tidyverse verb just as you’re used to. As you can see below the activation of a network element also changes the order in which they are printed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/n.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">label</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="../reference/n.html">n</a></span><span class="op">(</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 17 nodes and 13 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An unrooted forest with 4 trees and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 13 × 3 (active)</span></span>
<span><span class="co">#&gt;    from    to                           geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                   &lt;LINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1     1     4 (4549504 2747309, 4549387 2747514)</span></span>
<span><span class="co">#&gt; 2     3     5 (4549589 2747507, 4549491 2747551)</span></span>
<span><span class="co">#&gt; 3     4     5 (4549387 2747514, 4549491 2747551)</span></span>
<span><span class="co">#&gt; 4     4     9 (4549387 2747514, 4549120 2747654)</span></span>
<span><span class="co">#&gt; 5     6    10 (4549473 2747624, 4549418 2747723)</span></span>
<span><span class="co">#&gt; 6     7     9 (4549064 2747619, 4549120 2747654)</span></span>
<span><span class="co">#&gt; # ℹ 7 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 17 × 3</span></span>
<span><span class="co">#&gt;   name                  label          geometry</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;       &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartkino            a     (4549504 2747309)</span></span>
<span><span class="co">#&gt; 2 Haus für Mozart       b     (4549003 2747376)</span></span>
<span><span class="co">#&gt; 3 Mozartsteg/Rudolfskai c     (4549589 2747507)</span></span>
<span><span class="co">#&gt; # ℹ 14 more rows</span></span></code></pre>
</div>
<p>Obviously a network is more than just a list of two distinct elements. Nodes and edges are related to each other. Therefore, some operations that are applied to the nodes may also affect the edges, and vice versa. A good example of this is filtering. Whenever nodes are removed from the network, the edges terminating at those nodes will be removed too. This behavior is <em>not</em> symmetric: when removing edges, the endpoints of those edges remain, even if they are not an endpoint of any other edge. This is because by definition edges can never exist without nodes on their ends, while nodes can peacefully exist in isolation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filtering nodes also reduces the number of edges.</span></span>
<span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"artwork"</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 3 nodes and 0 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An unrooted forest with 3 trees and spatially implicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4548664 ymin: 2747514 xmax: 4549387 ymax: 2747868</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 3 × 4 (active)</span></span>
<span><span class="co">#&gt;   name                type    website                           geometry</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;   &lt;chr&gt;                          &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt; 1 Mozart Denkmal      artwork NA                       (4549387 2747514)</span></span>
<span><span class="co">#&gt; 2 Spirit of Mozart    artwork https://salzburgfoundat… (4549119 2747790)</span></span>
<span><span class="co">#&gt; 3 Mozart-Eine Hommage artwork https://salzburgfoundat… (4548664 2747868)</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 0 × 3</span></span>
<span><span class="co">#&gt; # ℹ 3 variables: from &lt;int&gt;, to &lt;int&gt;, geometry &lt;GEOMETRY [m]&gt;</span></span></code></pre>
</div>
<p>Another consequence of working with relational data is that not all operations that are defined for single tables are applicable to networks. For example, the common groupby-apply-combine workflows are not supported, since they would break the relational structure. In these cases, however, you can always extract the active element from the network either as a sf object or a tibble, and proceed your analysis on a single table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="../reference/n.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 13 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 13 × 3</span></span>
<span><span class="co">#&gt;    type              n                                                  geometry</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;int&gt;                                            &lt;GEOMETRY [m]&gt;</span></span>
<span><span class="co">#&gt;  1 apartments        1                                   POINT (4549073 2747916)</span></span>
<span><span class="co">#&gt;  2 artwork           3 MULTIPOINT ((4548664 2747868), (4549119 2747790), (45493…</span></span>
<span><span class="co">#&gt;  3 bridge            1                                   POINT (4549473 2747624)</span></span>
<span><span class="co">#&gt;  4 bus_stop          3 MULTIPOINT ((4549418 2747723), (4549491 2747551), (45495…</span></span>
<span><span class="co">#&gt;  5 cafe              1                                   POINT (4548994 2747632)</span></span>
<span><span class="co">#&gt;  6 cinema            1                                   POINT (4549504 2747309)</span></span>
<span><span class="co">#&gt;  7 concert_hall      1                                   POINT (4548897 2748037)</span></span>
<span><span class="co">#&gt;  8 confectionery     1                                   POINT (4549120 2747654)</span></span>
<span><span class="co">#&gt;  9 dormitory         1                                   POINT (4548984 2748537)</span></span>
<span><span class="co">#&gt; 10 hotel             1                                   POINT (4549378 2748391)</span></span>
<span><span class="co">#&gt; 11 museum            1                                   POINT (4549064 2747619)</span></span>
<span><span class="co">#&gt; 12 theatre           1                                   POINT (4549003 2747376)</span></span>
<span><span class="co">#&gt; 13 university        1                                   POINT (4549059 2748042)</span></span></code></pre>
</div>
<section class="level3"><h3 id="network-analysis-with-tidygraph">Network analysis with tidygraph<a class="anchor" aria-label="anchor" href="#network-analysis-with-tidygraph"></a>
</h3>
<p>To allow performing common network analysis tasks, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> builds upon tidygraph. Since <code>sfnetwork</code> objects inherit the <code>tbl_graph</code> class, all analytical functions from <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> can be directly used. There are a lot of such functions available, most of which are tidy wrappers around functions from the <a href="https://r.igraph.org/" class="external-link">igraph</a> library. For a complete overview, check the <a href="https://tidygraph.data-imaginist.com/" class="external-link">tidygraph documentation</a>.</p>
<p>It is important to note that in the case of spatial networks it often makes most sense to use geographic length as edge weight. Since <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> does not know about space, it will never set this automatically, so you will have to explicitly specify it every time you call a function that can consider edge weights. Read more about specifying edge weights in the vignette <a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn02_create_represent.html/#specifying-edge-weights">Routing on spatial networks</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 17 nodes and 25 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A bipartite simple graph with 1 component and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 25 × 4 (active)</span></span>
<span><span class="co">#&gt;    from    to                           geometry length</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                   &lt;LINESTRING [m]&gt;    [m]</span></span>
<span><span class="co">#&gt; 1     1     3 (4549504 2747309, 4549589 2747507)   216.</span></span>
<span><span class="co">#&gt; 2     1     4 (4549504 2747309, 4549387 2747514)   236.</span></span>
<span><span class="co">#&gt; 3     2     4 (4549003 2747376, 4549387 2747514)   409.</span></span>
<span><span class="co">#&gt; 4     2     7 (4549003 2747376, 4549064 2747619)   250.</span></span>
<span><span class="co">#&gt; 5     2     8 (4549003 2747376, 4548994 2747632)   256.</span></span>
<span><span class="co">#&gt; 6     3     5 (4549589 2747507, 4549491 2747551)   107.</span></span>
<span><span class="co">#&gt; # ℹ 19 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 17 × 4</span></span>
<span><span class="co">#&gt;   name                  type     website                        geometry</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;                       &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartkino            cinema   https://www.mozartki… (4549504 2747309)</span></span>
<span><span class="co">#&gt; 2 Haus für Mozart       theatre  NA                    (4549003 2747376)</span></span>
<span><span class="co">#&gt; 3 Mozartsteg/Rudolfskai bus_stop NA                    (4549589 2747507)</span></span>
<span><span class="co">#&gt; # ℹ 14 more rows</span></span></code></pre>
</div>
<section class="level4"><h4 id="measures">Measures<a class="anchor" aria-label="anchor" href="#measures"></a>
</h4>
<p>A large set of functions in <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> is dedicated to the computation of quantitative <strong>measures</strong> for nodes, edges, or the network as a whole. Most known are centrality measures, which define the importance of a node in the network. The names of all implemented centrality measure functions are formatted as <code>centrality_*</code>. Other implemented measure functions have names formatted as <code>node_*</code> (for node measures) or <code>edge_*</code> (for edge measures) or <code>graph_*</code> (for network measures). A special group of measure functions are the logical measures, which return either <code>TRUE</code> or <code>FALSE</code>, indicating if the node, edge or network is of a specified type.</p>
<p>None of these functions are meant to be called directly, but used inside tidyverse-verbs such as <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code>, where the analyzed network is know and thus not needed as an input to the function. <code><a href="https://tidygraph.data-imaginist.com/reference/with_graph.html" class="external-link">tidygraph::with_graph()</a></code> can be used to evaluate a measure in the context of a specific network, but outside the tidyverse framework.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/edge_types.html" class="external-link">edge_is_incident</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>bc <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html" class="external-link">centrality_betweenness</a></span><span class="op">(</span>weights <span class="op">=</span> <span class="va">length</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 17 nodes and 23 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A bipartite simple graph with 2 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 17 × 5 (active)</span></span>
<span><span class="co">#&gt;   name                  type     website                  geometry    bc</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;                 &lt;POINT [m]&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartkino            cinema   https://www.mo… (4549504 2747309)     0</span></span>
<span><span class="co">#&gt; 2 Haus für Mozart       theatre  NA              (4549003 2747376)     0</span></span>
<span><span class="co">#&gt; 3 Mozartsteg/Rudolfskai bus_stop NA              (4549589 2747507)     5</span></span>
<span><span class="co">#&gt; 4 Mozart Denkmal        artwork  NA              (4549387 2747514)    21</span></span>
<span><span class="co">#&gt; 5 Mozartsteg/Rudolfskai bus_stop NA              (4549491 2747551)    22</span></span>
<span><span class="co">#&gt; 6 Mozartsteg            bridge   NA              (4549473 2747624)    16</span></span>
<span><span class="co">#&gt; # ℹ 11 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 23 × 4</span></span>
<span><span class="co">#&gt;    from    to                           geometry length</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                   &lt;LINESTRING [m]&gt;    [m]</span></span>
<span><span class="co">#&gt; 1     1     3 (4549504 2747309, 4549589 2747507)   216.</span></span>
<span><span class="co">#&gt; 2     1     4 (4549504 2747309, 4549387 2747514)   236.</span></span>
<span><span class="co">#&gt; 3     2     4 (4549003 2747376, 4549387 2747514)   409.</span></span>
<span><span class="co">#&gt; # ℹ 20 more rows</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">new_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">bc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/with_graph.html" class="external-link">with_graph</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html" class="external-link">centrality_degree</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 2 3 2 4 3 2 3 3 4 4 3 2 2 4 3 3 3</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="community-detection">Community detection<a class="anchor" aria-label="anchor" href="#community-detection"></a>
</h4>
<p>Another set of functions in <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> deals with <strong>community detection</strong> in networks. These functions group nodes or edges based on a clustering algorithm. Their names are all formatted as <code>group_*</code>, and they will always return a vector of group indices, one for each feature. Most of the implemented algorithms will try to create groups of nodes such that the number of edges within groups is relatively high compared to the number of edges between groups, as in the example below. Do note that these algorithms are generally not designed to account for spatial factors, and they may have limited use when working with spatial networks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/group_graph.html" class="external-link">group_optimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">new_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_colour_discrete</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level4"><h4 id="morphers">Morphers<a class="anchor" aria-label="anchor" href="#morphers"></a>
</h4>
<p>Finally, <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> has introduced a new set of network analysis functions which they call <strong>morphers</strong>. Morphers change the structure of the input graph, for example by subsetting or splitting it, by combining multiple features into one, or by converting nodes to edges and vice versa. If this different struture is only needed for a few computations, it can be set temporarily by providing the morphers to subsequently the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">tidygraph::morph()</a></code> and <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">tidygraph::unmorph()</a></code> verbs. If the different structure is meant to last, the morpher can be provided to the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">tidygraph::convert()</a></code> verb instead. An example is to convert a network into its minimum spanning tree, which contains only the minimum set of edges need such that all nodes are still connected like before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">to_minimum_spanning_tree</span>, weights <span class="op">=</span> <span class="va">length</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">new_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section class="level3"><h3 id="spatial-analysis-with-sf">Spatial analysis with sf<a class="anchor" aria-label="anchor" href="#spatial-analysis-with-sf"></a>
</h3>
<p>By writing methods for many spatial analytical functions from the <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> package, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> allows these functions to be called directly on <code>sfnetwork</code> objects, without the need for conversion. See <a href="">here</a> for an overview of all sf functions that have a method for <code>sfnetwork</code> objects. For a complete overview of the functionalities of <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>, check the <a href="https://r-spatial.github.io/sf/" class="external-link">sf documentation</a>.</p>
<section class="level4"><h4 id="coordinate-reference-systems">Coordinate reference systems<a class="anchor" aria-label="anchor" href="#coordinate-reference-systems"></a>
</h4>
<p>One of the many tasks that <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> covers is the specification of <strong>coordinate reference systems</strong>, CRS for short, and the transformation of spatial coordinates between such systems. In a <code>sfnetwork</code> object the nodes and edges always have the same CRS, so it does not matter which of the elements is active when you retrieve the CRS, or when you transform coordinates into a different CRS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">$</span><span class="va">epsg</span></span>
<span><span class="co">#&gt; [1] 3035</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 17 nodes and 25 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A bipartite simple graph with 1 component and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 13.03835 ymin: 47.79698 xmax: 13.05049 ymax: 47.80822</span></span>
<span><span class="co">#&gt; # Geodetic CRS: WGS 84</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 25 × 4 (active)</span></span>
<span><span class="co">#&gt;    from    to                               geometry length</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                       &lt;LINESTRING [°]&gt;    [m]</span></span>
<span><span class="co">#&gt; 1     1     3 (13.04925 47.79698, 13.05049 47.79874)   216.</span></span>
<span><span class="co">#&gt; 2     1     4 (13.04925 47.79698, 13.04781 47.79887)   236.</span></span>
<span><span class="co">#&gt; 3     2     4  (13.0426 47.79778, 13.04781 47.79887)   409.</span></span>
<span><span class="co">#&gt; 4     2     7  (13.0426 47.79778, 13.04355 47.79993)   250.</span></span>
<span><span class="co">#&gt; 5     2     8  (13.0426 47.79778, 13.04263 47.80008)   256.</span></span>
<span><span class="co">#&gt; 6     3     5 (13.05049 47.79874, 13.04921 47.79917)   107.</span></span>
<span><span class="co">#&gt; # ℹ 19 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 17 × 4</span></span>
<span><span class="co">#&gt;   name                  type     website                          geometry</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;                         &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartkino            cinema   https://www.mozartki… (13.04925 47.79698)</span></span>
<span><span class="co">#&gt; 2 Haus für Mozart       theatre  NA                     (13.0426 47.79778)</span></span>
<span><span class="co">#&gt; 3 Mozartsteg/Rudolfskai bus_stop NA                    (13.05049 47.79874)</span></span>
<span><span class="co">#&gt; # ℹ 14 more rows</span></span></code></pre>
</div>
</section><section class="level4"><h4 id="spatial-predicates">Spatial predicates<a class="anchor" aria-label="anchor" href="#spatial-predicates"></a>
</h4>
<p>In <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> there are also multiple functions that implement the evaluation of a <strong>spatial predicate</strong>. A spatial predicate describes a spatial relation between two geometries. For example, a point A may be located <em>within</em> a polygon B. In the example below we show how to evaluate for each node in a spatial network if it is located within one of two given polygons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polys</span> <span class="op">=</span> <span class="va">mozart</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">15</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fl">325</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">polys</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_within</a></span><span class="op">(</span><span class="va">polys</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sparse geometry binary predicate list of length 17, where the predicate</span></span>
<span><span class="co">#&gt; was `within'</span></span>
<span><span class="co">#&gt; first 10 elements:</span></span>
<span><span class="co">#&gt;  1: 1</span></span>
<span><span class="co">#&gt;  2: (empty)</span></span>
<span><span class="co">#&gt;  3: 1</span></span>
<span><span class="co">#&gt;  4: 1</span></span>
<span><span class="co">#&gt;  5: 1</span></span>
<span><span class="co">#&gt;  6: 1</span></span>
<span><span class="co">#&gt;  7: (empty)</span></span>
<span><span class="co">#&gt;  8: (empty)</span></span>
<span><span class="co">#&gt;  9: 1</span></span>
<span><span class="co">#&gt;  10: 1</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="spatial-joins-and-filters">Spatial joins and filters<a class="anchor" aria-label="anchor" href="#spatial-joins-and-filters"></a>
</h4>
<p>By using spatial predicates, <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> offers the ability to perform <strong>spatial joins</strong> and <strong>spatial filters</strong>. Spatial joins join information from a spatial feature to all features it has the specified spatial relation with. Spatial filters keep those features that have the specified spatial relation, and removes those that have not. For more details on spatial joins and filters for spatial networks, see the vignette <a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn04_join_filter.html">Spatial joins and filters</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">polys</span>, join <span class="op">=</span> <span class="va">st_within</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">new_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">polys</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_colour_discrete</a></span><span class="op">(</span><span class="st">"label"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">polys</span>, .predicate <span class="op">=</span> <span class="va">st_within</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">new_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">polys</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-29-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level4"><h4 id="geometric-unary-operations">Geometric unary operations<a class="anchor" aria-label="anchor" href="#geometric-unary-operations"></a>
</h4>
<p>Finally, <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> contains a group of functions known as <strong>geometric unary operations</strong>. These functions change the structure of individual geometries. Their usage in the context of spatial networks is limited, since many of them would break the network structure in which endpoints of edges are spatially equal to their respective nodes. Hence, only those geometric unary operations that do not change the type, shape, or position of the geometries have a method for <code>sfnetwork</code> objects. These include <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">sf::st_reverse()</a></code> to reverse edge geometries, and <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">sf::st_segmentize()</a></code> to add interior points to edge geometries. However, just as with unsupported tidyverse-verbs, you can still apply unsupported geometric unary operations by first extracting the active element as a <code>sf</code> object, and proceed your analysis on a single table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fl">250</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 17 features and 3 fields</span></span>
<span><span class="co">#&gt; Attribute-geometry relationships: constant (3)</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4548414 ymin: 2747059 xmax: 4549839 ymax: 2748787</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 17 × 4</span></span>
<span><span class="co">#&gt;    name                    type          website                        geometry</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt;                   &lt;chr&gt;         &lt;chr&gt;                     &lt;POLYGON [m]&gt;</span></span>
<span><span class="co">#&gt;  1 Mozartkino              cinema        https://www.… ((4549754 2747309, 45497…</span></span>
<span><span class="co">#&gt;  2 Haus für Mozart         theatre       NA            ((4549253 2747376, 45492…</span></span>
<span><span class="co">#&gt;  3 Mozartsteg/Rudolfskai   bus_stop      NA            ((4549839 2747507, 45498…</span></span>
<span><span class="co">#&gt;  4 Mozart Denkmal          artwork       NA            ((4549637 2747514, 45496…</span></span>
<span><span class="co">#&gt;  5 Mozartsteg/Rudolfskai   bus_stop      NA            ((4549741 2747551, 45497…</span></span>
<span><span class="co">#&gt;  6 Mozartsteg              bridge        NA            ((4549723 2747624, 45497…</span></span>
<span><span class="co">#&gt;  7 Mozarts Geburtshaus     museum        http://www.m… ((4549314 2747619, 45493…</span></span>
<span><span class="co">#&gt;  8 Café Mozart             cafe          https://www.… ((4549244 2747632, 45492…</span></span>
<span><span class="co">#&gt;  9 Mozartkugel             confectionery NA            ((4549370 2747654, 45493…</span></span>
<span><span class="co">#&gt; 10 Mozartsteg/Imbergstraße bus_stop      NA            ((4549668 2747723, 45496…</span></span>
<span><span class="co">#&gt; 11 Spirit of Mozart        artwork       https://salz… ((4549369 2747790, 45493…</span></span>
<span><span class="co">#&gt; 12 Mozart-Eine Hommage     artwork       https://salz… ((4548914 2747868, 45489…</span></span>
<span><span class="co">#&gt; 13 Mozarts Wohnhaus        apartments    NA            ((4549323 2747916, 45493…</span></span>
<span><span class="co">#&gt; 14 Universität Mozarteum   university    NA            ((4549309 2748042, 45493…</span></span>
<span><span class="co">#&gt; 15 Stiftung Mozarteum      concert_hall  NA            ((4549147 2748037, 45491…</span></span>
<span><span class="co">#&gt; 16 Hotel Mozart            hotel         http://www.h… ((4549628 2748391, 45496…</span></span>
<span><span class="co">#&gt; 17 Mozart Studentenheim    dormitory     NA            ((4549234 2748537, 45492…</span></span></code></pre>
</div>
</section></section><section class="level3"><h3 id="spatial-network-specific-additions">Spatial network specific additions<a class="anchor" aria-label="anchor" href="#spatial-network-specific-additions"></a>
</h3>
<p>As mentioned, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> extends the functionalities of <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> and <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> by offering functions that are specific for spatial network analysis, as well as functions that allow for a smoother integration of <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> into the design of <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> workflows. In contradiction to <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, all functions in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> that consider edge weights will always use geographic edge length as the default weight.</p>
<section class="level4"><h4 id="relating-networks-and-spatial-simple-features">Relating networks and spatial simple features<a class="anchor" aria-label="anchor" href="#relating-networks-and-spatial-simple-features"></a>
</h4>
<p>The first family of functions in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> have names formatted as <code>st_network_*</code>, adopting the naming conventions of <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>. All of these functions take a spatial network as first input an implement an analysis task that involves both the network and a set of regular spatial simple features (points, lines, polygons). The returned object can either be a set of spatial simple features computed from that network, the network itself with other spatial features merged into it, or another object (e.g., a matrix) that is the result of a computation relating the network to the spatial features. This covers a large range of use-cases. Examples include drawing isochrone or isodistance polygons around nodes, finding geographic shortest paths between pairs of nodes, computing cost matrices of travel between nodes, extracting the faces of the network, and adding external point data as new nodes to the network. In the other vignettes you will find more details on all of these functions.</p>
<p>There are also functions in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> that start only with <code>st_*</code>, and end with <code>*_network</code>. In contradiction to the <code>st_network_*</code> functions, these functions take a set of spatial features as first input, and the network as an additional argument. An example is <code>st_project_on_network</code>, that projects points onto the network.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find shortest path between node 1 and node 17.</span></span>
<span><span class="va">path</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">1</span>, <span class="fl">17</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw an isodistance polygon with 500m threshold around node 13.</span></span>
<span><span class="va">iso</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_iso.html">st_network_iso</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">13</span>, <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the faces of the network.</span></span>
<span><span class="va">faces</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_faces.html">st_network_faces</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Blend external points as new nodes into the network.</span></span>
<span><span class="va">feats</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">mozart</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">blend</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_blend.html">st_network_blend</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">feats</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">path</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"nodes"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">17</span><span class="op">)</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iso</span>, fill <span class="op">=</span> <span class="st">"orange"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"nodes"</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">faces_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">faces</span><span class="op">)</span><span class="op">)</span>, geometry <span class="op">=</span> <span class="va">faces</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">faces_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">blend</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">feats</span>, color <span class="op">=</span> <span class="st">"orange"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_nearest_points.html" class="external-link">st_nearest_points</a></span><span class="op">(</span><span class="va">feats</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_combine</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">blend</span>, <span class="st">"nodes"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-nrow="2" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-32-1.png" width="672"></p>
<figcaption>Shortest path</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-32-2.png" width="672"></p>
<figcaption>Isodistance polygon</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-32-3.png" width="672"></p>
<figcaption>Network faces</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-32-4.png" width="672"></p>
<figcaption>Blended points</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section class="level4"><h4 id="spatial-measures">Spatial measures<a class="anchor" aria-label="anchor" href="#spatial-measures"></a>
</h4>
<p>As an extension to the measure functions of <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, there are several <strong>spatial measure functions</strong> for nodes and edges to be found in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>. Just as in <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, these functions are named in the style of <code>node_*</code> or <code>edge_*</code>, or when it is a centrality measure, <code>centrality_*</code>. Edge measures that can be computed include for example the geographic length of an edge, its azimuth, or its circuity (i.e. the ratio between its geographic length and the shortest euclidean distance from source to target node). For nodes, it is for example possible to compute the straightness centrality (i.e. the average ratio of euclidean distance and network distance between that node and all other nodes in the network). <!-- More details in specific measures of spatial networks can be found in the vignette [Measuring spatial networks](). --></p>
<p>To better integrate spatial predicate functions of <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> into the design of <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, all applicable predicates are also implemented as node and edge measure function. These functions will return <code>TRUE</code> if the node or edge has the specified spatial relation with at least one of the given spatial features, and <code>FALSE</code> otherwise. This makes it easy to use the predicates directly inside functions such as <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/spatial_edge_predicates.html">edge_intersects</a></span><span class="op">(</span><span class="va">polys</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>circuity <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_circuity</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    sc <span class="op">=</span> <span class="fu"><a href="../reference/spatial_centrality.html">centrality_straightness</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    in_poly <span class="op">=</span> <span class="fu"><a href="../reference/spatial_node_predicates.html">node_is_within</a></span><span class="op">(</span><span class="va">polys</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">new_net</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 17 nodes and 21 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A bipartite simple graph with 1 component and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 17 × 6 (active)</span></span>
<span><span class="co">#&gt;   name                  type     website          geometry    sc in_poly</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;         &lt;POINT [m]&gt; &lt;dbl&gt; &lt;lgl&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartkino            cinema   https:… (4549504 2747309) 0.847 TRUE</span></span>
<span><span class="co">#&gt; 2 Haus für Mozart       theatre  NA      (4549003 2747376) 0.648 FALSE</span></span>
<span><span class="co">#&gt; 3 Mozartsteg/Rudolfskai bus_stop NA      (4549589 2747507) 0.878 TRUE</span></span>
<span><span class="co">#&gt; 4 Mozart Denkmal        artwork  NA      (4549387 2747514) 0.850 TRUE</span></span>
<span><span class="co">#&gt; 5 Mozartsteg/Rudolfskai bus_stop NA      (4549491 2747551) 0.874 TRUE</span></span>
<span><span class="co">#&gt; 6 Mozartsteg            bridge   NA      (4549473 2747624) 0.843 TRUE</span></span>
<span><span class="co">#&gt; # ℹ 11 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 21 × 5</span></span>
<span><span class="co">#&gt;    from    to                           geometry length circuity</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                   &lt;LINESTRING [m]&gt;    [m]    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     3 (4549504 2747309, 4549589 2747507)   216.        1</span></span>
<span><span class="co">#&gt; 2     1     4 (4549504 2747309, 4549387 2747514)   236.        1</span></span>
<span><span class="co">#&gt; 3     2     4 (4549003 2747376, 4549387 2747514)   409.        1</span></span>
<span><span class="co">#&gt; # ℹ 18 more rows</span></span></code></pre>
</div>
</section><section class="level4"><h4 id="spatial-clustering">Spatial clustering<a class="anchor" aria-label="anchor" href="#spatial-clustering"></a>
</h4>
<p>As an extension to the community detection functions in <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> contains the <code><a href="../reference/group_spatial.html">group_spatial_dbscan()</a></code> function to find <strong>spatial clusters</strong> of nodes. The idea is to offer multiple spatial clustering algorithms to choose from, but currently the only one implemented is the <a href="https://en.wikipedia.org/wiki/DBSCAN" class="external-link">DBSCAN</a> algorithm (which does require the <a href="https://github.com/mhahsler/dbscan" class="external-link">dbscan</a> package to be installed). The algorithm is executed on the network distance matrix of the nodes, and not on the euclidean distance matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="../reference/group_spatial.html">group_spatial_dbscan</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">new_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_colour_discrete</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-35-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level4"><h4 id="spatial-morphers">Spatial morphers<a class="anchor" aria-label="anchor" href="#spatial-morphers"></a>
</h4>
<p>As an extension to the morpher functions in <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, there are many different <strong>spatial morpher functions</strong> implemented in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>. Just as in <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, these function change the structure of the input network, for example by subsetting or splitting it, by combining multiple features into one, or by splitting single features. Common examples include subdividing the network at interior points in edge geometries, smoothing pseudo nodes that have a degree of 2, and contracting multiple nodes into one while preserving the network connectivity. In the other vignettes you will find more details on all of these functions. Many morphers are used for network cleaning operations, which are described in detail in the vignette <a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn03_cleaning.html">Cleaning spatial networks</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Smooth nodes of degree 2.</span></span>
<span><span class="va">smooth</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">to_spatial_smooth</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subdivide edges at each interior point in the smoothed network.</span></span>
<span><span class="co"># In this case this is the opposite of smoothing, it adds back the degree 2 nodes.</span></span>
<span><span class="va">division</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">smooth</span>, <span class="va">to_spatial_subdivision</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Contract nodes that are in the same spatial cluster.</span></span>
<span><span class="va">contraction</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="../reference/group_spatial.html">group_spatial_dbscan</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">to_spatial_contracted</span>, <span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset the graph to only those edges in a shortest path.</span></span>
<span><span class="va">path</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">to_spatial_shortest_paths</span>, <span class="fl">1</span>, <span class="fl">17</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">smooth</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">division</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">contraction</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-nrow="2" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-37-1.png" width="672"></p>
<figcaption>Smooth network</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-37-2.png" width="672"></p>
<figcaption>Subdivision of the smooth network</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-37-3.png" width="672"></p>
<figcaption>Contracted groups of nodes</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-37-4.png" width="672"></p>
<figcaption>A single path</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section class="level4"><h4 id="utilities">Utilities<a class="anchor" aria-label="anchor" href="#utilities"></a>
</h4>
<p>Finally, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> exports all kind of utility functions that should make working with spatial networks less cumbersome. An example is finding the nearest node and nearest edge to a given spatial feature. For an overview of all exported functions of the package, see the <a href="https://luukvdmeer.github.io/sfnetworks/reference/index.html">function reference</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_combine</a></span><span class="op">(</span><span class="va">mozart</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nn</span> <span class="op">=</span> <span class="fu"><a href="../reference/nearest.html">nearest_nodes</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">nn</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span></span>
<span><span class="co">#&gt; Attribute-geometry relationships: constant (3)</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4549119 ymin: 2747790 xmax: 4549119 ymax: 2747790</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   name             type    website                              geometry</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;                             &lt;POINT [m]&gt;</span></span>
<span><span class="co">#&gt; 1 Spirit of Mozart artwork https://salzburgfoundation… (4549119 2747790)</span></span></code></pre>
<div class="sourceCode cell-code" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ne</span> <span class="op">=</span> <span class="fu"><a href="../reference/nearest.html">nearest_edges</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">ne</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4549119 ymin: 2747723 xmax: 4549418 ymax: 2747790</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;    from    to                           geometry length</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                   &lt;LINESTRING [m]&gt;    [m]</span></span>
<span><span class="co">#&gt; 1    10    11 (4549418 2747723, 4549119 2747790)   306.</span></span></code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">p</span>, size <span class="op">=</span> <span class="fl">6</span>, pch <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nn</span>, color <span class="op">=</span> <span class="st">"orange"</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">p</span>, size <span class="op">=</span> <span class="fl">6</span>, pch <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ne</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-39-1.png" width="672"></p>
<figcaption>Nearest node</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-39-2.png" width="672"></p>
<figcaption>Nearest edge</figcaption></figure>
</div>
</div>
</div>
</div>
</section></section><section class="level3"><h3 id="non-tidyverse-workflows">Non-tidyverse workflows<a class="anchor" aria-label="anchor" href="#non-tidyverse-workflows"></a>
</h3>
<p>Also if you are not a fan of the tidyverse style of data analysis, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> can be for you. Since <code>sfnetwork</code> objects inherit the <code>igraph</code> class, you can apply all functions from the large <a href="https://r.igraph.org/" class="external-link">igraph</a> package to it. This means, for example, that instead of using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code>, you could proceed as follows (note that in <a href="https://r.igraph.org/" class="external-link">igraph</a>, the term <em>vertex</em> is used instead of <em>node</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Mutate.</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/vertex_attr.html" class="external-link">vertex_attr</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"label"</span><span class="op">)</span> <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://r.igraph.org/reference/gorder.html" class="external-link">vcount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Filter.</span></span>
<span><span class="va">drop</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://r.igraph.org/reference/gsize.html" class="external-link">ecount</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_net</span> <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/delete_edges.html" class="external-link">delete_edges</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">drop</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_net</span></span>
<span><span class="co">#&gt; IGRAPH f481e4e UN-B 17 12 -- </span></span>
<span><span class="co">#&gt; + attr: name (v/c), type (v/c), website (v/c), geometry (v/x), label</span></span>
<span><span class="co">#&gt; | (v/c), geometry (e/x), length (e/n)</span></span>
<span><span class="co">#&gt; + edges from f481e4e (vertex names):</span></span>
<span><span class="co">#&gt;  [1] Mozartkino             --Mozartsteg/Rudolfskai  </span></span>
<span><span class="co">#&gt;  [2] Haus für Mozart        --Café Mozart            </span></span>
<span><span class="co">#&gt;  [3] Mozart Denkmal         --Mozartsteg/Rudolfskai  </span></span>
<span><span class="co">#&gt;  [4] Mozarts Geburtshaus    --Café Mozart            </span></span>
<span><span class="co">#&gt;  [5] Mozartkugel            --Mozartsteg/Imbergstraße</span></span>
<span><span class="co">#&gt;  [6] Mozartkugel            --Spirit of Mozart       </span></span>
<span><span class="co">#&gt;  [7] Mozartsteg/Imbergstraße--Spirit of Mozart       </span></span>
<span><span class="co">#&gt; + ... omitted several edges</span></span></code></pre></div>
</div>
<p>As you can see, this returns a <code>igraph</code> object instead of a <code>sfnetwork</code> object. To preserve the class, you can use the <code><a href="../reference/wrap_igraph.html">wrap_igraph()</a></code> function of <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> for each <a href="https://r.igraph.org/" class="external-link">igraph</a> function that accepts a network as first input and returns another network. This function will check if the returned network is still spatial.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wrap_igraph.html">wrap_igraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">delete_edges</span>, <span class="va">drop</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A sfnetwork: 17 nodes and 12 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A bipartite simple graph with 6 components and spatially explicit edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Dimension: XY</span></span>
<span><span class="co">#&gt; # Bounding box: xmin: 4548664 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; # Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge data: 12 × 4 (active)</span></span>
<span><span class="co">#&gt;    from    to                           geometry length</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;                   &lt;LINESTRING [m]&gt;    [m]</span></span>
<span><span class="co">#&gt; 1     1     3 (4549504 2747309, 4549589 2747507)  216.</span></span>
<span><span class="co">#&gt; 2     2     8 (4549003 2747376, 4548994 2747632)  256.</span></span>
<span><span class="co">#&gt; 3     4     5 (4549387 2747514, 4549491 2747551)  110.</span></span>
<span><span class="co">#&gt; 4     7     8 (4549064 2747619, 4548994 2747632)   71.1</span></span>
<span><span class="co">#&gt; 5     9    10 (4549120 2747654, 4549418 2747723)  305.</span></span>
<span><span class="co">#&gt; 6     9    11 (4549120 2747654, 4549119 2747790)  136.</span></span>
<span><span class="co">#&gt; # ℹ 6 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node data: 17 × 5</span></span>
<span><span class="co">#&gt;   name                  type     website                  geometry label</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;                 &lt;POINT [m]&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartkino            cinema   https://www.mo… (4549504 2747309) a</span></span>
<span><span class="co">#&gt; 2 Haus für Mozart       theatre  NA              (4549003 2747376) b</span></span>
<span><span class="co">#&gt; 3 Mozartsteg/Rudolfskai bus_stop NA              (4549589 2747507) c</span></span>
<span><span class="co">#&gt; # ℹ 14 more rows</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mst</span> <span class="op">=</span> <span class="fu"><a href="../reference/wrap_igraph.html">wrap_igraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">mst</span>, weights <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/edge_attr.html" class="external-link">edge_attr</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"length"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">mst</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-42-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>All spatial measure functions can be evaluated outside the <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> framework using <code><a href="https://tidygraph.data-imaginist.com/reference/with_graph.html" class="external-link">with_graph()</a></code>, which works similar to base R’s <code><a href="https://rdrr.io/r/base/with.html" class="external-link">with()</a></code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/with_graph.html" class="external-link">with_graph</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_circuity</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span></span></code></pre></div>
</div>
<p>All spatial morpher functions that implement a larger workflow have their internal workers exported, meaning they can be called directly outside the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">tidygraph::morph()</a></code> and <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">tidygraph::convert()</a></code> verbs. All other morphers are easy to replicate using <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> or other <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> functions directly.</p>
</section></section><section class="level2"><h2 id="visualizing-spatial-networks">Visualizing spatial networks<a class="anchor" aria-label="anchor" href="#visualizing-spatial-networks"></a>
</h2>
<p>To quickly visualize the network you can use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method for <code>sfnetwork</code> objects. This will use <code>sf</code> to plot the geometries of nodes and edges in one view. Using the regular arguments of <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, you can change the style of the plot as a whole. Arguments <code>node_args</code> and <code>edge_args</code> are added such that you can also provide style settings for nodes and edges separately, in list-format.</p>
<div class="sourceCode cell-code" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mst</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mst</span>, col <span class="op">=</span> <span class="st">"orange"</span>, pch <span class="op">=</span> <span class="fl">8</span>, cex <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">mst</span>, </span>
<span>  node_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"orange"</span>, cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>  edge_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-44-1.png" width="672"></p>
<figcaption>Default settings</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-44-2.png" width="672"></p>
<figcaption>Custom settings</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-44-3.png" width="672"></p>
<figcaption>Custom settings</figcaption></figure>
</div>
</div>
</div>
</div>
<p>For more advanced visualizations, we recommend to use <a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a>. This is an extension of <code>{ggplot}</code> for network data that works seamlessly with <code>tbl_graph</code> data structures. In fact, <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a> was initially developed with the idea to provide a suitable data structure for <a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a> visualizations. It now also has native support for <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> with the <em>sf</em> layout and the <code><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">ggraph::geom_node_sf()</a></code> and <code><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">ggraph::geom_edge_sf()</a></code> geoms that are aware of the spatial nature of the data. Edges can also be plotted without their spatial embedding, using one of the many other geoms offerend by <a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a>. To plot additional spatial layers that are not networks, you can simply use <code>ggplot::geom_sf()</code>. For more details, check the <a href="https://ggraph.data-imaginist.com" class="external-link">ggraph documentation</a>.</p>
<div class="sourceCode cell-code" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">mst</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">mst</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">mst</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_fan.html" class="external-link">geom_edge_fan</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html" class="external-link">centrality_degree</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">mst</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"orange"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_combine</a></span><span class="op">(</span><span class="va">mozart</span><span class="op">)</span><span class="op">)</span>, <span class="fl">300</span><span class="op">)</span>, </span>
<span>    fill <span class="op">=</span> <span class="st">"skyblue"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-nrow="2" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-45-1.png" width="672"></p>
<figcaption>Default settings</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-45-2.png" width="672"></p>
<figcaption>Custom settings</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-45-3.png" width="672"></p>
<figcaption>Custom settings</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn01_intro_files/figure-html/unnamed-chunk-45-4.png" width="672"></p>
<figcaption>Additional layers</figcaption></figure>
</div>
</div>
</div>
</div>
<p>If you want to create Leaflet-based interactive maps, take a look at the packages <a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a> or <a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a>. These are well integrated with <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>, so you can extract nodes and edges from the network, and plot them as two separate layers.</p>
</section><section class="level2"><h2 id="learning-more">Learning more<a class="anchor" aria-label="anchor" href="#learning-more"></a>
</h2>
<p>This vignette provided an introduction to <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>. The documentation contains several other vignettes that dive into more detail:</p>
<ul>
<li><a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn02_create_represent.html">Creating and representing spatial networks</a></li>
<li><a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn03_cleaning.html">Cleaning spatial networks</a></li>
<li><a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn04_join_filter.html">Spatial joins and filters</a></li>
<li><a href="https://luukvdmeer.github.io/sfnetworks/articles/sfn05_routing.html">Routing on spatial networks</a></li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
