<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. The sfnetwork data structure • sfnetworks</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. The sfnetwork data structure">
<meta property="og:description" content="sfnetworks">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfnetworks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/structure.html">1. The sfnetwork data structure</a>
    </li>
    <li>
      <a href="../articles/preprocess_and_clean.html">2. Network pre-processing and cleaning</a>
    </li>
    <li>
      <a href="../articles/join_filter.html">3. Spatial joins and filters</a>
    </li>
    <li>
      <a href="../articles/routing.html">4. Routing</a>
    </li>
    <li>
      <a href="../articles/morphers.html">5. Spatial morphers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/luukvdmeer/sfnetworks/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="structure_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>1. The sfnetwork data structure</h1>
            
            <h4 class="date">2020-12-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/luukvdmeer/sfnetworks/blob/master/vignettes/structure.Rmd"><code>vignettes/structure.Rmd</code></a></small>
      <div class="hidden name"><code>structure.Rmd</code></div>

    </div>

    
    
<style type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>The core of the sfnetworks package is the sfnetwork data structure. It inherits the tbl_graph class from the <a href="https://tidygraph.data-imaginist.com/index.html">tidygraph package</a>, which itself inherits the igraph class from the <a href="https://igraph.org/">igraph package</a>. Therefore, sfnetwork objects are recognized by all network analysis algorithms that <code>igraph</code> offers (which are a lot, see <a href="https://igraph.org/r/doc/">here</a>) as well as by the tidy wrappers that <code>tidygraph</code> has built around them.</p>
<p>It is possible to apply any function from the <a href="https://www.tidyverse.org/">tidyverse packages</a> for data science directly to a sfnetwork, as long as <code>tidygraph</code> implemented a network specific method for it. On top of that, <code>sfnetworks</code> added several methods for functions from the <a href="https://r-spatial.github.io/sf/">sf package</a> for spatial data science, such that you can also apply those directly to the network. This takes away the need to constantly switch between the tbl_graph, tbl_df and sf classes when working with geospatial networks.</p>
<div id="philosophy" class="section level2">
<h2 class="hasAnchor">
<a href="#philosophy" class="anchor"></a>Philosophy</h2>
<p>The philosophy of a tbl_graph object is best described by the following paragraph from the <a href="https://www.data-imaginist.com/2017/introducing-tidygraph/">tidygraph introduction</a>: “Relational data cannot in any meaningful way be encoded as a single tidy data frame. On the other hand, both node and edge data by itself fits very well within the tidy concept as each node and edge is, in a sense, a single observation. Thus, a close approximation of tidyness for relational data is two tidy data frames, one describing the node data and one describing the edge data.”</p>
<p>Since sfnetworks subclass tbl_graph, it shares the same philosophy. However, it extends it into the domain of geospatial data analysis, where each observation has a location in geographical space. For that, it brings <code>sf</code> into the game. An sf object stores the geographical coordinates of each observation in standardized format in a geometry list-column, which has a Coordinate Reference System (CRS) associated with it. Thus, in <code>sfnetworks</code>, we re-formulate the last sentence of the paragraph above to the following. “A close approximation of tidyness for relational <em>geospatial data</em> is two <em>sf objects</em>, one describing the node data and one describing the edge data.”</p>
<p>We do need to make a note here. In a geospatial network, the nodes <em>always</em> have coordinates in geographic space, and thus, can always be described by an sf object. The edges, however, can also be described by only the indices of the nodes at their ends. This still makes them geospatial, because they connect two specific points in space, but the spatial information is not <em>explicitly</em> attached to them. Both representations can be useful. In road networks, for example, it makes sense to explicitly draw a line geometry between two nodes, while in geolocated social networks, it probably does not. <code>sfnetworks</code> supports both types. It can either describe edges as an sf object, with a linestring geometry stored in a geometry list-column, or as a regular data frame, with the spatial information implicitly encoded in the node indices of the endpoints. We refer to these two different types of edges as <em>spatially explicit edges</em> and <em>spatially implicit edges</em> respectively. In most of the documentation, however, we focus on the first type, and talk about edges as being an sf object with linestring geometries.</p>
</div>
<div id="construction" class="section level2">
<h2 class="hasAnchor">
<a href="#construction" class="anchor"></a>Construction</h2>
<div id="from-a-nodes-and-edges-table" class="section level3">
<h3 class="hasAnchor">
<a href="#from-a-nodes-and-edges-table" class="anchor"></a>From a nodes and edges table</h3>
<p>The most basic way to construct a sfnetwork with spatially explicit edges is by providing the <code>sfnetwork</code> construction function one sf object containing the nodes, and another sf object containing the edges. This edges table should include a <em>from</em> and <em>to</em> column referring to the node indices of the edge endpoints. With a node index we mean the position of a node in the nodes table (i.e. its rownumber). A small toy example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com">tidygraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">51.5</span><span class="op">)</span><span class="op">)</span>

<span class="va">l1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p4</span>, <span class="va">p3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">l3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">p2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span>, <span class="va">l3</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>
<span class="va">nodes</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>

<span class="va">edges</span><span class="op">$</span><span class="va">from</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">edges</span><span class="op">$</span><span class="va">to</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>

<span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Spatial network structure is valid</span>
<span class="va">net</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A directed acyclic simple graph with 1 component with spatially explicit edges
#&gt; #
#&gt; # Node Data:     3 x 1 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;             x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>      (7 51)
#&gt; </span><span style="color: #555555;">2</span><span>      (7 52)
#&gt; </span><span style="color: #555555;">3</span><span>      (8 52)
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     3 x 3</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;    from    to                    x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2         (7 51, 7 52)
#&gt; </span><span style="color: #555555;">2</span><span>     1     3 (7 51, 8 51.5, 8 52)
#&gt; </span><span style="color: #555555;">3</span><span>     3     2         (8 52, 7 52)
</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>
<span class="co">#&gt; [1] "sfnetwork" "tbl_graph" "igraph"</span></code></pre></div>
<p>By default, the created network is a directed network. If you want to create an undirected network, set <code>directed = FALSE</code>. Note that for undirected networks, the indices in the <em>from</em> and <em>to</em> columns are re-arranged such that the <em>from</em> index is always smaller than (or equal to, for loop edges) the <em>to</em> index. However, the linestring geometries remain unchanged. That means that in undirected networks it can happen that for some edges the <em>from</em> index refers to the last point of the edge linestring, and the <em>to</em> index to the first point. The behavior of ordering the indices comes from <code>igraph</code> and might be confusing, but remember that in undirected networks the terms <em>from</em> and <em>to</em> do not have a meaning and can thus be used interchangeably.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Spatial network structure is valid</span>
<span class="va">net</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected simple graph with 1 component with spatially explicit edges
#&gt; #
#&gt; # Node Data:     3 x 1 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;             x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>      (7 51)
#&gt; </span><span style="color: #555555;">2</span><span>      (7 52)
#&gt; </span><span style="color: #555555;">3</span><span>      (8 52)
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     3 x 3</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;    from    to                    x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2         (7 51, 7 52)
#&gt; </span><span style="color: #555555;">2</span><span>     1     3 (7 51, 8 51.5, 8 52)
#&gt; </span><span style="color: #555555;">3</span><span>     2     3         (8 52, 7 52)
</span></code></pre>
<p>Instead of <em>from</em> and <em>to</em> columns containing integers that refer to node indices, the provided edges table can also have <em>from</em> and <em>to</em> columns containing characters that refer to node keys. In that case, you should tell the construction function which column in the nodes table contains these keys. Internally, they will then be converted to integer indices.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nodes</span><span class="op">$</span><span class="va">name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"city"</span>, <span class="st">"village"</span>, <span class="st">"farm"</span><span class="op">)</span>
<span class="va">edges</span><span class="op">$</span><span class="va">from</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"city"</span>, <span class="st">"city"</span>, <span class="st">"farm"</span><span class="op">)</span>
<span class="va">edges</span><span class="op">$</span><span class="va">to</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"village"</span>, <span class="st">"farm"</span>, <span class="st">"village"</span><span class="op">)</span>

<span class="va">edges</span>
<span class="co">#&gt; Simple feature collection with 3 features and 2 fields</span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 7 ymin: 51 xmax: 8 ymax: 52</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt;                                x from      to</span>
<span class="co">#&gt; 1        LINESTRING (7 51, 7 52) city village</span>
<span class="co">#&gt; 2 LINESTRING (7 51, 8 51.5, 8... city    farm</span>
<span class="co">#&gt; 3        LINESTRING (8 52, 7 52) farm village</span>

<span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span>, node_key <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Spatial network structure is valid</span>
<span class="va">net</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A directed acyclic simple graph with 1 component with spatially explicit edges
#&gt; #
#&gt; # Node Data:     3 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;             x name   
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  
#&gt; </span><span style="color: #555555;">1</span><span>      (7 51) city   
#&gt; </span><span style="color: #555555;">2</span><span>      (7 52) village
#&gt; </span><span style="color: #555555;">3</span><span>      (8 52) farm   
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     3 x 3</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;    from    to                    x
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2         (7 51, 7 52)
#&gt; </span><span style="color: #555555;">2</span><span>     1     3 (7 51, 8 51.5, 8 52)
#&gt; </span><span style="color: #555555;">3</span><span>     3     2         (8 52, 7 52)
</span></code></pre>
<p>In a tbl_graph structure, the weights of edges are normally stored in a column named <em>weight</em>. You can set edge weights yourself after construction (see the example in the <a href="#activation-1">activation section</a>). For convenience, you can also tell the construction function to calculate the geographical lengths of the edges and set those as weights during construction.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">edges</span><span class="op">$</span><span class="va">from</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">edges</span><span class="op">$</span><span class="va">to</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>

<span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span>, length_as_weight <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Spatial network structure is valid</span>
<span class="va">net</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A directed acyclic simple graph with 1 component with spatially explicit edges
#&gt; #
#&gt; # Node Data:     3 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;             x name   
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  
#&gt; </span><span style="color: #555555;">1</span><span>      (7 51) city   
#&gt; </span><span style="color: #555555;">2</span><span>      (7 52) village
#&gt; </span><span style="color: #555555;">3</span><span>      (8 52) farm   
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     3 x 4</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7 ymin: 51 xmax: 8 ymax: 52</span><span>
#&gt;    from    to                    x    weight
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>       </span><span style="color: #555555;">[m]</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2         (7 51, 7 52) 111257.83
#&gt; </span><span style="color: #555555;">2</span><span>     1     3 (7 51, 8 51.5, 8 52) 144899.77
#&gt; </span><span style="color: #555555;">3</span><span>     3     2         (8 52, 7 52)  68677.47
</span></code></pre>
<p>If your edges table does not have linestring geometries, but only references to node indices or keys, you can tell the construction function to create the linestring geometries during construction. This will draw a straight line between the endpoints of each edge.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">=</span> <span class="cn">NULL</span>

<span class="va">other_net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span>, edges_as_lines <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Spatial network structure is valid</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">net</span>, cex <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, main <span class="op">=</span> <span class="st">"Original geometries"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">other_net</span>, cex <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, main <span class="op">=</span> <span class="st">"Straight lines"</span><span class="op">)</span></code></pre></div>
<p><img src="structure_files/figure-html/unnamed-chunk-6-1.png" width="50%"><img src="structure_files/figure-html/unnamed-chunk-6-2.png" width="50%"></p>
<p>A sfnetwork should have a <em>valid</em> spatial network structure. For the nodes, this currently means that their geometries should all be of type <em>POINT</em>. In the case of spatially explicit edges, edge geometries should all be of type <em>LINESTRING</em>, nodes and edges should have the same CRS and endpoints of edges should match their corresponding node coordinates.</p>
<p>If your provided data do not meet these requirements, the construction function will throw an error.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">l2</span>, <span class="va">l3</span>, <span class="va">l1</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>

<span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Error: Edge boundaries do not match their corresponding nodes</span></code></pre></div>
<p>You can skip the validity checks if you are already sure your input data meet the requirements, or if you don’t care that they don’t. To do so, set <code>force = TRUE</code>. However, remember that all functions in <code>sfnetworks</code> are designed with the assumption that the network has a valid structure.</p>
</div>
<div id="from-an-sf-object-with-linestring-geometries" class="section level3">
<h3 class="hasAnchor">
<a href="#from-an-sf-object-with-linestring-geometries" class="anchor"></a>From an sf object with linestring geometries</h3>
<p>Instead of already providing a nodes and edges table with a valid network structure, it is also possible to create a network by only providing an sf object with geometries of type <em>LINESTRING</em>. Probably, this way of construction is most convenient and will be most often used.</p>
<p>It works as follows: the provided lines form the edges of the network, and nodes are created at their endpoints. Endpoints that are shared between multiple lines become one single node.</p>
<p>See below an example using the Roxel dataset that comes with the package. This dataset is an sf object with <em>LINESTRING</em> geometries that form the road network of Roxel, a neighborhood in the German city of Münster.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roxel</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; Simple feature collection with 851 features and 2 fields
#&gt; geometry type:  LINESTRING
#&gt; dimension:      XY
#&gt; bbox:           xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612
#&gt; geographic CRS: WGS 84
#&gt; <span style="color: #555555;"># A tibble: 851 x 3</span><span>
#&gt;    name           type                                                  geometry
#&gt;  </span><span style="color: #555555;">*</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                                         </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;"> 1</span><span> Havixbecker S… residen…                (7.533722 51.95556, 7.533461 51.95576)
#&gt; </span><span style="color: #555555;"> 2</span><span> Pienersallee   seconda… (7.532442 51.95422, 7.53236 51.95377, 7.53209 51.953…
#&gt; </span><span style="color: #555555;"> 3</span><span> Schulte-Bernd… residen… (7.532709 51.95209, 7.532823 51.95239, 7.532869 51.9…
#&gt; </span><span style="color: #555555;"> 4</span><span> </span><span style="color: #BB0000;">NA</span><span>             path     (7.540063 51.94468, 7.539696 51.94479, 7.539466 51.9…
#&gt; </span><span style="color: #555555;"> 5</span><span> Welsingheide   residen…                 (7.537673 51.9475, 7.537614 51.94562)
#&gt; </span><span style="color: #555555;"> 6</span><span> </span><span style="color: #BB0000;">NA</span><span>             footway  (7.543791 51.94733, 7.54369 51.94686, 7.543751 51.94…
#&gt; </span><span style="color: #555555;"> 7</span><span> </span><span style="color: #BB0000;">NA</span><span>             footway                  (7.54012 51.94478, 7.539931 51.94514)
#&gt; </span><span style="color: #555555;"> 8</span><span> </span><span style="color: #BB0000;">NA</span><span>             path     (7.53822 51.94546, 7.538131 51.94549, 7.538027 51.94…
#&gt; </span><span style="color: #555555;"> 9</span><span> </span><span style="color: #BB0000;">NA</span><span>             track    (7.540063 51.94468, 7.540338 51.94468, 7.540591 51.9…
#&gt; </span><span style="color: #555555;">10</span><span> </span><span style="color: #BB0000;">NA</span><span>             track    (7.5424 51.94599, 7.54205 51.94629, 7.541967 51.9463…
#&gt; </span><span style="color: #555555;"># … with 841 more rows</span><span>
</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">roxel</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></code></pre></div>
<p><img src="structure_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
<p>Other methods to convert ‘foreign’ objects into a sfnetwork exists as well, e.g. for SpatialLinesNetwork objects from <code>stplanr</code> and linnet objects from <code>spatstat</code>. See <a href="https://luukvdmeer.github.io/sfnetworks/reference/as_sfnetwork.html">here</a> for an overview.</p>
</div>
<div id="from-a-network-specific-file-type" class="section level3">
<h3 class="hasAnchor">
<a href="#from-a-network-specific-file-type" class="anchor"></a>From a network specific file type</h3>
<p>To create networks from spatial data file types, you can use the sf function <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">sf::st_read()</a></code> to read them into R and then construct a sfnetwork from the sf object(s) using either <code><a href="../reference/sfnetwork.html">sfnetwork()</a></code> or <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> as described above. To create networks from graph specific file types, you can use the igraph function <code><a href="https://rdrr.io/pkg/igraph/man/read_graph.html">igraph::read_graph()</a></code> to read them into R, and then convert them to a sfnetwork using <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> if possible. Lets look at an example with a GraphML file. First, we will convert it to a tbl_graph after loading such that we can explore the data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url</span> <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/ComplexNetTSP/Power_grids/v1.0.0/Countries/Netherlands/graphml/Netherlands_highvoltage.graphml'</span>

<span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/read_graph.html">read_graph</a></span><span class="op">(</span><span class="va">url</span>, format <span class="op">=</span> <span class="st">"graphml"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/tbl_graph.html">as_tbl_graph</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A tbl_graph: 91 nodes and 101 edges
#&gt; #
#&gt; # An undirected simple graph with 2 components
#&gt; #
#&gt; # Node Data: 91 x 14 (active)</span><span>
#&gt;   netcapacity typ   wktsrid4326 lat   voltage frequency ngen  operator lon  
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>       </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>       </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> </span><span style="color: #555555;">""</span><span>          subs… SRID=4326;… 52.3… 110000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>    </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> 6.67…
#&gt; </span><span style="color: #555555;">2</span><span> </span><span style="color: #555555;">""</span><span>          subs… SRID=4326;… 52.2… 110000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>    </span><span style="color: #555555;">""</span><span>       6.83…
#&gt; </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">""</span><span>          subs… SRID=4326;… 53.4… 220000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>    </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> 6.86…
#&gt; </span><span style="color: #555555;">4</span><span> </span><span style="color: #555555;">""</span><span>          joint SRID=4326;… 53.2… 220000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>    </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> 6.47…
#&gt; </span><span style="color: #555555;">5</span><span> </span><span style="color: #555555;">""</span><span>          joint SRID=4326;… 51.4… 150000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>    </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> 5.62…
#&gt; </span><span style="color: #555555;">6</span><span> </span><span style="color: #555555;">""</span><span>          joint SRID=4326;… 52.4… 150000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>    </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> 4.87…
#&gt; </span><span style="color: #555555;"># … with 85 more rows, and 5 more variables: ref </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, source </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,</span><span>
#&gt; </span><span style="color: #555555;">#   name </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, capacity </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, id </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data: 101 x 18</span><span>
#&gt;    from    to rohmkm cables wktsrid4326 operator type  lengthm voltage frequency
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>       </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    
#&gt; </span><span style="color: #555555;">1</span><span>     1    52 </span><span style="color: #555555;">""</span><span>     6;3;3… SRID=4326;… </span><span style="color: #555555;">""</span><span>       line  49125.… 380000… 50       
#&gt; </span><span style="color: #555555;">2</span><span>     1    21 </span><span style="color: #555555;">""</span><span>     3;3;3… SRID=4326;… </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> line  7653.0… 110000… 50;50    
#&gt; </span><span style="color: #555555;">3</span><span>     2    23 </span><span style="color: #555555;">""</span><span>     6;6    SRID=4326;… </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> line  6135.3… 380000… 50       
#&gt; </span><span style="color: #555555;"># … with 98 more rows, and 8 more variables: cnfkm </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, fromrelation </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,</span><span>
#&gt; </span><span style="color: #555555;">#   ref </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, name </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, xohmkm </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, wires </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, ithmaxa </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, lid </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
</span></code></pre>
<p>We can see that the spatial geometries of nodes and edges are stored as WKT strings in columns named <em>wktsrid4326</em>. The sf function <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code> can easily convert such columns into the geometry list-column format that we need. Both <code><a href="../reference/sfnetwork.html">sfnetwork()</a></code> and <code><a href="../reference/as_sfnetwork.html">as_sfnetwork()</a></code> accept additional arguments as <code>...</code> that will be internally forwarded to convert the nodes into an sf object before creating the network structure. Hence, we can directly convert the igraph object into a sfnetwork.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/read_graph.html">read_graph</a></span><span class="op">(</span><span class="va">url</span>, format <span class="op">=</span> <span class="st">"graphml"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span>wkt <span class="op">=</span> <span class="st">"wktsrid4326"</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Spatial network structure is valid</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">91</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">101</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected simple graph with 2 components with spatially implicit edges
#&gt; #
#&gt; # Node Data:     91 x 14 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 3.692428 ymin: 51.14805 xmax: 7.041048 ymax: 53.44424</span><span>
#&gt;   netcapacity typ                 wktsrid4326 lat   voltage frequency ngen 
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>       </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>               </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> </span><span style="color: #555555;">""</span><span>          subs…       (6.679331 52.32104) 52.3… 110000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">2</span><span> </span><span style="color: #555555;">""</span><span>          subs…        (6.830673 52.2139) 52.2… 110000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">""</span><span>          subs…       (6.869683 53.42999) 53.4… 220000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">4</span><span> </span><span style="color: #555555;">""</span><span>          joint       (6.474364 53.21321) 53.2… 220000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">5</span><span> </span><span style="color: #555555;">""</span><span>          joint       (5.621211 51.45516) 51.4… 150000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">6</span><span> </span><span style="color: #555555;">""</span><span>          joint       (4.873691 52.42842) 52.4… 150000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;"># … with 85 more rows, and 7 more variables: operator </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, lon </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,</span><span>
#&gt; </span><span style="color: #555555;">#   ref </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, source </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, name </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, capacity </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, id </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data: 101 x 18</span><span>
#&gt;    from    to rohmkm cables wktsrid4326 operator type  lengthm voltage frequency
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>       </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    
#&gt; </span><span style="color: #555555;">1</span><span>     1    52 </span><span style="color: #555555;">""</span><span>     6;3;3… SRID=4326;… </span><span style="color: #555555;">""</span><span>       line  49125.… 380000… 50       
#&gt; </span><span style="color: #555555;">2</span><span>     1    21 </span><span style="color: #555555;">""</span><span>     3;3;3… SRID=4326;… </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> line  7653.0… 110000… 50;50    
#&gt; </span><span style="color: #555555;">3</span><span>     2    23 </span><span style="color: #555555;">""</span><span>     6;6    SRID=4326;… </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> line  6135.3… 380000… 50       
#&gt; </span><span style="color: #555555;"># … with 98 more rows, and 8 more variables: cnfkm </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, fromrelation </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,</span><span>
#&gt; </span><span style="color: #555555;">#   ref </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, name </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, xohmkm </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, wires </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, ithmaxa </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, lid </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
</span></code></pre>
<p>Forwarding of additional arguments to <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code> only affects the nodes table, since that is the one that by definition <em>has</em> to be an sf object. Therefore, it left the edges unaffected and created a network without a geometry list-column for the edges (i.e. a network with spatially implicit edges). We can ‘spatially explicitize’ the edges after construction by using a spatial morpher function named <code><a href="../reference/spatial_morphers.html">to_spatial_explicit_edges()</a></code>. To learn more about spatial morphers and what they are, see the <a href="https://luukvdmeer.github.io/sfnetworks/articles/morphers.html">dedicated vignette</a> for that. For now, it is sufficient to know that you can use any spatial morpher function inside the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">tidygraph::convert()</a></code> verb to convert your network into a different state.</p>
<p>The <code><a href="../reference/spatial_morphers.html">to_spatial_explicit_edges()</a></code> function also accepts <code>...</code> arguments that are forwarded to <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graphml_net</span> <span class="op">=</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/read_graph.html">read_graph</a></span><span class="op">(</span><span class="va">url</span>, format <span class="op">=</span> <span class="st">"graphml"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span>wkt <span class="op">=</span> <span class="st">"wktsrid4326"</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span><span class="va">to_spatial_explicit_edges</span>, wkt <span class="op">=</span> <span class="st">"wktsrid4326"</span>, crs <span class="op">=</span> <span class="fl">4326</span>, .clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Spatial network structure is valid</span>

<span class="va">graphml_net</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">91</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">101</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected simple graph with 2 components with spatially explicit edges
#&gt; #
#&gt; # Node Data:     91 x 14 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 3.692428 ymin: 51.14805 xmax: 7.041048 ymax: 53.44424</span><span>
#&gt;   netcapacity typ                 wktsrid4326 lat   voltage frequency ngen 
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>       </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>               </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> </span><span style="color: #555555;">""</span><span>          subs…       (6.679331 52.32104) 52.3… 110000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">2</span><span> </span><span style="color: #555555;">""</span><span>          subs…        (6.830673 52.2139) 52.2… 110000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">3</span><span> </span><span style="color: #555555;">""</span><span>          subs…       (6.869683 53.42999) 53.4… 220000  </span><span style="color: #555555;">""</span><span>        </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">4</span><span> </span><span style="color: #555555;">""</span><span>          joint       (6.474364 53.21321) 53.2… 220000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">5</span><span> </span><span style="color: #555555;">""</span><span>          joint       (5.621211 51.45516) 51.4… 150000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;">6</span><span> </span><span style="color: #555555;">""</span><span>          joint       (4.873691 52.42842) 52.4… 150000… </span><span style="color: #555555;">"</span><span>50;50;5… </span><span style="color: #555555;">""</span><span>   
#&gt; </span><span style="color: #555555;"># … with 85 more rows, and 7 more variables: operator </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, lon </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,</span><span>
#&gt; </span><span style="color: #555555;">#   ref </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, source </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, name </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, capacity </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, id </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     101 x 18</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 3.692428 ymin: 51.14805 xmax: 7.041048 ymax: 53.44424</span><span>
#&gt;    from    to rohmkm cables               wktsrid4326 operator type  lengthm
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  
#&gt; </span><span style="color: #555555;">1</span><span>     1    52 </span><span style="color: #555555;">""</span><span>     6;3;3… (6.188921 52.53048, 6.67… </span><span style="color: #555555;">""</span><span>       line  49125.…
#&gt; </span><span style="color: #555555;">2</span><span>     1    21 </span><span style="color: #555555;">""</span><span>     3;3;3… (6.768035 52.27755, 6.67… </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> line  7653.0…
#&gt; </span><span style="color: #555555;">3</span><span>     2    23 </span><span style="color: #555555;">""</span><span>     6;6    (6.830673 52.2139, 6.760… </span><span style="color: #555555;">"</span><span>TenneT</span><span style="color: #555555;">"</span><span> line  6135.3…
#&gt; </span><span style="color: #555555;"># … with 98 more rows, and 10 more variables: voltage </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, frequency </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,</span><span>
#&gt; </span><span style="color: #555555;">#   cnfkm </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, fromrelation </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, ref </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, name </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, xohmkm </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">,</span><span>
#&gt; </span><span style="color: #555555;">#   wires </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, ithmaxa </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span style="color: #555555;">, lid </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>
</span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">graphml_net</span><span class="op">)</span></code></pre></div>
<p><img src="structure_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
<div id="activation" class="section level2">
<h2 class="hasAnchor">
<a href="#activation" class="anchor"></a>Activation</h2>
<p>A sfnetwork is a multitable object in which the core network elements (i.e. nodes and edges) are embedded as sf objects. However, thanks to the neat structure of <code>tidygraph</code>, there is no need to first extract one of those elements before you are able to apply your favorite sf function or tidyverse verb. Instead, there is always one element at a time labeled as <em>active</em>. This active element is the target of data manipulation. All functions from sf and the tidyverse that are called on a sfnetwork, are internally applied to that active element. The active element can be changed with the <code><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate()</a></code> verb, i.e. by calling <code><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate("nodes")</a></code> or <code><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate("edges")</a></code>. For example, calculating the betweenness centrality of nodes and subsequently setting the geographical length of edges as edge weights can be done as follows:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bc <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_betweenness</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A directed multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 6 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;    from    to name       type                                  geometry   weight
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>      </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                         </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbeck… reside… (7.533722 51.95556, 7.533461 51.95576)  28.859…
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersal… second… (7.532442 51.95422, 7.53236 51.95377,… 107.704…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-B… reside… (7.532709 51.95209, 7.532823 51.95239…  54.362…
#&gt; </span><span style="color: #555555;">4</span><span>     7     8 </span><span style="color: #BB0000;">NA</span><span>         path    (7.540063 51.94468, 7.539696 51.94479… 155.230…
#&gt; </span><span style="color: #555555;">5</span><span>     9    10 Welsinghe… reside…  (7.537673 51.9475, 7.537614 51.94562) 208.663…
#&gt; </span><span style="color: #555555;">6</span><span>    11    12 </span><span style="color: #BB0000;">NA</span><span>         footway (7.543791 51.94733, 7.54369 51.94686,…  63.023…
#&gt; </span><span style="color: #555555;"># … with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 2</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;              geometry     bc
#&gt;           </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (7.533722 51.95556) </span><span style="text-decoration: underline;">12</span><span>936.
#&gt; </span><span style="color: #555555;">2</span><span> (7.533461 51.95576) </span><span style="text-decoration: underline;">11</span><span>824 
#&gt; </span><span style="color: #555555;">3</span><span> (7.532442 51.95422) </span><span style="text-decoration: underline;">11</span><span>926.
#&gt; </span><span style="color: #555555;"># … with 698 more rows</span><span>
</span></code></pre>
<p>Some of the functions have effects also outside of the active element. For example, whenever nodes are removed from the network, the edges terminating at those nodes will be removed too. This behavior is <em>not</em> symmetric: when removing edges, the endpoints of those edges remain, even if they are not an endpoint of any other edge. This is because by definition edges can never exist without nodes on their ends, while nodes can peacefully exist in isolation.</p>
</div>
<div id="extraction" class="section level2">
<h2 class="hasAnchor">
<a href="#extraction" class="anchor"></a>Extraction</h2>
<p>Neither all sf functions nor all tidyverse verbs can be directly applied to a sfnetwork as described above. That is because there is a clear limitation in the relational data structure that requires rows to maintain their identity. Hence, a verb like <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">dplyr::summarise()</a></code> has no clear application for a network. For sf functions, this means also that the valid spatial network structure should be maintained. That is, functions that summarise geometries, or (may) change their <em>type</em>, <em>shape</em> or <em>position</em>, are not supported directly. These are for example the <a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">geometric binary operations</a>, most of the <a href="https://r-spatial.github.io/sf/reference/geos_unary.html">geometric unary operations</a>, <code><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">sf::st_union()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">sf::st_combine()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_cast.html">sf::st_cast()</a></code>, and <code><a href="https://r-spatial.github.io/sf/reference/st_jitter.html">sf::st_jitter()</a></code>.</p>
<p>These functions cannot be directly applied to a sfnetwork, but no need to panic! The active element of the network can at any time be extracted with <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code> (or <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">tibble::as_tibble()</a></code>). This allows you to continue a specific part of your analysis <em>outside</em> of the network structure, using a regular sf object. Afterwards you could join inferred information back into the network. See the vignette about <a href="https://luukvdmeer.github.io/sfnetworks/articles/join_filter.html">spatial joins</a> for more details.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; Simple feature collection with 701 features and 0 fields
#&gt; geometry type:  POINT
#&gt; dimension:      XY
#&gt; bbox:           xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612
#&gt; geographic CRS: WGS 84
#&gt; <span style="color: #555555;"># A tibble: 701 x 1</span><span>
#&gt;               geometry
#&gt;            </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;"> 1</span><span> (7.533722 51.95556)
#&gt; </span><span style="color: #555555;"> 2</span><span> (7.533461 51.95576)
#&gt; </span><span style="color: #555555;"> 3</span><span> (7.532442 51.95422)
#&gt; </span><span style="color: #555555;"> 4</span><span>  (7.53209 51.95328)
#&gt; </span><span style="color: #555555;"> 5</span><span> (7.532709 51.95209)
#&gt; </span><span style="color: #555555;"> 6</span><span> (7.532869 51.95257)
#&gt; </span><span style="color: #555555;"> 7</span><span> (7.540063 51.94468)
#&gt; </span><span style="color: #555555;"> 8</span><span>  (7.53822 51.94546)
#&gt; </span><span style="color: #555555;"> 9</span><span>  (7.537673 51.9475)
#&gt; </span><span style="color: #555555;">10</span><span> (7.537614 51.94562)
#&gt; </span><span style="color: #555555;"># … with 691 more rows</span><span>
</span></code></pre>
<p>Although we recommend for reasons of clarity to always explicitly activate an element before extraction, you can also use a shortcut by providing the name of the element you want to extract as extra argument to <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"edges"</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; Simple feature collection with 851 features and 4 fields
#&gt; geometry type:  LINESTRING
#&gt; dimension:      XY
#&gt; bbox:           xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612
#&gt; geographic CRS: WGS 84
#&gt; <span style="color: #555555;"># A tibble: 851 x 5</span><span>
#&gt;     from    to name         type                                        geometry
#&gt;    </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>        </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                               </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;"> 1</span><span>     1     2 Havixbecker… reside…       (7.533722 51.95556, 7.533461 51.95576)
#&gt; </span><span style="color: #555555;"> 2</span><span>     3     4 Pienersallee second… (7.532442 51.95422, 7.53236 51.95377, 7.532…
#&gt; </span><span style="color: #555555;"> 3</span><span>     5     6 Schulte-Ber… reside… (7.532709 51.95209, 7.532823 51.95239, 7.53…
#&gt; </span><span style="color: #555555;"> 4</span><span>     7     8 </span><span style="color: #BB0000;">NA</span><span>           path    (7.540063 51.94468, 7.539696 51.94479, 7.53…
#&gt; </span><span style="color: #555555;"> 5</span><span>     9    10 Welsingheide reside…        (7.537673 51.9475, 7.537614 51.94562)
#&gt; </span><span style="color: #555555;"> 6</span><span>    11    12 </span><span style="color: #BB0000;">NA</span><span>           footway (7.543791 51.94733, 7.54369 51.94686, 7.543…
#&gt; </span><span style="color: #555555;"> 7</span><span>    13    14 </span><span style="color: #BB0000;">NA</span><span>           footway        (7.54012 51.94478, 7.539931 51.94514)
#&gt; </span><span style="color: #555555;"> 8</span><span>     8    10 </span><span style="color: #BB0000;">NA</span><span>           path    (7.53822 51.94546, 7.538131 51.94549, 7.538…
#&gt; </span><span style="color: #555555;"> 9</span><span>     7    15 </span><span style="color: #BB0000;">NA</span><span>           track   (7.540063 51.94468, 7.540338 51.94468, 7.54…
#&gt; </span><span style="color: #555555;">10</span><span>    16    17 </span><span style="color: #BB0000;">NA</span><span>           track   (7.5424 51.94599, 7.54205 51.94629, 7.54196…
#&gt; </span><span style="color: #555555;"># … with 841 more rows</span><span>
</span></code></pre>
</div>
<div id="visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization" class="anchor"></a>Visualization</h2>
<p>The <code>sfnetworks</code> package does not (yet?) include advanced visualization options. However, as already demonstrated before, a simple plot method is provided, which gives a quick view of how the network looks like.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></code></pre></div>
<p><img src="structure_files/figure-html/unnamed-chunk-15-1.png" width="480"></p>
<p>If you have <code>ggplot2</code> installed, you can also use <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">ggplot2::autoplot()</a></code> to directly create a simple ggplot of the network.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Road network of Münster Roxel"</span><span class="op">)</span></code></pre></div>
<p><img src="structure_files/figure-html/unnamed-chunk-16-1.png" width="480"></p>
<p>For advanced visualization, we encourage to extract nodes and edges as <code>sf</code> objects, and use one of the many ways to map those in R, either statically or interactively. Think of sf’s default plot method, <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">ggplot2::geom_sf()</a></code>, <code>tmap</code>, <code>mapview</code>, et cetera.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bc <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_betweenness</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'grey50'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"nodes"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">bc</span>, size <span class="op">=</span> <span class="va">bc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Betweenness centrality in Münster Roxel"</span><span class="op">)</span></code></pre></div>
<p><img src="structure_files/figure-html/unnamed-chunk-17-1.png" width="480"></p>
<p><em>Note: it would be great to see this change in the future, for example by good integration with <code>ggraph</code>. Contributions are very welcome regarding this!</em></p>
</div>
<div id="spatial-information" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-information" class="anchor"></a>Spatial information</h2>
<div id="geometries" class="section level3">
<h3 class="hasAnchor">
<a href="#geometries" class="anchor"></a>Geometries</h3>
<p>Geometries of nodes and edges are stored in an ‘sf-style’ geometry list-column in respectively the nodes and edges tables of the network. The geometries of the active element of the network can be extracted with the sf function <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">sf::st_geometry()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Geometry set for 701 features </span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt; First 5 geometries:</span>
<span class="co">#&gt; POINT (7.533722 51.95556)</span>
<span class="co">#&gt; POINT (7.533461 51.95576)</span>
<span class="co">#&gt; POINT (7.532442 51.95422)</span>
<span class="co">#&gt; POINT (7.53209 51.95328)</span>
<span class="co">#&gt; POINT (7.532709 51.95209)</span></code></pre></div>
<p>Just as with <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code>, there is also a shortcut to quickly extract geometries from any of the network elements.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"edges"</span><span class="op">)</span>
<span class="co">#&gt; Geometry set for 851 features </span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt; First 5 geometries:</span>
<span class="co">#&gt; LINESTRING (7.533722 51.95556, 7.533461 51.95576)</span>
<span class="co">#&gt; LINESTRING (7.532442 51.95422, 7.53236 51.95377...</span>
<span class="co">#&gt; LINESTRING (7.532709 51.95209, 7.532823 51.9523...</span>
<span class="co">#&gt; LINESTRING (7.540063 51.94468, 7.539696 51.9447...</span>
<span class="co">#&gt; LINESTRING (7.537673 51.9475, 7.537614 51.94562)</span></code></pre></div>
<p>Geometries can be replaced using either <code>st_geometry(x) = value</code> or the pipe-friendly <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_set_geometry(x, value)</a></code>. However, a replacement that breaks the valid spatial network structure will throw an error.</p>
<p>Replacing a geometry with <code>NULL</code> will remove the geometries. Removing edge geometries will result in a sfnetwork with spatially implicit edges. Removing node geometries will result in a tbl_graph, losing the spatial structure.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_set_geometry</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span>draw_lines <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">"Edges without geometries"</span><span class="op">)</span>

<span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_set_geometry</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span>vertex.color <span class="op">=</span> <span class="st">"black"</span>, main <span class="op">=</span> <span class="st">"Nodes without geometries"</span><span class="op">)</span></code></pre></div>
<p><img src="structure_files/figure-html/unnamed-chunk-20-1.png" width="50%"><img src="structure_files/figure-html/unnamed-chunk-20-2.png" width="50%"></p>
<p>Geometries can be replaced also by using <a href="https://r-spatial.github.io/sf/reference/geos_unary.html">geometry unary operations</a>, as long as they don’t break the valid spatial network structure. In practice this means that only <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">sf::st_reverse()</a></code> and <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">sf::st_simplify()</a></code> are supported. When calling <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">sf::st_reverse()</a></code> on the edges of a directed network, not only the geometries will be reversed, but the <em>from</em> and <em>to</em> columns of the edges will be swapped as well. In the case of undirected networks the these columns remain unchanged, since the terms <em>from</em> and <em>to</em> don’t have a meaning in undirected networks and can be used interchangeably.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">roxel</span>, directed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_reverse</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: In directed networks st_reverse swaps columns 'to' and 'from'</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:4326</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A directed multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 5 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522594 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;    from    to name         type                                         geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>        </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                                </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     2     1 Havixbecker… reside…        (7.533461 51.95576, 7.533722 51.95556)
#&gt; </span><span style="color: #555555;">2</span><span>     4     3 Pienersallee second… (7.53209 51.95328, 7.53236 51.95377, 7.53244…
#&gt; </span><span style="color: #555555;">3</span><span>     6     5 Schulte-Ber… reside… (7.532869 51.95257, 7.532823 51.95239, 7.532…
#&gt; </span><span style="color: #555555;">4</span><span>     8     7 </span><span style="color: #BB0000;">NA</span><span>           path    (7.53822 51.94546, 7.538353 51.94542, 7.5385…
#&gt; </span><span style="color: #555555;">5</span><span>    10     9 Welsingheide reside…         (7.537614 51.94562, 7.537673 51.9475)
#&gt; </span><span style="color: #555555;">6</span><span>    12    11 </span><span style="color: #BB0000;">NA</span><span>           footway (7.543751 51.94677, 7.54369 51.94686, 7.5437…
#&gt; </span><span style="color: #555555;"># … with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 1</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 7.522622 ymin: 51.94151 xmax: 7.546705 ymax: 51.9612</span><span>
#&gt;              geometry
#&gt;           </span><span style="color: #555555;font-style: italic;">&lt;POINT [°]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (7.533722 51.95556)
#&gt; </span><span style="color: #555555;">2</span><span> (7.533461 51.95576)
#&gt; </span><span style="color: #555555;">3</span><span> (7.532442 51.95422)
#&gt; </span><span style="color: #555555;"># … with 698 more rows</span><span>
</span></code></pre>
</div>
<div id="coordinate-reference-system" class="section level3">
<h3 class="hasAnchor">
<a href="#coordinate-reference-system" class="anchor"></a>Coordinate Reference System</h3>
<p>The Coordinate Reference System in which the coordinates of the network geometries are stored can be extracted with the sf function <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">sf::st_crs()</a></code>. The CRS in a valid spatial network structure is <em>always</em> the same for nodes and edges.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span>
<span class="co">#&gt; Coordinate Reference System:</span>
<span class="co">#&gt;   User input: EPSG:4326 </span>
<span class="co">#&gt;   wkt:</span>
<span class="co">#&gt; GEOGCRS["WGS 84",</span>
<span class="co">#&gt;     DATUM["World Geodetic System 1984",</span>
<span class="co">#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1]]],</span>
<span class="co">#&gt;     PRIMEM["Greenwich",0,</span>
<span class="co">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     CS[ellipsoidal,2],</span>
<span class="co">#&gt;         AXIS["geodetic latitude (Lat)",north,</span>
<span class="co">#&gt;             ORDER[1],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;         AXIS["geodetic longitude (Lon)",east,</span>
<span class="co">#&gt;             ORDER[2],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     USAGE[</span>
<span class="co">#&gt;         SCOPE["unknown"],</span>
<span class="co">#&gt;         AREA["World"],</span>
<span class="co">#&gt;         BBOX[-90,-180,90,180]],</span>
<span class="co">#&gt;     ID["EPSG",4326]]</span></code></pre></div>
<p>Coordinates can be transformed using the sf function <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">sf::st_transform()</a></code>. Since the CRS is the same for nodes and edges, transforming coordinates of the active element into a different CRS will automatically also transform the coordinates of the inactive element into the same target CRS.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">3035</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A directed multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry     bc
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923) </span><span style="text-decoration: underline;">12</span><span>936.
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946) </span><span style="text-decoration: underline;">11</span><span>824 
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777) </span><span style="text-decoration: underline;">11</span><span>926.
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)  </span><span style="text-decoration: underline;">7</span><span>259.
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)  </span><span style="text-decoration: underline;">5</span><span>668 
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)  </span><span style="text-decoration: underline;">2</span><span>374 
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 5</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name            type                                      geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                             </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker St… resident…       (4151491 3207923, 4151474 3207946)
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee    secondary (4151398 3207777, 4151390 3207727, 4151…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd-… resident… (4151408 3207539, 4151417 3207573, 4151…
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
</div>
<div id="bounding-box" class="section level3">
<h3 class="hasAnchor">
<a href="#bounding-box" class="anchor"></a>Bounding box</h3>
<p>The bounding box of the active element of a sfnetwork can be extracted with the sf function <code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">sf::st_bbox()</a></code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;      xmin      ymin      xmax      ymax </span>
<span class="co">#&gt;  7.522622 51.941512  7.546705 51.961203</span></code></pre></div>
<p>The bounding boxes of the nodes and edges are not necessarily the same. Therefore, sfnetworks adds the <code><a href="../reference/st_network_bbox.html">st_network_bbox()</a></code> function to retrieve the combined bounding box of the nodes and edges. In this combined bounding box, the most extreme coordinates of the two individual element bounding boxes are preserved. Hence, the <code>xmin</code> value of the network bounding box is the smallest <code>xmin</code> value of the node and edge bounding boxes, et cetera.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">node1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span>
<span class="va">node2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">51.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">node3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="va">node4</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span>
<span class="va">edge1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">node1</span>, <span class="va">node2</span>, <span class="va">node3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">nodes</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="va">node1</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="va">node3</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="va">node4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">edge1</span><span class="op">)</span>
<span class="va">edges</span><span class="op">$</span><span class="va">from</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">edges</span><span class="op">$</span><span class="va">to</span> <span class="op">=</span> <span class="fl">2</span>

<span class="va">small_net</span> <span class="op">=</span> <span class="fu"><a href="../reference/sfnetwork.html">sfnetwork</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">edges</span><span class="op">)</span>
<span class="co">#&gt; Checking if spatial network structure is valid...</span>
<span class="co">#&gt; Spatial network structure is valid</span>

<span class="va">node_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">small_net</span>, <span class="st">"nodes"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">edge_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">small_net</span>, <span class="st">"edges"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">net_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="../reference/st_network_bbox.html">st_network_bbox</a></span><span class="op">(</span><span class="va">small_net</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">small_net</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">4</span>, main <span class="op">=</span> <span class="st">"Element bounding boxes"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">node_bbox</span>, border <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">edge_bbox</span>, border <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">small_net</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">4</span>, main <span class="op">=</span> <span class="st">"Network bounding box"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">net_bbox</span>, border <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="structure_files/figure-html/unnamed-chunk-25-1.png" width="50%"><img src="structure_files/figure-html/unnamed-chunk-25-2.png" width="50%"></p>
</div>
<div id="attribute-geometry-relationships" class="section level3">
<h3 class="hasAnchor">
<a href="#attribute-geometry-relationships" class="anchor"></a>Attribute-geometry relationships</h3>
<p>In sf objects there is the possibility to store information about how attributes relate to geometries (for more information, see <a href="https://r-spatial.github.io/sf/articles/sf1.html#how-attributes-relate-to-geometries">here</a>). You can get and set this information with the function <code><a href="https://r-spatial.github.io/sf/reference/st_agr.html">sf::st_agr()</a></code> (for the setter, you can also use the pipe-friendly version <code><a href="https://r-spatial.github.io/sf/reference/st_agr.html">sf::st_set_agr()</a></code>). In a sfnetwork, you can use the same functions to get and set this information for the active element of the network.</p>
<p>Note that the <em>to</em> and <em>from</em> columns are not really attributes of edges seen from a network analysis perspective, but they are included in the agr factor to ensure smooth interaction with <code>sf</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_agr.html">st_set_agr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name"</span> <span class="op">=</span> <span class="st">"constant"</span>, <span class="st">"type"</span> <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_agr.html">st_agr</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;     from       to     name     type </span>
<span class="co">#&gt;     &lt;NA&gt;     &lt;NA&gt; constant constant </span>
<span class="co">#&gt; Levels: constant aggregate identity</span></code></pre></div>
<p>However, be careful, because we are currently not sure if this information survives all functions from <code>igraph</code> and <code>tidygraph</code>. If you have any issues with this, please let us know in our <a href="https://github.com/luukvdmeer/sfnetworks/issues">issue tracker</a>.</p>
</div>
<div id="other" class="section level3">
<h3 class="hasAnchor">
<a href="#other" class="anchor"></a>Other</h3>
<p>Also other getter and setter functions for several parts of spatial information are supported for sfnetworks, e.g. <code><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">sf::st_coordinates()</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/st_z_range.html">sf::st_z_range()</a></code> and <code><a href="https://r-spatial.github.io/sf/reference/st_m_range.html">sf::st_m_range()</a></code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
