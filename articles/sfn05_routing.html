<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Routing on spatial networks • sfnetworks</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="sfn05_routing_files/libs/quarto-html/popper.min.js"></script><script src="sfn05_routing_files/libs/quarto-html/tippy.umd.min.js"></script><link href="sfn05_routing_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sfn05_routing_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Routing on spatial networks">
<meta property="og:image" content="https://luukvdmeer.github.io/sfnetworks/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sfnetworks</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/sfn01_intro.html">Introduction to sfnetworks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn02_create_represent.html">Creating and representing spatial networks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn03_cleaning.html">Cleaning spatial networks</a></li>
    <li><a class="dropdown-item" href="../articles/sfn04_join_filter.html">Spatial joins and filters</a></li>
    <li><a class="dropdown-item" href="../articles/sfn05_routing.html">Routing on spatial networks</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/luukvdmeer/sfnetworks/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Routing on spatial networks</h1>


      <p class="date">2024-11-17</p>

      <small class="dont-index">Source: <a href="https://github.com/luukvdmeer/sfnetworks/blob/main/vignettes/sfn05_routing.qmd" class="external-link"><code>vignettes/sfn05_routing.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <style type="text/css" scoped="">
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>Calculating shortest paths between pairs of nodes is a core task in spatial network analysis. <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> does not implement its own algorithms to do this, but wraps function from other packages and exposes them through one consistent API that fits within the design of the package. This vignette demonstrates how.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-quantities.github.io/units/" class="external-link">units</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h2 id="the-basics">The basics<a class="anchor" aria-label="anchor" href="#the-basics"></a>
</h2>
<p>In <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> there are two core functions for routing on spatial networks. The first one, <code><a href="../reference/st_network_paths.html">st_network_paths()</a></code>, returns the course of the optimal paths between pairs of nodes. The second one, <code><a href="../reference/st_network_cost.html">st_network_cost()</a></code>, returns a matrix of optimal travel costs between pairs of nodes.</p>
<p>Both functions need to be provided with nodes to route from (the origins), and nodes to route to (the destinations). The most basic way of doing this is through the integer node indices, which correspond to the rownumbers of the nodes table. There are many other ways, though, which are explained in detail in <a href="#specifying-origins-and-destinations">this section</a>. Secondly, it should be specified what the weight of each edge is. Higher edge weights result in higher travel costs. By default, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> will always use the geographic lengths of the edges. It is possible to specify different edge weights, which is explained in detail in <a href="#specifying-edge-weights">this section</a>.</p>
<p>The function <code><a href="../reference/st_network_paths.html">st_network_paths()</a></code> returns a <code>sf</code> object with one row per requested path. Columns <em>from</em> and <em>to</em> contain the node indices of the origin and destination of each path. The column <em>node_path</em> contains the indices of the nodes on the path, in order of visit. Similarly, the column <em>edge_path</em> contains the indices of the edges on the paths, in order of visit. If your nodes and/or edges have names stored in a column named <em>name</em> and you want to use those values instead to encode them, set <code>use_names = TRUE</code>. Column <em>cost</em> stores the total travel cost of the path. The geometry column is the linestring that resulted from concatenating the individual geometries of all visited edges.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a network.</span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"gabriel"</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the shortest path between node 1 and nodes 12 and 17.</span></span>
<span><span class="va">paths</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">paths</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 2 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4548664 ymin: 2747309 xmax: 4549504 ymax: 2748537</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 7</span></span>
<span><span class="co">#&gt;    from    to node_path edge_path path_found  cost                      geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;list&gt;    &lt;list&gt;    &lt;lgl&gt;        [m]              &lt;LINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1     1    12 &lt;dbl [6]&gt; &lt;dbl [5]&gt; TRUE       1081. (4549504 2747309, 4549387 27…</span></span>
<span><span class="co">#&gt; 2     1    17 &lt;dbl [7]&gt; &lt;dbl [6]&gt; TRUE       1436. (4549504 2747309, 4549387 27…</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Do the same but now use node names to encode nodes in the output.</span></span>
<span><span class="va">paths</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span>, use_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">paths</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 2 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4548664 ymin: 2747309 xmax: 4549504 ymax: 2748537</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 7</span></span>
<span><span class="co">#&gt;   from      to    node_path edge_path path_found  cost                  geometry</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt; &lt;list&gt;    &lt;list&gt;    &lt;lgl&gt;        [m]          &lt;LINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1 Mozartki… Moza… &lt;chr [6]&gt; &lt;dbl [5]&gt; TRUE       1081. (4549504 2747309, 454938…</span></span>
<span><span class="co">#&gt; 2 Mozartki… Moza… &lt;chr [7]&gt; &lt;dbl [6]&gt; TRUE       1436. (4549504 2747309, 454938…</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">paths</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The function <code><a href="../reference/st_network_cost.html">st_network_cost()</a></code> returns a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n \times m</annotation></semantics></math> matrix, with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> being the number of specified origins, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math> being the number of specified destinations. Element <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">A_{ij}</annotation></semantics></math> stores the total travel cost of the shortest path between the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>-th origin and the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>-th destination. This matrix is usually an important starting point for further analysis. For example, it can serve as input to route optimization algorithms, spatial clustering algorithms and the calculation of statistical measures based on spatial proximity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the cost matrix for travel between three nodes.</span></span>
<span><span class="fu"><a href="../reference/st_network_cost.html">st_network_cost</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Units: [m]</span></span>
<span><span class="co">#&gt;           1        12        17</span></span>
<span><span class="co">#&gt; 1     0.000 1081.3335 1435.9344</span></span>
<span><span class="co">#&gt; 12 1081.333    0.0000  795.9422</span></span>
<span><span class="co">#&gt; 17 1435.934  795.9422    0.0000</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use node names to encode nodes.</span></span>
<span><span class="fu"><a href="../reference/st_network_cost.html">st_network_cost</a></span><span class="op">(</span><span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span>, use_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Units: [m]</span></span>
<span><span class="co">#&gt;                      Mozartkino Mozart-Eine Hommage Mozart Studentenheim</span></span>
<span><span class="co">#&gt; Mozartkino                0.000           1081.3335            1435.9344</span></span>
<span><span class="co">#&gt; Mozart-Eine Hommage    1081.333              0.0000             795.9422</span></span>
<span><span class="co">#&gt; Mozart Studentenheim   1435.934            795.9422               0.0000</span></span></code></pre></div>
</div>
<p>There is also the function <code><a href="../reference/st_network_cost.html">st_network_distance()</a></code>, which is a synonym for <code><a href="../reference/st_network_cost.html">st_network_cost()</a></code> with the edge weights always being the geographic edge length. This function was added to provide an intuitive network-specific alternative to <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">sf::st_distance()</a></code>.</p>
<p>Do note that in our nice little example network all nodes are connected to each other. In many real-world networks this may not always be the case, meaning that some node pairs will not have a path between them. In that case <code><a href="../reference/st_network_paths.html">st_network_paths()</a></code> will still return the “path”, but with an empty geometry and a <code>FALSE</code> value in the <em>path_found</em> column. <code><a href="../reference/st_network_cost.html">st_network_cost()</a></code> will store an <code>Inf</code> value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">divided_net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">mozart</span>, <span class="st">"knn"</span>, k <span class="op">=</span> <span class="fl">3</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in spdep::knn2nb(spdep::knearneigh(st_geometry(x), k = k), sym =</span></span>
<span><span class="co">#&gt; FALSE): neighbour object has 2 sub-graphs</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paths</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">divided_net</span>, <span class="fl">12</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">paths</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 2 features and 6 fields (with 1 geometry empty)</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4548664 ymin: 2747868 xmax: 4548984 ymax: 2748537</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 7</span></span>
<span><span class="co">#&gt;    from    to node_path edge_path path_found cost                       geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;list&gt;    &lt;list&gt;    &lt;lgl&gt;       [m]               &lt;LINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1    12     1 &lt;dbl [0]&gt; &lt;dbl [0]&gt; FALSE      Inf                           EMPTY</span></span>
<span><span class="co">#&gt; 2    12    17 &lt;dbl [3]&gt; &lt;dbl [2]&gt; TRUE       796. (4548664 2747868, 4548897 274…</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">divided_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">paths</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">divided_net</span><span class="op">)</span><span class="op">[</span><span class="fl">12</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">divided_net</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">17</span><span class="op">)</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/st_network_cost.html">st_network_cost</a></span><span class="op">(</span><span class="va">divided_net</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Units: [m]</span></span>
<span><span class="co">#&gt;      1       12       17</span></span>
<span><span class="co">#&gt; 1    0      Inf      Inf</span></span>
<span><span class="co">#&gt; 12 Inf   0.0000 795.9422</span></span>
<span><span class="co">#&gt; 17 Inf 795.9422   0.0000</span></span></code></pre></div>
</div>
<p>In many cases, it is a good idea to first extract the largest connected component from your network before computing routes. This can be done by the morpher <code><a href="https://tidygraph.data-imaginist.com/reference/morphers.html" class="external-link">tidygraph::to_largest_component()</a></code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract only the largest connected component.</span></span>
<span><span class="va">component</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">divided_net</span>, <span class="va">to_largest_component</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">divided_net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">component</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<figcaption>Full network</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-15-2.png" width="672"></p>
<figcaption>Largest component</figcaption></figure>
</div>
</div>
</div>
</div>
<p>If you do not want to extract the shortest paths as linestring geometries, but rather subset the network to only keep those nodes and edges that are in the path, the <code><a href="../reference/spatial_morphers.html">to_spatial_shortest_paths()</a></code> morpher is your choice. It accepts the same arguments as <code><a href="../reference/st_network_paths.html">st_network_paths()</a></code>, but will return a filtered network for each requested path. The nodes and edges tables of each sub-network are arranged by the order in which they appear in the path.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paths</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">morph</a></span><span class="op">(</span><span class="va">to_spatial_shortest_paths</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">crystallize</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">paths</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;   name  graph</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;</span></span>
<span><span class="co">#&gt; 1 1     &lt;sfnetwrk&gt;</span></span>
<span><span class="co">#&gt; 2 2     &lt;sfnetwrk&gt;</span></span>
<span><span class="co">#&gt; 3 3     &lt;sfnetwrk&gt;</span></span></code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">graph</span>, <span class="va">plot</span>, cex <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<figcaption>Path 1 -&gt; 12</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-17-2.png" width="672"></p>
<figcaption>Path 1 -&gt; 16</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-17-3.png" width="672"></p>
<figcaption>Path 1 -&gt; 17</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section class="level2"><h2 id="choosing-a-routing-backend">Choosing a routing backend<a class="anchor" aria-label="anchor" href="#choosing-a-routing-backend"></a>
</h2>
<p>As mentioned, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> does not implement the routing algorithms themselves. For that, it relies on other packages, which we call “routing backends” or “routers” for short. The default routing backend is <a href="https://r.igraph.org/" class="external-link">igraph</a>. The <code><a href="../reference/st_network_paths.html">st_network_paths()</a></code> function wraps, depending on argument settings, <code><a href="https://r.igraph.org/reference/distances.html" class="external-link">igraph::shortest_paths()</a></code>, <code><a href="https://r.igraph.org/reference/distances.html" class="external-link">igraph::all_shortest_paths()</a></code> and <code><a href="https://r.igraph.org/reference/k_shortest_paths.html" class="external-link">igraph::k_shortest_paths()</a></code>. The <code><a href="../reference/st_network_cost.html">st_network_cost()</a></code> function wraps <code><a href="https://r.igraph.org/reference/distances.html" class="external-link">igraph::distances()</a></code>. The benefits of this routing backend are: 1) it can compute all shortest paths, if there exists more than one; 2) it can compute the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> shortest paths with Yen’s algorithm; 3) no internal conversion between data structures is needed. However, routing is only supported from a single origin. Hence, many-to-many routing is not possible.</p>
<p>The second routing backend that is currently supported is <a href="https://github.com/UrbanAnalyst/dodgr" class="external-link">dodgr</a>. This package implements a very fast routing algorithm in C++. This is exposed in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> by wrapping <code><a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_paths.html" class="external-link">dodgr::dodgr_paths()</a></code> in <code><a href="../reference/st_network_paths.html">st_network_paths()</a></code> and <code><a href="https://UrbanAnalyst.github.io/dodgr/reference/dodgr_dists.html" class="external-link">dodgr::dodgr_dists()</a></code> in <code><a href="../reference/st_network_cost.html">st_network_cost()</a></code>. The benefits of this routing backend are: 1) it can route from multiple origins to multiple destinations, i.e. many-to-many routing; 2) it supports dual-weighted routing (see <a href="#dual-weighted-routing">here</a>); 3) it is very fast also on large networks. However, there is currently no support for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> shortest paths routing, and some internal conversions are needed to bridge between the different data structures.</p>
<p>You can specify which routing backend to use through the <code>router</code> argument. If you want to change the default routing backend, update the global options: <code>options(sfn_default_router = "dodgr")</code>.</p>
</section><section class="level2"><h2 id="specifying-origins-and-destinations">Specifying origins and destinations<a class="anchor" aria-label="anchor" href="#specifying-origins-and-destinations"></a>
</h2>
<p>The nodes to route from (i.e. the origins) and the nodes to route to (i.e. the destinations) should be referenced by their integer index, which corresponds to their rownumber in the nodes table of the network. However, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> allows you to reference nodes also in different ways, and it will internally find the corresponding node indices for you. This is called a <em>sfnetwork node query</em>, and it is evaluated by <code><a href="../reference/evaluate_node_query.html">evaluate_node_query()</a></code>. However, you will normally never call that function directly as a user. Instead, you simply specify your node query as argument value of the <code>from</code> and <code>to</code> arguments. The query can be formatted as follows:</p>
<ul>
<li>As <strong>spatial features</strong>: Spatial features can be given as object of class <code>sf</code> or <code>sfc</code>. The nearest node to each feature is found by calling <code><a href="../reference/nearest.html">nearest_nodes()</a></code>.</li>
<li>As <strong>node type query function</strong>: A <a href="https://tidygraph.data-imaginist.com/reference/node_types.html" class="external-link">node type query</a> is a specific type of a node measure function that defines for each node if it is of a given type or not. Nodes that meet the criterium are queried.</li>
<li>As <strong>node predicate query function</strong>: A <a href="https://luukvdmeer.github.io/sfnetworks/reference/spatial_node_predicates.html">node predicate query</a> is a specific type of node measure function that defines for each node if a given spatial predicate applies to the spatial relation between that node and other spatial features. Nodes that meet the criterium are queried.</li>
<li>As <strong>column name</strong>: The referenced column is expected to have logical values defining for each node if it should be queried or not. Tidy evaluation is used and hence the column name should be unquoted.</li>
<li>As <strong>integers</strong>: Integers are interpreted as node indices. A node index corresponds to a row-number in the nodes table of the network.</li>
<li>As <strong>characters</strong>: Characters are interpreted as node names. A node name corresponds to a value in a column named <em>name</em> in the the nodes table of the network. Note that this column is expected to store unique names without any duplicated values.</li>
<li>As <strong>logicals</strong>: Logicals should define for each node if it should be queried or not.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_combine</a></span><span class="op">(</span><span class="va">mozart</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">mozart</span><span class="op">[</span><span class="fl">15</span>, <span class="op">]</span>, <span class="fl">350</span><span class="op">)</span></span>
<span></span>
<span><span class="va">paths_A</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span></span>
<span>  <span class="va">net</span>,</span>
<span>  from <span class="op">=</span> <span class="va">pt</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html" class="external-link">centrality_degree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">paths_B</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span></span>
<span>  <span class="va">net</span>,</span>
<span>  from <span class="op">=</span> <span class="st">"Mozartkino"</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="../reference/spatial_node_predicates.html">node_is_within</a></span><span class="op">(</span><span class="va">pl</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">paths_A</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">paths_A</span><span class="op">$</span><span class="va">from</span><span class="op">)</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">paths_A</span><span class="op">$</span><span class="va">to</span><span class="op">)</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pt</span>, color <span class="op">=</span> <span class="st">"skyblue"</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pl</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">paths_B</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">paths_B</span><span class="op">$</span><span class="va">from</span><span class="op">)</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">paths_B</span><span class="op">$</span><span class="va">to</span><span class="op">)</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="sfn05_routing_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="sfn05_routing_files/figure-html/unnamed-chunk-19-2.png" width="672"></p>
</div>
</div>
</div>
</section><section class="level2"><h2 id="specifying-edge-weights">Specifying edge weights<a class="anchor" aria-label="anchor" href="#specifying-edge-weights"></a>
</h2>
<p>What the shortest path is, depends on the weight of each edge. The higher the weight, the longer the edge. In spatial network analysis, it often makes sense to use geographic length as edge weights, such that the shortest path is the path with the shortest geographic distance. Therefore, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> uses this as a default. It is possible to specify different edge weights through the <code>weights</code> argument. Weights should be specified as a numeric vector of the same length as the number of edges in the network. However, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> allows you to specify them also in different ways, and it will internally compute the numeric vector for you. This is called a <em>sfnetwork edge specification</em>, and it is evaluated by <code><a href="../reference/evaluate_weight_spec.html">evaluate_weight_spec()</a></code>. However, you will normally never call that function directly as a user. Instead, you simply provide your specification as argument value of the <code>weights</code> argument. The specification can be formatted as follows:</p>
<ul>
<li>As <strong>edge measure function</strong>: A <a href="https://luukvdmeer.github.io/sfnetworks/reference/spatial_edge_measures.html">spatial edge measure function</a> computes a given measure for each edge, which will then be used as edge weights. By default the <code><a href="../reference/spatial_edge_measures.html">edge_length()</a></code> measure is used in all routing functions.</li>
<li>As <strong>column name</strong>: A column in the edges table of the network that contains the edge weights. Tidy evaluation is used and hence the column name should be unquoted.</li>
<li>As <strong>numeric vector</strong>: This vector should be of the same length as the number of edges in the network, specifying for each edge what its weight is.</li>
<li>As <strong>dual weights</strong>: Dual weights can be specified by the <code><a href="../reference/dual_weights.html">dual_weights()</a></code> function. This allows to use a different set of weights for shortest paths computation and for reporting the total cost of those paths. Only the <a href="https://github.com/UrbanAnalyst/dodgr" class="external-link">dodgr</a> routing backend supports dual-weighted routing. See <a href="#dual-weighted-routing">here</a> for an example.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign each edge a speed.</span></span>
<span><span class="co"># Some edges will have a higher speed.</span></span>
<span><span class="co"># Based on this, compute the travel time of each edge.</span></span>
<span><span class="va">speeds</span> <span class="op">=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fu"><a href="../reference/n.html">n_edges</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span>, <span class="st">"km/h"</span><span class="op">)</span></span>
<span><span class="va">speeds</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">25</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">20</span>, <span class="st">"km/h"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>speed <span class="op">=</span> <span class="va">speeds</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="va">speed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now compute the shortest and the fastest routes.</span></span>
<span><span class="va">shortest</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">1</span>, <span class="fl">17</span>, weights <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># The default.</span></span>
<span><span class="va">fastest</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">1</span>, <span class="fl">17</span>, weights <span class="op">=</span> <span class="va">time</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/drop_units.html" class="external-link">drop_units</a></span><span class="op">(</span><span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html" class="external-link">scale_edge_color_continuous</a></span><span class="op">(</span><span class="st">"length [m]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/drop_units.html" class="external-link">drop_units</a></span><span class="op">(</span><span class="va">speed</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html" class="external-link">scale_edge_color_continuous</a></span><span class="op">(</span><span class="st">"speed [km/h]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">shortest</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">17</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fastest</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">17</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-nrow="2" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<figcaption>Edge length</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-21-2.png" width="672"></p>
<figcaption>Edge speed</figcaption></figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-21-3.png" width="672"></p>
<figcaption>Shortest route</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-21-4.png" width="672"></p>
<figcaption>Fastest route</figcaption></figure>
</div>
</div>
</div>
</div>
<p>It is important to note that while all functions in <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> that consider edge weights will use <code><a href="../reference/spatial_edge_measures.html">edge_length()</a></code> as the default, this is <strong>not</strong> the case in <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>. Here you should always explicitly specify the weights, for example when computing betweenness centrality using <code><a href="https://tidygraph.data-imaginist.com/reference/centrality.html" class="external-link">tidygraph::centrality_betweenness()</a></code>. Otherwise, each edge will be weighted by 1, and the shortest path is the path with the fewest number of edges. Furthermore, it is important to know that <a href="https://r.igraph.org/" class="external-link">igraph</a> has a different behavior regarding edge weights. When <code>weights = NULL</code>, they will look for an edge attribute named <em>weight</em> and use that whenever present. <a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a>, and therefore also <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>, do not do this, and always default to the edge weights of 1 whenever <code>weights = NULL</code>.</p>
</section><section class="level2"><h2 id="applications">Applications<a class="anchor" aria-label="anchor" href="#applications"></a>
</h2>
<p>In this section, we will show a small set of applications of the routing related functions. It is not meant to be an overview that covers everything. Also, remember that <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> is a general-purpose spatial network analysis package not optimized for a specific application. However, especially in combination with other packages it can address a wide variety of use-cases.</p>
<section class="level3"><h3 id="k-shortest-paths">K shortest paths<a class="anchor" aria-label="anchor" href="#k-shortest-paths"></a>
</h3>
<p>Thanks to the <a href="https://r.igraph.org/" class="external-link">igraph</a> routing backend, we can compute not only the shortest path between two nodes, but also the next <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k-1</annotation></semantics></math> shortest paths. For this, set the <code>k</code> argument of <code><a href="../reference/st_network_paths.html">st_network_paths()</a></code> to any integer higher than 1. This is only supported for one-to-one routing, i.e. a single origin and a single destination.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paths</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">1</span>, <span class="fl">17</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">paths</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 3 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4548984 ymin: 2747309 xmax: 4549589 ymax: 2748537</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 7</span></span>
<span><span class="co">#&gt;    from    to node_path edge_path path_found  cost                      geometry</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;list&gt;    &lt;list&gt;    &lt;lgl&gt;        [m]              &lt;LINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1     1    17 &lt;dbl [7]&gt; &lt;dbl [6]&gt; TRUE       1436. (4549504 2747309, 4549387 27…</span></span>
<span><span class="co">#&gt; 2     1    17 &lt;dbl [9]&gt; &lt;dbl [8]&gt; TRUE       1580. (4549504 2747309, 4549589 27…</span></span>
<span><span class="co">#&gt; 3     1    17 &lt;dbl [7]&gt; &lt;dbl [6]&gt; TRUE       1602. (4549504 2747309, 4549589 27…</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paths</span> <span class="op">=</span> <span class="va">paths</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/n.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">paths</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">17</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="st">"k"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="closest-facility-analysis">Closest facility analysis<a class="anchor" aria-label="anchor" href="#closest-facility-analysis"></a>
</h3>
<p>The purpose of closest facility analysis is, given a set of destination locations (also referred to as the <em>facilities</em>) and origin locations (also referred to as the <em>sites</em>), to find the closest <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> facilities to each site. For example, you might want to find the nearest transit hub for each address in a city, or the nearest hospital to high-risk road intersections.</p>
<p>To solve this problem, you can calculate the cost matrix with the sites as origins, and the facilities as destinations points. Then, for each row (i.e. each site) you find the column(s) with the lowest cost value. Note that each facility and each site is represented by its nearest node in the network. First blending them into the network using <code><a href="../reference/st_network_blend.html">st_network_blend()</a></code> gives the most accurate results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a network.</span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">roxel</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create some facility locations spread over the area.</span></span>
<span><span class="va">facilities</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4151100</span>, <span class="fl">3207700</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4151040</span>, <span class="fl">3206660</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4151800</span>, <span class="fl">3207200</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4152000</span>, <span class="fl">3207600</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">3035</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select a random set of sites.</span></span>
<span><span class="va">sites</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_convex_hull</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_combine</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">)</span>, <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Blend the sites and facilities into the network to get better results.</span></span>
<span><span class="co"># Also select only the largest connected component.</span></span>
<span><span class="co"># Such that we avoid points being blended to a small disconnected component.</span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">to_largest_component</span>, .clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/st_network_blend.html">st_network_blend</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sites</span>, <span class="va">facilities</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the cost matrix.</span></span>
<span><span class="va">mat</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/st_network_cost.html">st_network_cost</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">sites</span>, to <span class="op">=</span> <span class="va">facilities</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find for each site which facility is closest.</span></span>
<span><span class="va">closest</span> <span class="op">=</span> <span class="va">facilities</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mat</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a line between each site and its closest facility, for visualization.</span></span>
<span><span class="va">draw_lines</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">sources</span>, <span class="va">targets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">f</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="st">"LINESTRING"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">lines</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">sources</span>, <span class="va">targets</span>, SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">lines</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">sources</span><span class="op">)</span></span>
<span>  <span class="va">lines</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">connections</span> <span class="op">=</span> <span class="fu">draw_lines</span><span class="op">(</span><span class="va">sites</span>, <span class="va">closest</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">connections</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sites</span>, color <span class="op">=</span> <span class="st">"orange"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">facilities</span>, color <span class="op">=</span> <span class="st">"skyblue"</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="traveling-salesman-problem">Traveling salesman problem<a class="anchor" aria-label="anchor" href="#traveling-salesman-problem"></a>
</h3>
<p>The traveling salesman problem aims to find the shortest tour that visits every location in a set exactly once. To solve this, <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> provides an interface to the <code><a href="https://rdrr.io/pkg/TSP/man/TSP.html" class="external-link">TSP::TSP()</a></code> function. This requires the <a href="https://github.com/mhahsler/TSP" class="external-link">TSP</a> package to be installed.</p>
<p>The <code><a href="../reference/st_network_travel.html">st_network_travel()</a></code> function returns a <code>sf</code> object similar to the output of <code><a href="../reference/st_network_paths.html">st_network_paths()</a></code>. Each row represent one leg of the route, from one location to the next. Note that each location to visit is represented by its nearest node in the network. First blending them into the network using <code><a href="../reference/st_network_blend.html">st_network_blend()</a></code> gives the most accurate results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We will use the facilities from the previous section as visiting locations.</span></span>
<span><span class="co"># They are already blended into the largest component of the network.</span></span>
<span><span class="va">route</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_travel.html">st_network_travel</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">facilities</span><span class="op">)</span></span>
<span><span class="va">route</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 4 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4150908 ymin: 3206643 xmax: 4152015 ymax: 3207744</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 7</span></span>
<span><span class="co">#&gt;    from    to node_path  edge_path  path_found  cost                    geometry</span></span>
<span><span class="co">#&gt; * &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;     &lt;lgl&gt;        [m]       &lt;MULTILINESTRING [m]&gt;</span></span>
<span><span class="co">#&gt; 1   869  1003 &lt;dbl [12]&gt; &lt;dbl [11]&gt; TRUE        602. ((4151793 3207244, 4151805…</span></span>
<span><span class="co">#&gt; 2  1003   633 &lt;dbl [28]&gt; &lt;dbl [27]&gt; TRUE       1074. ((4151039 3206662, 4151063…</span></span>
<span><span class="co">#&gt; 3   633  1001 &lt;dbl [22]&gt; &lt;dbl [21]&gt; TRUE       1385. ((4151138 3207734, 4151160…</span></span>
<span><span class="co">#&gt; 4  1001   869 &lt;dbl [39]&gt; &lt;dbl [38]&gt; TRUE       1178. ((4151073 3207744, 4151097…</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">route</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">facilities</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="isodistance-polygons">Isodistance polygons<a class="anchor" aria-label="anchor" href="#isodistance-polygons"></a>
</h3>
<p>With respect to a given point <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> and a given distance <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>, an isodistance is the line for which it holds that the distance from any point on the line from <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> is equal to <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>. In spatial network analysis, it is common to find all nodes that fall within an isodistance line computed for a given source node <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>. By enclosing this nodes with a concave hull, we obtain a <em>isodistance polygon</em>.</p>
<p>This workflow is implemented in the function <code><a href="../reference/st_network_iso.html">st_network_iso()</a></code>. It will first compute the distance matrix from a given source node <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> (which can be specified as explained <a href="#specifying-origins-and-destinations">here</a>) to all other nodes in the network using <code><a href="../reference/st_network_cost.html">st_network_cost()</a></code>, and then filter those nodes that are within a given distance <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>. Using <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">sf::st_concave_hull()</a></code>, it will compute the concave hull around those nodes to obtain an isodistance polygon. Multiple distance thresholds can be given, resulting in multiple isodistance polygons being drawn. The output of the function is an <code>sf</code> object with one row per requested polygon.</p>
<p>By setting the <code>ratio</code> argument (a value between 0 and 1, with 1 being the convex hull), we can increase or decrease the level of detail of the polygons. By default, no holes are allowed in the polygons, but this can be changed setting <code>allow_holes = TRUE</code>. Do note that changing the ratio requires a GEOS version of at least 3.11. GEOS is a C/C++ library for computational geometry used by <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the source.</span></span>
<span><span class="co"># This point will be snapped to its nearest node.</span></span>
<span><span class="va">pt</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">roxel</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3035</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute isodistance polygons for four different thresholds.</span></span>
<span><span class="va">polys</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_iso.html">st_network_iso</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">pt</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">polys</span></span>
<span><span class="co">#&gt; Simple feature collection with 4 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4150754 ymin: 3206653 xmax: 4152274 ymax: 3208212</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt;       cost                       geometry</span></span>
<span><span class="co">#&gt; 1 1000 [m] POLYGON ((4151598 3206653, ...</span></span>
<span><span class="co">#&gt; 2  500 [m] POLYGON ((4151611 3207041, ...</span></span>
<span><span class="co">#&gt; 3  250 [m] POLYGON ((4151519 3207212, ...</span></span>
<span><span class="co">#&gt; 4  100 [m] POLYGON ((4151540 3207378, ...</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">polys</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/drop_units.html" class="external-link">drop_units</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_continuous</a></span><span class="op">(</span><span class="st">"distance [m]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-29-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A different approach can be taken with the morpher <code><a href="../reference/spatial_morphers.html">to_spatial_neighborhood()</a></code>. Instead of drawing polygons, this function will subset the network to contain only those nodes inside the isodistance line, and the edges that connect them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sub_net</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">to_spatial_neighborhood</span>, <span class="va">pt</span>, <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">net</span>, col <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sub_net</span>, col <span class="op">=</span> <span class="st">"orange"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-31-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Both <code><a href="../reference/st_network_iso.html">st_network_iso()</a></code> and <code><a href="../reference/spatial_morphers.html">to_spatial_neighborhood()</a></code> allow to specify other edge weights than geographic distance. This can be done through the <code>weights</code> argument, as explained <a href="#specifying-edge-weights">here</a>. When using time as edge weight, we talk about <em>isochrones</em> instead of <em>isodistances</em>.</p>
</section><section class="level3"><h3 id="custom-routing">Custom routing<a class="anchor" aria-label="anchor" href="#custom-routing"></a>
</h3>
<p>In many cases the shortest path based geographical distances or travel time is not necessarily the optimal path. The most appropriate route may depend on many factors, for example staying away from large and potentially unpleasant roads for motor traffic. All networks have different characteristics. In OpenStreetMap networks the <em>highway</em> attribute is often a good (albeit crude) approximation of road type. The <code>roxel</code> demo dataset is derived from OpenStreetMap and stores the <em>highway</em> attribute in the <em>type</em> column. We can see Roxel has a largely residential road network:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roxel</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; Simple feature collection with 9 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 7.522595 ymin: 51.94151 xmax: 7.546705 ymax: 51.96119</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 9 × 3</span></span>
<span><span class="co">#&gt;   type             n                                                    geometry</span></span>
<span><span class="co">#&gt; * &lt;chr&gt;        &lt;int&gt;                                       &lt;MULTILINESTRING [°]&gt;</span></span>
<span><span class="co">#&gt; 1 cycleway         5 ((7.540663 51.95534, 7.540831 51.95536), (7.534414 51.9547…</span></span>
<span><span class="co">#&gt; 2 footway        134 ((7.543404 51.94779, 7.54358 51.94786, 7.543685 51.9479), …</span></span>
<span><span class="co">#&gt; 3 path           113 ((7.54059 51.95077, 7.54127 51.95012), (7.53819 51.95738, …</span></span>
<span><span class="co">#&gt; 4 residential    325 ((7.537815 51.95867, 7.537015 51.95848, 7.537374 51.95787,…</span></span>
<span><span class="co">#&gt; 5 secondary       54 ((7.532301 51.95559, 7.532214 51.95575, 7.532142 51.95589,…</span></span>
<span><span class="co">#&gt; 6 service        256 ((7.525727 51.94672, 7.52585 51.94668, 7.526145 51.94655, …</span></span>
<span><span class="co">#&gt; 7 track           15 ((7.541088 51.95588, 7.541908 51.95604), (7.535803 51.9433…</span></span>
<span><span class="co">#&gt; 8 unclassified    57 ((7.534157 51.94654, 7.534845 51.94597, 7.534993 51.94583,…</span></span>
<span><span class="co">#&gt; 9 NA             256 ((7.526311 51.94653, 7.526298 51.94649, 7.526311 51.94644,…</span></span></code></pre>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html" class="external-link">scale_edge_color_discrete</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-33-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Building on the shortest paths calculated in a previous section we can try an alternative routing profile. For the purposes of illustration, lets imagine we’re routing for a vehicle that we want to keep away from residential roads.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weighting_profile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  cycleway <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  footway <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  path <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  residential <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  secondary <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  service <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  track <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  unclassified <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>multiplier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">weighting_profile</span><span class="op">[</span><span class="va">type</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/drop_units.html" class="external-link">drop_units</a></span><span class="op">(</span><span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">multiplier</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We can now compare the shortest path with the optimal path according to our weighting profile.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shortest</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">452</span>, <span class="fl">212</span><span class="op">)</span></span>
<span><span class="va">optimal</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_network_paths.html">st_network_paths</a></span><span class="op">(</span><span class="va">net</span>, <span class="fl">452</span>, <span class="fl">212</span>, weights <span class="op">=</span> <span class="va">weight</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">shortest</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">452</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">212</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"sf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_sf.html" class="external-link">geom_edge_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_sf.html" class="external-link">geom_node_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">optimal</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">452</span>, <span class="op">]</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/data.html">node_data</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span><span class="op">[</span><span class="fl">212</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-36-1.png" width="672"></p>
<figcaption>Shortest route</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="sfn05_routing_files/figure-html/unnamed-chunk-36-2.png" width="672"></p>
<figcaption>Optimal route</figcaption></figure>
</div>
</div>
</div>
</div>
<p>Note that developing more sophisticated routing profiles is beyond the scope of this package. If you need complex mode-specific routing profiles, we recommend looking at routing profiles associated with open source routing engines such as OSRM, or the <a href="https://github.com/UrbanAnalyst/dodgr" class="external-link">dodgr</a> R package. Another direction of travel could be to extend on the approach illustrated here, but this work could be well-suited to a separate package that builds on <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a>, possibly integrating the routing profiles of <a href="https://github.com/UrbanAnalyst/dodgr" class="external-link">dodgr</a>. If you’d like to work on such a project to improve mode-specific routing in R by building on this package, please let us know in the <a href="https://github.com/luukvdmeer/sfnetworks/discussions" class="external-link">discussion room</a>!</p>
</section><section class="level3"><h3 id="dual-weighted-routing">Dual-weighted routing<a class="anchor" aria-label="anchor" href="#dual-weighted-routing"></a>
</h3>
<p>If many cases we may be interested in obtaining a cost matrix that stores geographic distances of the most optimal routes according to some custom set of edge weights. That is, we want to use the custom weights to define what the “shortest” path is, but then report the actual geographic distance of that path. This is called <em>dual-weighted routing</em>. The <a href="https://github.com/UrbanAnalyst/dodgr" class="external-link">dodgr</a> routing backend supports it. <a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a> offers the <code><a href="../reference/dual_weights.html">dual_weights()</a></code> function to allow you to specify dual weights to the <code>weights</code> argument of the routing functions. It accepts two sets of weights, which can both be specified by any of the ways explained in <a href="#specifying-edge-weights">this section</a>. The first set of weights are the <em>reported</em> weights, and the second set of weights are the <em>actual</em> weights used to define the optimal path.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cost matrix reporting the custom weights.</span></span>
<span><span class="fu"><a href="../reference/st_network_cost.html">st_network_cost</a></span><span class="op">(</span></span>
<span>  <span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">901</span>, by <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">901</span>, by <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>, </span>
<span>  weights <span class="op">=</span> <span class="va">weight</span>,</span>
<span>  router <span class="op">=</span> <span class="st">"dodgr"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        1  151  301  451  601  751  901</span></span>
<span><span class="co">#&gt; 1      0 2953  374 1599 1445  863 5485</span></span>
<span><span class="co">#&gt; 151 2953    0 2579 3721 2371 3816 7772</span></span>
<span><span class="co">#&gt; 301  374 2579    0 1244 1071 1237 5567</span></span>
<span><span class="co">#&gt; 451 1599 3721 1244    0 2213 1349 5971</span></span>
<span><span class="co">#&gt; 601 1445 2371 1071 2213    0 2308 6437</span></span>
<span><span class="co">#&gt; 751  863 3816 1237 1349 2308    0 4811</span></span>
<span><span class="co">#&gt; 901 5485 8385 5806 5559 6876 4811    0</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cost matrix using custom weights but reporting real distances.</span></span>
<span><span class="fu"><a href="../reference/st_network_cost.html">st_network_cost</a></span><span class="op">(</span></span>
<span>  <span class="va">net</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">901</span>, by <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">901</span>, by <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>, </span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="../reference/dual_weights.html">dual_weights</a></span><span class="op">(</span><span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">weight</span><span class="op">)</span>,</span>
<span>  router <span class="op">=</span> <span class="st">"dodgr"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        1  151  301  451  601  751  901</span></span>
<span><span class="co">#&gt; 1      0  994  249  886  768  305 1127</span></span>
<span><span class="co">#&gt; 151  994    0  758 1588  588 1264 1622</span></span>
<span><span class="co">#&gt; 301  249  758    0  914  530  519 1350</span></span>
<span><span class="co">#&gt; 451  886 1588  914    0 1360  696 1334</span></span>
<span><span class="co">#&gt; 601  768  588  530 1360    0 1036 1510</span></span>
<span><span class="co">#&gt; 751  305 1264  519  696 1036    0  894</span></span>
<span><span class="co">#&gt; 901 1127 1622 1350 1334 1510  894    0</span></span></code></pre></div>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
